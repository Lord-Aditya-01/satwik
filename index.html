<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Satwik Mobile App</title>
    <link crossorigin href="https://fonts.gstatic.com/" rel="preconnect" />
    <link as="style" href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans:wght@400;500;700;900&family=Public+Sans:wght@400;500;700;900" onload="this.rel='stylesheet'" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --primary-500: #38e07b;
        --neutral-900: #111714;
        --neutral-800: #1a241f;
        --neutral-700: #29382f;
        --neutral-400: #9eb7a8;
      }

      /* Light theme (reduced brightness) */
      .theme-light {
        --neutral-900: #e8f0ec; /* app bg - darker grey-green */
        --neutral-800: #d4e2da; /* surfaces - medium grey-green */
        --neutral-700: #c1d4c8; /* cards - darker grey-green */
        --neutral-400: #5a6b63; /* text-muted - darker grey */
      }
      .theme-light .text-white { color: #0f1412 !important; }
      .theme-light .text-gray-400 { color: #5a6b63 !important; }
      .theme-light .bg-gray-950 { background-color: var(--neutral-900) !important; }
      .theme-light .bg-gray-900 { background-color: var(--neutral-800) !important; }
      .theme-light .bg-gray-800 { background-color: var(--neutral-700) !important; }
      .theme-light .btn-primary-glow { color: #0f1412 !important; }
      .theme-light .settings-section,
      .theme-light .profile-header,
      .theme-light .home-plan-item,
      .theme-light .precaution-section,
      .theme-light .daily-task,
      .theme-light .logout-btn {
        background-color: var(--neutral-800) !important;
        border-color: rgba(0,0,0,0.08) !important;
      }
      .theme-light #loginPage {
        background:
          radial-gradient(900px 500px at 10% 10%, rgba(56,224,123,0.03), transparent 60%),
          radial-gradient(600px 400px at 85% 20%, rgba(34,197,94,0.03), transparent 60%);
      }

      body {
        margin: 0;
        font-family: "Public Sans", "Noto Sans", sans-serif;
        background: #111714;
        display: flex;
        justify-content: center;
        padding: 0;
        min-height: 100vh;
        overflow: hidden; /* hide page scrollbars */
        overflow-x: hidden;
      }
      html { overflow-x: hidden; }

      #appContainer {
        width: 375px;
        max-width: 100%;
        height: 100vh;
        background: #111714;
        border-radius: 20px;
        overflow: hidden; /* prevent side/bottom scrollbars */
        overflow-x: hidden;
        display: flex;
        flex-direction: column;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        position: relative;
      }
      #dashboardPage { overflow-x: hidden; }

      main {
        flex: 1;
        overflow-y: auto;
        padding: 12px;
        scrollbar-width: none;
        overflow-x: hidden;
      }
      /* Mobile-friendly selects */
      .form-group { overflow: visible; }
      .form-select {
        width: 100% !important;
        max-width: 100% !important;
        border-radius: 12px !important;
        -webkit-appearance: none !important;
        appearance: none !important;
        background-color: #29382f !important;
        color: #ffffff !important;
        border: 1px solid rgba(255,255,255,0.08) !important;
        padding: 10px 14px !important;
        white-space: nowrap !important;
        text-overflow: ellipsis !important;
        overflow: hidden !important;
      }
      /* Dark dropdown list items */
      .form-select option, .form-select optgroup {
        background-color: #111714 !important;
        color: #ffffff !important;
      }
      
      /* Custom dropdown arrow */
      .form-select {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e") !important;
        background-position: right 0.5rem center !important;
        background-repeat: no-repeat !important;
        background-size: 1.5em 1.5em !important;
        padding-right: 2.5rem !important;
      }
      #infoPage { overflow: visible; }
      .precaution-section { overflow: visible; }
      /* Hide vertical scrollbar for farmer form area */
      .fi-scroll { scrollbar-width: none; }
      .fi-scroll::-webkit-scrollbar { display: none; }
      main::-webkit-scrollbar {
        display: none;
      }

      .nav-link {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
        width: 20%;
        cursor: pointer;
        color: white;
      }
      .nav-active {
        color: var(--primary-500);
      }

      /* Hide scrollbar for schemes page */
      #schemesPage {
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE and Edge */
      }
      #schemesPage::-webkit-scrollbar {
        display: none; /* Chrome, Safari and Opera */
      }

      /* Calendar styles */
      .calendar-day {
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 36px;
        width: 36px;
        border-radius: 50%;
        margin: 0 auto;
      }
      .calendar-day:hover {
        background-color: rgba(56, 224, 123, 0.1);
      }
      .calendar-day.selected {
        background-color: var(--primary-500);
        color: #111714;
        font-weight: bold;
      }
      .calendar-day.has-expenses {
        background-color: var(--neutral-700);
      }
      .expense-item {
        transition: transform 0.2s ease;
      }
      .expense-item:hover {
        transform: translateX(5px);
      }

      /* Weather card clickable styling */
      .weather-card {
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        overflow: hidden;
      }
      
      .weather-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(56, 224, 123, 0.1), transparent);
        transition: left 0.5s;
      }
      
      .weather-card:hover {
        background-color: var(--neutral-700);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }
      
      .weather-card:hover::before {
        left: 100%;
      }
      
      .weather-card:active {
        transform: translateY(0);
      }

      /* Calendar quick actions - anchored inside mobile frame above footer (Settings tab area) */
      .calendar-buttons-container {
        position: absolute;
        bottom: 66px; /* just above bottom nav */
        right: 12px; /* align near Settings tab */
        display: flex;
        flex-direction: column; /* stack one above the other */
        gap: 10px;
        z-index: 40;
        pointer-events: none; /* container ignores clicks, buttons accept */
      }

      .add-expense-btn, .expense-summary-btn {
        width: 52px;
        height: 52px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
        pointer-events: auto; /* clickable */
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      .add-expense-btn {
        background-color: rgba(56, 224, 123, 0.55); /* faint primary */
        color: #0d1a14;
      }

      .expense-summary-btn {
        background-color: rgba(41, 56, 47, 0.55); /* faint neutral */
        color: #ffffff;
      }

      /* Home screen floating action button */
      .home-buttons-container {
        position: absolute;
        bottom: 80px; /* just above bottom nav */
        right: 12px; /* align near Settings tab */
        display: flex;
        flex-direction: column; /* stack one above the other */
        gap: 10px;
        z-index: 50;
        pointer-events: none; /* container ignores clicks, buttons accept */
      }

      .home-info-btn {
        width: 56px;
        height: 56px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        pointer-events: auto; /* clickable */
        border: 2px solid rgba(255, 255, 255, 0.2);
        background-color: var(--primary-500); /* bright primary */
        color: #0d1a14;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: bold;
      }

      /* Home: Today's Plan list */
      .home-plan {
        background-color: #111714;
        border-radius: 12px;
        padding: 12px;
      }
      .home-plan-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 10px;
        border-radius: 8px;
        background-color: var(--neutral-800);
        margin-bottom: 8px;
      }
      .home-plan-checkbox {
        width: 18px;
        height: 18px;
        flex-shrink: 0;
        accent-color: #22c55e; /* green */
      }
      .home-plan-item .task-title { color: white; font-size: 14px; font-weight: 600; }
      .home-plan-item .task-desc { color: var(--neutral-400); font-size: 12px; }

      .home-info-btn:hover {
        background-color: rgba(56, 224, 123, 0.9);
        transform: scale(1.1);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
      }

      /* Modal styles */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 100;
      }

      .modal-content {
        background-color: var(--neutral-800);
        border-radius: 16px;
        padding: 24px;
        width: 90%;
        /* keep popups within small mobile viewports */
        max-width: min(400px, 92vw);
        max-height: 85vh;
        overflow-y: auto;
        box-sizing: border-box;
        word-break: break-word;
      }

      .chart-container {
        position: relative;
        height: 250px;
        width: 100%;
        margin: 20px 0;
      }

      /* Settings page styles */
      .settings-section {
        background-color: var(--neutral-800);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 16px;
      }

      .settings-section h3 {
        color: white;
        font-weight: 600;
        margin-bottom: 12px;
        font-size: 16px;
      }

      .settings-item {
        display: flex;
        align-items: center;
        padding: 12px;
        border-radius: 8px;
        transition: background-color 0.2s;
        margin-bottom: 4px;
      }

      .settings-item:hover {
        background-color: var(--neutral-700);
      }

      .settings-icon {
        display: flex;
        width: 40px;
        height: 40px;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background-color: var(--neutral-700);
        margin-right: 12px;
      }

      .settings-text {
        flex: 1;
        color: white;
        font-size: 15px;
      }

      .settings-arrow {
        color: var(--neutral-400);
      }

      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 48px;
        height: 24px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--neutral-700);
        transition: .4s;
        border-radius: 24px;
      }

      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
      }

      input:checked + .toggle-slider {
        background-color: var(--primary-500);
      }

      input:checked + .toggle-slider:before {
        transform: translateX(24px);
      }

      .logout-btn {
        width: 100%;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        background-color: var(--neutral-800);
        color: var(--primary-500);
        font-weight: 600;
        font-size: 16px;
        margin-top: 20px;
        transition: all 0.2s;
      }

      .logout-btn:hover {
        background-color: rgba(239, 68, 68, 0.2);
        color: #ef4444;
      }

      /* Profile Page Styles */
      .profile-header {
        display: grid;
        grid-template-columns: 1fr max-content;
        align-items: center;
        padding: 16px;
        background-color: var(--neutral-800);
        border-radius: 12px;
        margin-bottom: 16px;
        gap: 12px;
      }

      .profile-info {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
        min-width: 0;
      }

      .profile-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid var(--primary-500);
      }

      .profile-name {
        color: white;
        font-weight: 600;
        font-size: 18px;
        display: block;
        max-width: 100%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .profile-email {
        color: var(--neutral-400);
        font-size: 14px;
        display: block;
        max-width: 100%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .coins-display {
        background-color: var(--neutral-700);
        padding: 8px 14px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
        position: relative;
        z-index: 60; /* ensure it stays above sticky header and other UI */
        white-space: nowrap;
        margin-left: auto; /* keep to the far right */
        flex-shrink: 0; /* prevent shrinking/overlap */
      }

      .coins-display .material-symbols-outlined {
        font-size: 20px;
        line-height: 1;
      }

      .coins-count {
        color: var(--primary-500);
        font-weight: 700;
      }
      /* Login Page Enhancements */
      #loginPage {
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background: radial-gradient(1200px 600px at 10% 10%, rgba(56,224,123,0.08), transparent 60%),
                    radial-gradient(800px 500px at 90% 20%, rgba(34,197,94,0.08), transparent 60%);
        box-sizing: border-box;
        padding: 16px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 16px;
        z-index: 30;
      }
      #loginPage.hidden { display: none !important; }
      .login-bottom-sheet {
        width: 100%;
        max-width: 520px;
        margin: 0 auto;
        background: transparent;
        border: none;
        border-radius: 0;
        box-shadow: none;
        padding: 0;
      }
      .login-bottom-sheet::-webkit-scrollbar { display: none; }
      .login-sheet {
        width: 100%;
        max-width: 480px;
        background: rgba(17, 24, 39, 0.75);
        border: 1px solid rgba(56, 224, 123, 0.15);
        border-top-left-radius: 24px;
        border-top-right-radius: 24px;
        border-bottom-left-radius: 24px;
        border-bottom-right-radius: 24px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.35), 0 0 40px rgba(56,224,123,0.08) inset;
      }
      .login-sheet-header {
        padding: 16px 24px 0 24px;
      }
      .login-sheet-body {
        padding: 0 24px 24px 24px;
      }
      .login-card {
        width: 100%;
        max-width: 440px;
        backdrop-filter: blur(10px);
        background: rgba(17, 24, 39, 0.72);
        border: 1px solid rgba(56, 224, 123, 0.14);
        box-shadow: 0 10px 30px rgba(0,0,0,0.35), 0 0 40px rgba(56,224,123,0.06) inset;
        border-radius: 16px;
        padding: 20px;
      }
      .btn-primary-glow {
        background: linear-gradient(90deg, var(--primary-500), #43e97b);
        color: var(--neutral-900);
        box-shadow: 0 8px 16px rgba(56,224,123,0.25);
      }
      .btn-primary-glow:hover { filter: brightness(1.05); }
      .btn-social {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        height: 44px;
        background: var(--neutral-800);
        border-radius: 12px;
        color: white;
      }
      .btn-social:hover { background: var(--neutral-700); }
      .divider {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        align-items: center;
        gap: 12px;
        color: var(--neutral-400);
        font-size: 12px;
      }
      .divider:before, .divider:after {
        content: "";
        height: 1px;
        background: linear-gradient(90deg, transparent, var(--neutral-700), transparent);
        display: block;
      }
      .login-badge {
        display: inline-flex; align-items: center; gap: 6px;
        background: rgba(56,224,123,0.12);
        border: 1px solid rgba(56,224,123,0.2);
        color: var(--primary-500);
        padding: 6px 10px; border-radius: 999px; font-size: 12px; font-weight: 600;
      }

      .profile-menu-item {
        display: flex;
        align-items: center;
        padding: 16px;
        background-color: var(--neutral-800);
        border-radius: 12px;
        margin-bottom: 12px;
        transition: all 0.2s;
      }

      .profile-menu-item:hover {
        background-color: var(--neutral-700);
        transform: translateX(5px);
      }

      .profile-menu-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--neutral-700);
        border-radius: 50%;
        margin-right: 12px;
        color: var(--primary-500);
      }

      .profile-menu-text {
        flex: 1;
        color: white;
        font-size: 16px;
        font-weight: 500;
      }

      .profile-menu-arrow {
        color: var(--neutral-400);
      }

      /* Overlay Pages Styles */
      #weatherPrecautionPage, #infoPage, #weeklyPlanPage, #pastTrackPage, #cropManagementPage, #cultivationGuidancePage, #expertContactsPage, #postDisasterPage, #userAddressPage, #editProfilePage, #demandForecastingPage, #listServicePage {
        position: absolute; /* inside app container */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--neutral-900);
        z-index: 1000;
        overflow-y: auto;
        padding: 16px 16px 24px 16px;
        transition: transform 0.28s ease-in-out;
        will-change: transform;
        box-sizing: border-box;
        /* Hide scrollbars visually */
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE/Edge */
      }
      #weatherPrecautionPage::-webkit-scrollbar, #infoPage::-webkit-scrollbar, #weeklyPlanPage::-webkit-scrollbar, #pastTrackPage::-webkit-scrollbar, #cropManagementPage::-webkit-scrollbar, #cultivationGuidancePage::-webkit-scrollbar, #expertContactsPage::-webkit-scrollbar, #postDisasterPage::-webkit-scrollbar, #userAddressPage::-webkit-scrollbar, #editProfilePage::-webkit-scrollbar, #demandForecastingPage::-webkit-scrollbar, #listServicePage::-webkit-scrollbar { display: none; }

      /* default: slide from bottom */
      #weatherPrecautionPage.from-bottom, #infoPage.from-bottom, #weeklyPlanPage.from-bottom, #pastTrackPage.from-bottom, #cropManagementPage.from-bottom, #cultivationGuidancePage.from-bottom, #expertContactsPage.from-bottom, #postDisasterPage.from-bottom, #userAddressPage.from-bottom, #editProfilePage.from-bottom, #demandForecastingPage.from-bottom, #listServicePage.from-bottom {
        transform: translateY(100%);
        border-top-left-radius: 16px;
        border-top-right-radius: 16px;
      }
      #weatherPrecautionPage.from-bottom.active, #infoPage.from-bottom.active, #weeklyPlanPage.from-bottom.active, #pastTrackPage.from-bottom.active, #cropManagementPage.from-bottom.active, #cultivationGuidancePage.from-bottom.active, #expertContactsPage.from-bottom.active, #postDisasterPage.from-bottom.active, #userAddressPage.from-bottom.active, #editProfilePage.from-bottom.active, #demandForecastingPage.from-bottom.active, #listServicePage.from-bottom.active {
        transform: translateY(0);
      }

      /* alternative: slide from right */
      #weatherPrecautionPage.from-right, #infoPage.from-right, #weeklyPlanPage.from-right, #pastTrackPage.from-right, #cropManagementPage.from-right, #cultivationGuidancePage.from-right, #expertContactsPage.from-right, #postDisasterPage.from-right, #userAddressPage.from-right, #editProfilePage.from-right, #demandForecastingPage.from-right, #listServicePage.from-right {
        transform: translateX(100%);
      }
      #weatherPrecautionPage.from-right.active, #infoPage.from-right.active, #weeklyPlanPage.from-right.active, #pastTrackPage.from-right.active, #cropManagementPage.from-right.active, #cultivationGuidancePage.from-right.active, #expertContactsPage.from-right.active, #postDisasterPage.from-right.active, #userAddressPage.from-right.active, #editProfilePage.from-right.active, #demandForecastingPage.from-right.active, #listServicePage.from-right.active {
        transform: translateX(0);
      }

      .precaution-header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        padding-top: 10px;
      }

      .back-button {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        margin-right: 15px;
      }

      .precaution-title {
        color: white;
        font-size: clamp(18px, 5vw, 20px);
        font-weight: 800;
        letter-spacing: 0.2px;
        word-wrap: break-word;
        overflow-wrap: anywhere;
      }

      .weather-icon-large {
        display: flex;
        justify-content: center;
        margin: 20px 0;
      }

      .weather-icon-large span {
        font-size: clamp(48px, 20vw, 72px);
        color: var(--primary-500);
      }

      .weather-type {
        text-align: center;
        color: white;
        font-size: clamp(16px, 5.5vw, 20px);
        font-weight: 800;
        margin-bottom: 6px;
        word-wrap: break-word;
        overflow-wrap: anywhere;
        padding: 0 4px;
      }

      .weather-temp {
        text-align: center;
        color: var(--primary-500);
        font-size: clamp(14px, 4.5vw, 18px);
        margin-bottom: 16px;
      }

      .precaution-section {
        background-color: var(--neutral-800);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 16px;
        position: relative;
        z-index: 1;
      }

      .precaution-section h3 {
        color: var(--primary-500);
        font-size: clamp(14px, 4.2vw, 16px);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        font-weight: 700;
      }

      .precaution-section h3 span {
        margin-right: 10px;
      }

      .precaution-list {
        color: white;
        padding-left: 16px;
        font-size: clamp(13px, 3.8vw, 15px);
        line-height: 1.55;
      }

      .precaution-list li {
        margin-bottom: 8px;
      }

      /* Form Styles */
      .form-group {
        margin-bottom: 16px;
        display: block;
        opacity: 1;
        visibility: visible;
      }

      .form-label {
        display: block;
        color: white;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 8px;
        opacity: 1;
        visibility: visible;
      }

      .form-select, .form-input {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--neutral-600);
        border-radius: 8px;
        background-color: var(--neutral-700);
        color: white;
        font-size: 14px;
        transition: all 0.2s ease;
        box-sizing: border-box;
        display: block;
        opacity: 1;
        visibility: visible;
      }

      .form-select:focus, .form-input:focus {
        outline: none;
        background-color: var(--neutral-600);
        box-shadow: 0 0 0 2px var(--primary-500);
      }

      .form-select option {
        background-color: var(--neutral-700);
        color: white;
        padding: 8px;
      }

      .plan-button {
        width: 100%;
        padding: 16px;
        background-color: var(--primary-500);
        color: var(--neutral-900);
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: all 0.2s ease;
        margin-top: 20px;
        opacity: 1;
        visibility: visible;
        position: relative;
        z-index: 2;
      }
      /* keep weekly page content and popups inside viewport on mobile */
      #weeklyPlanPage .precaution-section { overflow: hidden; }
      @media (max-width: 420px) {
        .modal-content { max-width: 94vw; }
        #weeklyPlanPage { padding-left: 12px; padding-right: 12px; }
      }

      /* Demand Forecasting Page Styles */
      #demandForecastingPage .precaution-section { overflow: visible; }
      
      /* List Service Page Styles */
      #listServicePage .precaution-section { overflow: visible; }
      
      .forecast-card {
        background-color: var(--neutral-700);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }
      
      .forecast-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      }
      
      .forecast-form input,
      .forecast-form select {
        transition: all 0.3s ease;
      }
      
      .forecast-form input:focus,
      .forecast-form select:focus {
        transform: scale(1.02);
        box-shadow: 0 0 0 3px rgba(56, 224, 123, 0.2);
      }
      
      .risk-low {
        color: #10b981;
        background-color: rgba(16, 185, 129, 0.1);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
      }
      
      .risk-medium {
        color: #f59e0b;
        background-color: rgba(245, 158, 11, 0.1);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
      }
      
      .risk-high {
        color: #ef4444;
        background-color: rgba(239, 68, 68, 0.1);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
      }
      
      .chart-container {
        position: relative;
        height: 200px;
        width: 100%;
      }
      
      .export-button {
        background: linear-gradient(135deg, var(--primary-500), #22c55e);
        transition: all 0.3s ease;
      }
      
      .export-button:hover {
        background: linear-gradient(135deg, #22c55e, var(--primary-500));
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(56, 224, 123, 0.3);
      }
      
      @media (max-width: 420px) {
        #demandForecastingPage { padding-left: 12px; padding-right: 12px; }
        .chart-container { height: 180px; }
        .forecast-card { padding: 12px; }
      }

      /* Form Select Styling */
      .form-select {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2338e07b' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 0.5rem center;
        background-repeat: no-repeat;
        background-size: 1.5em 1.5em;
        padding-right: 2.5rem;
      }

      .plan-button:hover {
        background-color: rgba(56, 224, 123, 0.9);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(56, 224, 123, 0.3);
      }

      .plan-button:active {
        transform: translateY(0);
      }

      .plan-week {
        background-color: var(--neutral-700);
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 12px;
        border-left: 4px solid var(--primary-500);
      }

      .plan-week h4 {
        color: var(--primary-500);
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 8px;
      }

      .plan-week p {
        color: white;
        font-size: 14px;
        line-height: 1.4;
      }

      .daily-task {
        background-color: var(--neutral-800);
        border-radius: 6px;
        padding: 10px;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .daily-checkbox {
        width: 18px;
        height: 18px;
        margin-top: 2px;
        accent-color: #22c55e; /* green */
        flex-shrink: 0;
      }

      .daily-task .task-icon {
        color: var(--primary-500);
        font-size: 20px;
        transition: color 0.2s ease, text-shadow 0.2s ease, transform 0.15s ease;
      }
      .task-icon.icon-glow {
        color: var(--primary-500);
        text-shadow: 0 0 8px rgba(74, 222, 128, 0.6);
        transform: scale(1.05);
      }

      .daily-task .task-content {
        flex: 1;
      }

      .daily-task .task-title {
        color: white;
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 2px;
      }

      .daily-task .task-desc {
        color: var(--neutral-400);
        font-size: 12px;
      }

      /* Force form elements to be visible */
      #infoPage .form-group,
      #infoPage .form-label,
      #infoPage .form-select,
      #infoPage .form-input,
      #infoPage .plan-button {
        display: block !important;
        opacity: 1 !important;
        visibility: visible !important;
        position: relative !important;
        z-index: 10 !important;
      }

      #infoPage .form-select,
      #infoPage .form-input {
        background-color: var(--neutral-700) !important;
        color: white !important;
        border: 1px solid var(--neutral-600) !important;
      }

      /* Plantation Bottom Bar Styles */
      .plantation-bottom-bar {
        position: fixed;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 375px;
        max-width: 100%;
        background-color: var(--neutral-800);
        border-top: 1px solid var(--neutral-700);
        padding: 12px 16px;
        z-index: 100;
        box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);
      }

      .bottom-bar-content {
        display: flex;
        justify-content: space-around;
        align-items: center;
      }

      .bottom-bar-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        padding: 8px 12px;
        border-radius: 8px;
        transition: all 0.2s ease;
        cursor: pointer;
        min-width: 80px;
      }

      .bottom-bar-item:hover {
        background-color: var(--neutral-700);
        transform: translateY(-2px);
      }

      .bottom-bar-item .material-symbols-outlined {
        font-size: 20px;
        color: var(--primary-500);
      }

      .bottom-bar-item span:last-child {
        font-size: 11px;
        color: white;
        font-weight: 500;
        text-align: center;
      }

      .bottom-bar-item.active {
        background-color: var(--primary-500);
        color: var(--neutral-900);
      }

      .bottom-bar-item.active .material-symbols-outlined {
        color: var(--neutral-900);
      }

      .bottom-bar-item.active span:last-child {
        color: var(--neutral-900);
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div id="appContainer">

      <!-- LANDING PAGE (first screen before login) -->
      <div id="landingPage" class="flex flex-col items-center justify-center flex-grow px-6 py-8 relative">
        <img src="https://lh3.googleusercontent.com/aida-public/AB6AXuD5NssK1LbG9CdSfscyHVLB3Vn4qg8e-F01ZSQFnEiLIZANaPOvsLiiNmhuJ8p88Jqu2XT3qqe-oWlWiLzDSy6IRukcR4JA5EqkOg0XfKyNAFuKXw_IVMIoXhrh6xM3-ognibLYgMD_RrUjBPqe66aiu7UMGxq1LXPs4Zv6GimzBSF3AT9jWqscurW7MsI68kIFdM_797vxxTp9fQsc_kC-ZJ0Lg8MZOUkv6FxiLmymcJVAHnlexqfQ-DiYQLWP2xhiuCK63zxu0ytx" alt="Background field" class="absolute inset-0 h-full w-full object-cover opacity-40" />
        <div class="relative z-10 flex flex-col items-center gap-4 text-center mb-12">
          <div class="bg-black/60 p-5 rounded-full backdrop-blur-sm">
            <span class="material-symbols-outlined text-8xl text-[var(--primary-500)]">eco</span>
          </div>
          <h1 class="text-white text-5xl font-bold tracking-tight">Satwik</h1>
        </div>
        <div class="relative z-10 w-full max-w-sm space-y-4">
          <div>
            <label for="landingLang" class="text-white/80 text-sm mb-1 block">Select Language</label>
            <select id="landingLang" class="form-select">
              <option value="">Choose language</option>
              <option value="en">English</option>
              <option value="hi">Hindi</option>
              <option value="pa">Punjabi</option>
              <option value="ml">Malayalam</option>
            </select>
          </div>
          <div>
            <label for="landingEmail" class="sr-only">Email</label>
            <input id="landingEmail" type="email" placeholder="Email" class="w-full bg-black/50 backdrop-blur-sm text-white placeholder:text-[#9eb7a8] border border-[#29382f] rounded-xl px-4 py-3 focus:ring-2 focus:ring-[var(--primary-500)] focus:border-[var(--primary-500)] transition-colors" />
          </div>
          <div>
            <label for="landingPhone" class="sr-only">Phone Number</label>
            <input id="landingPhone" type="tel" placeholder="Phone Number" class="w-full bg-black/50 backdrop-blur-sm text-white placeholder:text-[#9eb7a8] border border-[#29382f] rounded-xl px-4 py-3 focus:ring-2 focus:ring-[var(--primary-500)] focus:border-[var(--primary-500)] transition-colors" />
          </div>
          <div class="pt-4 space-y-5">
            <button id="enterFarmer" class="flex w-full cursor-pointer items-center justify-center rounded-xl h-14 px-5 bg-[var(--primary-500)] text-[var(--neutral-900)] text-lg font-bold tracking-wide hover:bg-opacity-90 transition-colors">Enter as a Farmer</button>
          </div>
        </div>
      </div>

      <!-- Expert Contacts Page (in-app) -->
      <div id="expertContactsPage" class="hidden from-bottom">
        <div class="precaution-header">
          <button class="back-button" id="backFromExpertContacts">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="precaution-title">Expert Contacts</h2>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">support_agent</span> Our Experts</h3>
          <div class="p-2 space-y-4">
            <div class="bg-[var(--neutral-800)] p-4 rounded-lg flex items-start space-x-4">
              <img alt="Dr. Canchal Kotwal" class="w-16 h-16 rounded-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuClgOKB08kBjYfBodM-sf3yeTmY9rcwAGcjnqymEj8-y_K0te5J5DqESeVxof0rmF4ilHiUMqgfiliIBai156PbbD49OwSQUxmmxcLjemgVGUIlEEsmkHCe1kzyFi8Iym1XqW-9eFxjKwkaQZFijVWO64IhCKJM4j4S_-MbI2qrPqPe-ghLvb1JmX91g13igixW73motNmeimR8x88HAUnpv6iiCE-b6SCreadpnPNVpRrTPnGS_XEmUKsD9YgWFZUBu0hUaFCUYiOH"/>
              <div class="flex-1">
                <h4 class="font-bold text-lg text-white">Dr. Canchal Kotwa</h4>
                <p class="text-sm text-[var(--neutral-400)]">15 years of experience</p>
                <div class="mt-2 space-y-1 text-sm text-[var(--neutral-300)]">
                  <div class="flex items-center space-x-2">
                    <span class="material-symbols-outlined text-sm text-[var(--primary-500)]">call</span>
                    <a class="hover:underline" href="tel:+1-555-123-4567">+1-555-123-4567</a>
                  </div>
                  <div class="flex items-center space-x-2">
                    <span class="material-symbols-outlined text-sm text-[var(--primary-500)]">mail</span>
                    <a class="hover:underline" href="mailto:expert1@example.com">chanchalkotwal@example.com</a>
                  </div>
                </div>
              </div>
            </div>

            <div class="bg-[var(--neutral-800)] p-4 rounded-lg flex items-start space-x-4">
              <img alt="Prof. Aditya Girhe" class="w-16 h-16 rounded-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAeM7hA6IuCeftWtLX4pgLzchJeHAsxSHCY2GY1SjzykGolmOFZCbB37KFhEHDdJrhKwo0qe41u-Se0RBdUBja782NC3Dy9ViqOsgkGb-X9IngmcQL6A40ZrGfFjXx7Jbz5VPAGjtuBHezSUWmWh5far6FwofQ8U4AXMF07wkq7-CQWkvUfaZFHag4Z3CjQJks9i9P_admCp-H0ot67Jc-2opUx-Yo6dfA-g-8HKDd1ba_uffs4iNByGNpA7OzNWDQvwxhQ__8RTiZq"/>
              <div class="flex-1">
                <h4 class="font-bold text-lg text-white">Prof. Aditya Girhe</h4>
                <p class="text-sm text-[var(--neutral-400)]">20 years of experience</p>
                <div class="mt-2 space-y-1 text-sm text-[var(--neutral-300)]">
                  <div class="flex items-center space-x-2">
                    <span class="material-symbols-outlined text-sm text-[var(--primary-500)]">call</span>
                    <a class="hover:underline" href="tel:+1-555-987-6543">+1-555-987-6543</a>
                  </div>
                  <div class="flex items-center space-x-2">
                    <span class="material-symbols-outlined text-sm text-[var(--primary-500)]">mail</span>
                    <a class="hover:underline" href="mailto:expert2@example.com">adityagirhe@example.com</a>
                  </div>
                </div>
              </div>
            </div>

            <div class="bg-[var(--neutral-800)] p-4 rounded-lg flex items-start space-x-4">
              <img alt="Dr. Sakshi Mane" class="w-16 h-16 rounded-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAhOjmSbIq_tXtBf2Z_A_mwfOOta6HVtrOae4HnGDkclLnpHggQRtPdmVYByY1bN3NNXr-J3tlWs9woYeHAjz7OqGysSODjVYjAjBibs1JY14-_rDB8fsNyiXftwlh1MGCGOpCA6yEO1EHIriAa7Z_TncdF4p0vny90BjieBO2xX80z10s4MHjDK_03piVN8sTP-Zg-SVYtBTDJQ7xb7xr4hoAV-gMAxrDS5pxiKNHdfKozKiW5H3L379kKfswrhecG-1T3a5kkRVTJ"/>
              <div class="flex-1">
                <h4 class="font-bold text-lg text-white">Dr. Sakshi Mane</h4>
                <p class="text-sm text-[var(--neutral-400)]">10 years of experience</p>
                <div class="mt-2 space-y-1 text-sm text-[var(--neutral-300)]">
                  <div class="flex items-center space-x-2">
                    <span class="material-symbols-outlined text-sm text-[var(--primary-500)]">call</span>
                    <a class="hover:underline" href="tel:+1-555-246-8013">+1-555-246-8013</a>
                  </div>
                  <div class="flex items-center space-x-2">
                    <span class="material-symbols-outlined text-sm text-[var(--primary-500)]">mail</span>
                    <a class="hover:underline" href="mailto:expert3@example.com">sakshimane@example.com</a>
                  </div>
                </div>
              </div>
            </div>

            <div class="bg-[var(--neutral-800)] p-4 rounded-lg flex items-start space-x-4">
              <img alt="Dr. Om Devar" class="w-16 h-16 rounded-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDsyjxYkOevL8kjF24V-prjm3hgjhlRK1PchBQVZ0-66ypsFXV45p9UH5K7W2nCW3tFnyzg64f9RVTnOBf4_WJWBYyoRr9SQNfIqVOeJDk4uAclepIaSivjTqU-xbtXWRS6A6PfUzpEiQOW22NjWWipBmLiezC0alTvOJNNDljO6Eio9qtHnewR89xkQoCx0DlZryh6mbGZqUOPfjw-2Xnp7OMOu5Rrho-yiFkx8yC7kDT6C-LfF1QMy_WOJ4dilKtgsn5v01h0aoVD"/>
              <div class="flex-1">
                <h4 class="font-bold text-lg text-white">Dr. Om Devar</h4>
                <p class="text-sm text-[var(--neutral-400)]">25 years of experience</p>
                <div class="mt-2 space-y-1 text-sm text-[var(--neutral-300)]">
                  <div class="flex items-center space-x-2">
                    <span class="material-symbols-outlined text-sm text-[var(--primary-500)]">call</span>
                    <a class="hover:underline" href="tel:+1-555-135-7911">+1-555-135-7911</a>
                  </div>
                  <div class="flex items-center space-x-2">
                    <span class="material-symbols-outlined text-sm text-[var(--primary-500)]">mail</span>
                    <a class="hover:underline" href="mailto:expert4@example.com">omdevar@example.com</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- User Address Page (in-app) -->
      <div id="userAddressPage" class="hidden from-bottom">
        <div class="precaution-header">
          <button class="back-button" id="backFromUserAddress">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="precaution-title">User Address</h2>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">location_on</span> Address Information</h3>
          <div class="p-2 space-y-4">
            <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
              <div class="flex items-start space-x-3">
                <span class="material-symbols-outlined text-[var(--primary-500)] mt-1">home</span>
                <div class="flex-1">
                  <h4 class="text-white font-semibold mb-2">Current Address</h4>
                  <p id="userAddressDisplay" class="text-[var(--neutral-300)] text-sm leading-relaxed">No address information available. Please update your profile.</p>
                </div>
              </div>
            </div>
            
            <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
              <div class="flex items-start space-x-3">
                <span class="material-symbols-outlined text-[var(--primary-500)] mt-1">person</span>
                <div class="flex-1">
                  <h4 class="text-white font-semibold mb-2">Contact Information</h4>
                  <p id="userContactDisplay" class="text-[var(--neutral-300)] text-sm">No contact information available.</p>
                </div>
              </div>
            </div>

            <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
              <div class="flex items-start space-x-3">
                <span class="material-symbols-outlined text-[var(--primary-500)] mt-1">agriculture</span>
                <div class="flex-1">
                  <h4 class="text-white font-semibold mb-2">Farm Location</h4>
                  <p id="farmLocationDisplay" class="text-[var(--neutral-300)] text-sm">No farm location information available.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit Profile Page (in-app) -->
      <div id="editProfilePage" class="hidden from-bottom">
        <div class="precaution-header">
          <button class="back-button" id="backFromEditProfile">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="precaution-title">Edit Profile</h2>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">person</span> Personal Information</h3>
          <div class="p-2 space-y-4">
            <div>
              <label class="text-[#9eb7a8] text-sm mb-1 block" for="ep_name">Full Name</label>
              <input id="ep_name" type="text" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10 placeholder:text-white/40" placeholder="Enter your full name" />
            </div>
            <div>
              <label class="text-[#9eb7a8] text-sm mb-1 block" for="ep_email">Email Address</label>
              <input id="ep_email" type="email" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10 placeholder:text-white/40" placeholder="Enter your email" />
            </div>
            <div>
              <label class="text-[#9eb7a8] text-sm mb-1 block" for="ep_phone">Phone Number</label>
              <input id="ep_phone" type="tel" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10 placeholder:text-white/40" placeholder="Enter your phone number" />
            </div>
            <div>
              <label class="text-[#9eb7a8] text-sm mb-1 block" for="ep_address">Address</label>
              <textarea id="ep_address" rows="3" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10 placeholder:text-white/40" placeholder="Enter your complete address"></textarea>
            </div>
          </div>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">agriculture</span> Farm Information</h3>
          <div class="p-2 space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-[#9eb7a8] text-sm mb-1 block" for="ep_age">Age</label>
                <input id="ep_age" type="number" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10 placeholder:text-white/40" placeholder="Age" />
              </div>
              <div>
                <label class="text-[#9eb7a8] text-sm mb-1 block" for="ep_gender">Gender</label>
                <select id="ep_gender" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10">
                  <option value="">Select Gender</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>
            <div>
              <label class="text-[#9eb7a8] text-sm mb-1 block" for="ep_land_size">Land Size</label>
              <input id="ep_land_size" type="text" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10 placeholder:text-white/40" placeholder="e.g., 5 acres" />
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-[#9eb7a8] text-sm mb-1 block" for="ep_land_type">Land Type</label>
                <select id="ep_land_type" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10">
                  <option value="">Select Land Type</option>
                  <option value="irrigated">Irrigated</option>
                  <option value="rainfed">Rainfed</option>
                  <option value="mixed">Mixed</option>
                </select>
              </div>
              <div>
                <label class="text-[#9eb7a8] text-sm mb-1 block" for="ep_soil_type">Soil Type</label>
                <select id="ep_soil_type" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10">
                  <option value="">Select Soil Type</option>
                  <option value="clay">Clay</option>
                  <option value="sandy">Sandy</option>
                  <option value="loamy">Loamy</option>
                  <option value="black">Black Soil</option>
                </select>
              </div>
            </div>
            <div>
              <label class="text-[#9eb7a8] text-sm mb-1 block" for="ep_water_source">Water Source</label>
              <select id="ep_water_source" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10">
                <option value="">Select Water Source</option>
                <option value="borewell">Borewell</option>
                <option value="canal">Canal</option>
                <option value="pond">Pond</option>
                <option value="rainwater">Rainwater</option>
              </select>
            </div>
          </div>
        </div>

        <div class="p-4" style="position:sticky;bottom:0;z-index:2;background:rgba(17,23,20,0.85);backdrop-filter:blur(6px);">
          <button id="saveProfileBtn" class="w-full bg-[var(--primary-500)] text-[var(--neutral-900)] font-bold py-4 rounded-lg text-center">Save Changes</button>
        </div>
      </div>

      <!-- Post-Disaster Help Page (in-app) -->
      <div id="postDisasterPage" class="hidden from-bottom">
        <div class="precaution-header">
          <button class="back-button" id="backFromPostDisaster">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="precaution-title">Post-Disaster Help</h2>
        </div>

        <!-- Quick Actions -->
        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">emergency</span> Quick Actions</h3>
          <div class="p-2 grid" style="grid-template-columns:1fr 1fr; gap:12px;">
            <button class="w-full bg-[var(--primary-500)] text-[var(--neutral-900)] rounded-md p-3 font-semibold">Report Damage</button>
            <button class="w-full bg-[var(--neutral-700)] text-white rounded-md p-3 font-semibold">Request Expert Help</button>
            <button class="w-full bg-[var(--neutral-700)] text-white rounded-md p-3 font-semibold">Apply for Government Relief</button>
            <button class="w-full bg-[var(--neutral-700)] text-white rounded-md p-3 font-semibold">Community Support</button>
          </div>
        </div>

        <!-- Relief Guidelines -->
        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">menu_book</span> Relief Guidelines</h3>
          <div class="p-2 space-y-3">
            <details class="rounded-lg bg-[var(--neutral-800)]">
              <summary class="cursor-pointer list-none p-4 font-medium flex items-center justify-between">Flood Recovery <span class="material-symbols-outlined">expand_more</span></summary>
              <div class="border-t border-[var(--neutral-700)] p-4 text-[var(--neutral-300)] text-sm">Detailed steps and precautions for recovering your farm after a flood. Includes soil testing, crop selection, and financial aid guidance.</div>
            </details>
            <details class="rounded-lg bg-[var(--neutral-800)]">
              <summary class="cursor-pointer list-none p-4 font-medium flex items-center justify-between">Drought Recovery <span class="material-symbols-outlined">expand_more</span></summary>
              <div class="border-t border-[var(--neutral-700)] p-4 text-[var(--neutral-300)] text-sm">Guidance on water conservation, choosing drought-resistant crops, and accessing government schemes for drought-affected farmers.</div>
            </details>
            <details class="rounded-lg bg-[var(--neutral-800)]">
              <summary class="cursor-pointer list-none p-4 font-medium flex items-center justify-between">Pest Infestation Recovery <span class="material-symbols-outlined">expand_more</span></summary>
              <div class="border-t border-[var(--neutral-700)] p-4 text-[var(--neutral-300)] text-sm">Strategies for identifying, controlling, and preventing pest infestations. Learn about integrated pest management and safe pesticide use.</div>
            </details>
          </div>
        </div>

        <!-- Emergency Contacts -->
        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">call</span> Emergency Contacts</h3>
          <div class="p-2 space-y-2">
            <div class="flex items-center justify-between bg-[var(--neutral-800)] p-3 rounded-md"><span>Disaster Helpline</span><a class="text-[var(--primary-500)]" href="tel:1070">1070</a></div>
            <div class="flex items-center justify-between bg-[var(--neutral-800)] p-3 rounded-md"><span>Agriculture Department</span><a class="text-[var(--primary-500)]" href="tel:18001234567">1800-123-4567</a></div>
          </div>
        </div>

        <!-- Support Videos -->
        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">smart_display</span> Support Videos</h3>
          <div class="p-2">
            <div class="flex snap-x snap-mandatory gap-4 overflow-x-auto pb-2 [-ms-scrollbar-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden">
              <div class="flex w-3/4 flex-none snap-center flex-col gap-2 sm:w-1/2">
                <div class="aspect-video w-full rounded-lg bg-cover bg-center" style='background-image:url("https://lh3.googleusercontent.com/aida-public/AB6AXuBYB9AySfH7eyV9M-Wv8e6_KO61NJnz8iSFYR431QlAOEzxMeyIa0uoinXOLTiT80e3FUOT8nVA5FiZmRln84UXKwWiKp5ozvk0xoKcA_daGFa4aTFHWdiOutsP4_J6K3BA6041MNwePmMCFC6iikRDReU73FGOdMC6HfHvXfOvQp9WhfeRqqQSPQuiqU0ULRBOgQCrULUttV4wXgy_qXTsvN0prieSyKOzjYZQZ0_7oHc0__qMKCFaIG5_OqBlJjjVlFp8yWkxTVIj");'></div>
                <h4 class="font-medium text-white">Assessing Flood Damage</h4>
              </div>
              <div class="flex w-3/4 flex-none snap-center flex-col gap-2 sm:w-1/2">
                <div class="aspect-video w-full rounded-lg bg-cover bg-center" style='background-image:url("https://lh3.googleusercontent.com/aida-public/AB6AXuAS1phi9jKsONSM3aaYAH3UrVmxGs6Kd2tCaYR8kbV2ordQBlyOGF_unce-xkYIaJYwcKgyfcm5g5o16drbeCu9tag0pfPYX6utvrdpbZdRmWidwHeoR6WEB2WElOkTuvXykSCwFhqTCPHnYM5a502Q17bmwZMKENWi3iPX-qKcYYMClrN_vOraI9V9N9ZgEtbP3koT9Uy5VG1mdcMkWlkiI8jKj791lc_25xyPU6kdqtn6ix1YoXp47LBiKd1EeU5_x0maoZzwgACS");'></div>
                <h4 class="font-medium text-white">Government Relief Programs</h4>
              </div>
              <div class="flex w-3/4 flex-none snap-center flex-col gap-2 sm:w-1/2">
                <div class="aspect-video w-full rounded-lg bg-cover bg-center" style='background-image:url("https://lh3.googleusercontent.com/aida-public/AB6AXuABjMD5tjUmBFA5yyQaMC5zKrFkd8bha8VbHcw_6eYwECo4R4UgC7fkxBh-e16x-QNfL73QNVzrMUXJN0b19R-MYdoIFSh-0upe-dDjQuQEtlLkGZLYLNviCFl0EGa_rEo715aM-4ClBqVJtQjXmWUzgGS0NIcp3JdHHAminDDpYpWvTx08qSayG9SqK_GAieQtG4wX81VfiHrx-4IBgzHC9itCzJlyKQLTeSeFIq9Iz8mRKbTf_qzQQHjyqMEvaCSywmxkhseARGzX");'></div>
                <h4 class="font-medium text-white">Community Support Initiatives</h4>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- LOGIN PAGE -->
      <div id="loginPage" class="hidden flex flex-col items-center justify-center flex-grow px-2 py-2">
        <div class="login-bottom-sheet">
        <div class="flex flex-col items-center gap-2 text-center mb-4">
          <span class="material-symbols-outlined text-6xl text-[var(--primary-500)]">eco</span>
          <h1 class="text-white text-3xl font-bold tracking-tight">Satwik</h1>
        </div>
        <div class="login-card">
          <div class="w-full space-y-4">
            <div>
              <input id="loginEmail" class="form-input w-full rounded-xl border-none bg-[var(--neutral-800)] h-14 pl-4 pr-10 text-white placeholder:text-[var(--neutral-400)] focus:ring-2 focus:ring-inset focus:ring-[var(--primary-500)]" placeholder="Email or Username" type="email" aria-label="Email or Username" />
              <p class="mt-2 text-xs text-[var(--neutral-400)]">Use your registered email or username.</p>
            </div>
            <div class="relative">
              <input id="loginPassword" class="form-input w-full rounded-xl border-none bg-[var(--neutral-800)] h-14 pl-4 pr-12 text-white placeholder:text-[var(--neutral-400)] focus:ring-2 focus:ring-inset focus:ring-[var(--primary-500)]" placeholder="Password" type="password" aria-label="Password" />
              <button id="togglePassword" type="button" aria-label="Show password" class="absolute inset-y-0 right-3 flex items-center text-[#9eb7a8] hover:text-white">
                <span id="togglePasswordIcon" class="material-symbols-outlined">visibility_off</span>
              </button>
            </div>
            <div class="flex items-center justify-between text-sm">
              <label class="inline-flex items-center gap-2 text-[var(--primary-500)] font-semibold">
                <input id="loginRemember" type="checkbox" class="h-4 w-4 rounded border-[var(--neutral-600)] bg-[var(--neutral-800)] accent-[var(--primary-500)]" />
                <span>Remember me</span>
              </label>
              <button id="forgotPasswordBtn" type="button" class="text-[var(--primary-500)] hover:underline">Forgot password?</button>
            </div>
            <button id="loginBtn" class="flex w-full cursor-pointer items-center justify-center rounded-xl h-14 px-5 btn-primary-glow text-[var(--neutral-900)] text-base font-bold tracking-wide transition-colors">Login</button>
            <div class="divider mt-2"><span>or continue with</span></div>
            <div class="grid grid-cols-2 gap-3">
              <button class="btn-social"><img alt="G" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="h-5 w-5"/> Google</button>
              <button class="btn-social"><span class="material-symbols-outlined">call</span> Phone</button>
            </div>
          </div>
          <div class="flex flex-col items-center justify-center mt-6">
            <p class="text-[var(--neutral-400)] text-sm mb-4">Don't have an account?</p>
            <button class="flex w-full cursor-pointer items-center justify-center overflow-hidden rounded-xl h-12 px-5 bg-[var(--neutral-800)] text-white text-base font-medium tracking-wide hover:bg-[var(--neutral-700)] transition-colors">Sign Up</button>
            
          </div>
        </div>
        </div>
      </div>

      <!-- INTRO SCREENS (shown after login, before dashboard) -->
      <div id="intro1" class="hidden">
        <div class="relative flex h-screen min-h-screen w-full flex-col justify-between overflow-x-hidden">
          <div class="flex flex-col items-center justify-center pt-16 px-6 text-center">
            <h1 class="text-5xl font-bold text-white">Satwik</h1>
            <p class="mt-2 text-lg text-gray-300">Your trusted partner in farming</p>
          </div>
          <div class="absolute inset-0 pointer-events-none">
            <div class="w-full h-full bg-center bg-no-repeat bg-cover" style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuCxcGodB4byyuVxuMFQwvCehEDQQR0VS_-CL9b0k22IiSXgObLCTKIiqw0jX-x-8zPjF3L77Lx7t2AVBiK1vwX3RHGR4WSbFUI_JAcKdQU1g7Jas2nPnk05CbqvthsT3DwzIt3V7L5JG-BpvDkOiZpotfMiGSCSAjd7Mp1Q9MMs5TO5M1Y965C8mDwl7AqMNIjNvbs2i45ZHTh0Wx4y55KVicHfQ9fzjqOFHNx_Z2xHy8-5XZQXjHmcteD2S751FSNl6cjr-5Vdha-Z'); opacity: 0.2;"></div>
          </div>
          <div class="px-6 pb-12">
            <div class="flex items-center justify-center space-x-4">
              <button id="intro1Skip" class="flex w-full items-center justify-center rounded-xl h-14 px-5 bg-gray-700 text-white text-lg font-bold tracking-wide shadow-lg">
                <span>Skip</span>
              </button>
              <button id="intro1Next" class="flex w-full items-center justify-center rounded-xl h-14 px-5 bg-[var(--primary-500)] text-[var(--neutral-900)] text-lg font-bold tracking-wide shadow-lg">
                <span>Next</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="intro2" class="hidden">
        <div class="relative flex min-h-screen w-full flex-col justify-between">
          <div class="flex-grow">
            <div class="relative w-full h-80">
              <div class="absolute inset-0 bg-center bg-no-repeat bg-cover" style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuBy-5-1VrLPi0ZxVe54CrAhb-kh1rte5enG0OqoxrghAMs1OY7DjPwagOxu8ExEeIaCK8Tgq_wBvQM72QQEecgfWr_Zzn6CeBiMNz5jDUwYDwZtnfA0DBLIJJ2bc0vLUX9AgaTmlS8eBnAZ1BiL6__FB-9EcjwZ6vKw3vqbyYuNBlCBb5GjoVRtaO_BTgCCo8A11NqETdK2GKl7EAjpQNTQ1xZLOPlyGxSEpaI348_MDAECZ_9XNUPIb68AjZ1j2s0pUvAO8rx1W80i');">
              <div class="absolute inset-0 bg-black/30 pointer-events-none"></div>
              </div>
            </div>
            <div class="px-6 py-8 text-center">
              <h2 class="text-3xl font-bold text-white">Track Your Farm's Progress</h2>
              <p class="mt-4 text-base text-gray-300">Monitor your farm's activities and growth with Satwik. Stay informed about your crops' health and progress.</p>
            </div>
          </div>
          <div class="px-6 pb-8 pt-4">
            <div class="flex items-center justify-center mb-6 space-x-2">
              <div class="w-2 h-2 rounded-full bg-gray-600"></div>
              <div class="w-2 h-2 rounded-full bg-[var(--primary-500)]"></div>
              <div class="w-2 h-2 rounded-full bg-gray-600"></div>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <button id="intro2Skip" class="flex w-full cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-transparent text-gray-300 text-base font-bold tracking-wide border border-gray-700 hover:bg-gray-800"> 
                <span class="truncate">Skip</span>
              </button>
              <button id="intro2Next" class="flex w-full cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-[var(--primary-500)] text-[var(--neutral-900)] text-base font-bold tracking-wide">
                <span class="truncate">Next</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="intro3" class="hidden">
        <div class="flex flex-col h-screen">
          <div class="relative flex-grow">
            <div class="absolute inset-0">
              <img alt="Lush green crops in a field, representing modern farming." class="w-full h-full object-cover pointer-events-none" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAVQUbHG3L7QPrsdywCY9-wX0OeSDETZ0Y_nMltGEEDXDCU8VVMG1NrbFseyaJcTLsklu2ASma0C5PdCrTm2boXVjUUqhaZ5PyVJG4F6U3NIIxbKNdNoZ63bYBBLy-m5B8O0X--npU4u4z3Ksq6yF7uRel7yAKdGSZSF5h1yzWVk_rwch6jzzMWSq3nrvrhZdLmt_pRyGvdZhP-dCvdhL_6jtsMBaiD9aOB9C4mZ5dZ7c8LvawtjtcDaoMeayXCQTjlZehWjxMNmxxw" />
              <div class="absolute inset-0 bg-gradient-to-t from-[#122017] to-transparent opacity-80 pointer-events-none"></div>
            </div>
          </div>
          <div class="relative bg-[var(--neutral-800)] text-center px-6 pt-8 pb-4 rounded-t-xl -mt-16 z-10">
            <h1 class="text-3xl font-bold text-white">Access Expert Advice</h1>
            <p class="mt-2 text-base text-[var(--neutral-300)]">
              Get instant answers to your farming questions with Atvik AI, your personal farming assistant.
            </p>
            <div class="flex justify-center space-x-2 my-8">
              <div class="w-2 h-2 rounded-full bg-[var(--neutral-600)]"></div>
              <div class="w-2 h-2 rounded-full bg-[var(--neutral-600)]"></div>
              <div class="w-2 h-2 rounded-full bg-[var(--primary-500)]"></div>
            </div>
            <div class="flex justify-between items-center space-x-4">
              <button id="intro3Skip" class="flex-1 px-6 py-3 rounded-lg text-[var(--neutral-300)] bg-[var(--neutral-700)] font-semibold text-sm hover:bg-[var(--neutral-600)] transition-colors">Skip</button>
              <button id="intro3Next" class="flex-1 px-6 py-3 rounded-lg bg-[var(--primary-500)] text-[var(--neutral-900)] font-semibold text-sm hover:bg-[var(--primary-400)] transition-colors">Next</button>
            </div>
          </div>
        </div>
      </div>

      <!-- FARMER INFO PAGE (after intros) -->
      <div id="farmerInfoPage" class="hidden from-bottom">
        <div class="absolute inset-0 pointer-events-none" style="z-index:0;">
          <div class="w-full h-full bg-center bg-no-repeat bg-cover" style="background-image: url('https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1600&auto=format&fit=crop'); opacity: 0.18;"></div>
          <div class="absolute inset-0 bg-black/20"></div>
        </div>
        <div class="precaution-header" style="position:sticky;top:0;z-index:2;">
          <button class="back-button" id="backFromFarmerInfo">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 id="farmerInfoTitle" class="text-white text-xl font-bold">Farmer Info</h2>
        </div>
        <div class="p-4 space-y-8 fi-scroll" style="position:relative;z-index:1;max-height:calc(100vh - 56px - 72px);overflow-y:auto;overflow-x:hidden;">
          <section class="space-y-4">
            <h2 class="text-white text-lg font-bold">Basic Farmer Info</h2>
            <div class="space-y-4">
              <div>
                <label class="text-[#9eb7a8] text-sm mb-1 block" for="fi_name">Name of the Farmer</label>
                <input id="fi_name" type="text" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10 placeholder:text-white/40" placeholder="Enter farmer's name" />
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="text-[#9eb7a8] text-sm mb-1 block" for="fi_age">Age</label>
                  <input id="fi_age" type="number" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10 placeholder:text-white/40" placeholder="Enter age" />
                </div>
                <div>
                  <label class="text-[#9eb7a8] text-sm mb-1 block" for="fi_gender">Gender</label>
                  <select id="fi_gender" class="form-select">
                    <option value="">Select gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                  </select>
                </div>
              </div>
              <div>
                <label class="text-[#9eb7a8] text-sm mb-1 block" for="fi_contact">Contact Number</label>
                <input id="fi_contact" type="tel" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10 placeholder:text-white/40" placeholder="Enter contact number" />
              </div>
              <div>
                <label class="text-[#9eb7a8] text-sm mb-1 block" for="fi_address">Address / Village / District</label>
                <input id="fi_address" type="text" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10 placeholder:text-white/40" placeholder="Enter address" />
              </div>
            </div>
          </section>

          <section class="space-y-4">
            <h2 class="text-white text-lg font-bold">Farm / Land Details</h2>
            <div class="space-y-4">
              <div>
                <label class="text-[#9eb7a8] text-sm mb-1 block" for="fi_land_size">Total Land Size (acres/hectares)</label>
                <input id="fi_land_size" type="text" class="w-full bg-[#29382f] text-white rounded-lg px-4 py-3 border border-white/10 placeholder:text-white/40" placeholder="Enter land size" />
              </div>
              <div>
                <label class="text-[#9eb7a8] text-sm mb-1 block" for="fi_land_type">Type of Land</label>
                <select id="fi_land_type" class="form-select">
                  <option value="">Select land type</option>
                  <option value="irrigated">Irrigated</option>
                  <option value="rainfed">Rainfed</option>
                  <option value="dryland">Dryland</option>
                </select>
              </div>
              <div>
                <label class="text-[#9eb7a8] text-sm mb-1 block" for="fi_soil_type">Soil Type</label>
                <select id="fi_soil_type" class="form-select">
                  <option value="">Select soil type</option>
                  <option value="laterite">Laterite</option>
                  <option value="alluvial">Alluvial</option>
                  <option value="sandy">Sandy</option>
                  <option value="clay">Clay</option>
                </select>
              </div>
              <div>
                <label class="text-[#9eb7a8] text-sm mb-1 block" for="fi_water_source">Water Source</label>
                <select id="fi_water_source" class="form-select">
                  <option value="">Select water source</option>
                  <option value="well">Well</option>
                  <option value="borewell">Borewell</option>
                  <option value="canal">Canal</option>
                  <option value="rainfed">Rainfed</option>
                </select>
              </div>
            </div>
          </section>
        </div>
        <div class="p-4" style="position:sticky;bottom:0;z-index:2;background:rgba(17,23,20,0.85);backdrop-filter:blur(6px);">
          <button id="farmerInfoNext" class="w-full bg-[var(--primary-500)] text-[var(--neutral-900)] font-bold py-4 rounded-lg text-center">Complete Setup</button>
        </div>
      </div>

      <!-- PRIVACY POLICY OVERLAY -->
      <div id="privacyPage" class="hidden from-bottom">
        <div class="precaution-header" style="position:sticky;top:0;z-index:2;">
          <button class="back-button" id="backFromPrivacy">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="text-white text-xl font-bold">Privacy Policy</h2>
        </div>
        <div class="p-4" style="max-height:calc(100vh - 56px - 72px);overflow-y:auto;overflow-x:hidden;">
          <div class="text-[#d1d9d4] space-y-4">
            <p>Satwik is committed to protecting your privacy. This Privacy Policy explains how we collect, use, and disclose your information when you use our mobile application (the "App").</p>
            <div>
              <h3 class="text-white text-lg font-bold">Information We Collect</h3>
              <p>We may collect the following types of information:</p>
              <ul class="list-disc pl-5 space-y-1">
                <li><strong>Personal Information:</strong> Name, email address, phone number, and location.</li>
                <li><strong>Usage Information:</strong> Features used, content viewed, and session durations.</li>
                <li><strong>Device Information:</strong> Device model, OS, and identifiers.</li>
              </ul>
            </div>
            <div>
              <h3 class="text-white text-lg font-bold">How We Use Your Information</h3>
              <ul class="list-disc pl-5 space-y-1">
                <li>To provide and improve the App</li>
                <li>To personalize your experience</li>
                <li>To communicate with you</li>
                <li>To comply with legal requirements</li>
              </ul>
            </div>
            <div>
              <h3 class="text-white text-lg font-bold">Information Sharing</h3>
              <ul class="list-disc pl-5 space-y-1">
                <li><strong>Service Providers</strong> assisting our services</li>
                <li><strong>Business Partners</strong> offering relevant services</li>
                <li><strong>Legal Authorities</strong> when required by law</li>
              </ul>
            </div>
            <div>
              <h3 class="text-white text-lg font-bold">Data Security</h3>
              <p>We take reasonable measures to protect your information, but no method is completely secure.</p>
            </div>
            <div>
              <h3 class="text-white text-lg font-bold">Changes</h3>
              <p>We may update this policy. Continued use indicates acceptance of changes.</p>
            </div>
            <div>
              <h3 class="text-white text-lg font-bold">Contact Us</h3>
              <p>Questions? Email <span class="text-[var(--primary-500)]">support@satwik.com</span></p>
            </div>
          </div>
        </div>
        <div class="p-4" style="position:sticky;bottom:0;background:rgba(17,23,20,0.85);backdrop-filter:blur(6px);">
          <button id="acceptPrivacy" class="w-full h-12 rounded-lg bg-[var(--primary-500)] text-[var(--neutral-900)] text-base font-bold">Accept</button>
        </div>
      </div>

      <!-- TERMS OF SERVICE OVERLAY -->
      <div id="termsPage" class="hidden from-bottom">
        <div class="precaution-header" style="position:sticky;top:0;z-index:2;">
          <button class="back-button" id="backFromTerms">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="text-white text-xl font-bold">Terms of Service</h2>
        </div>
        <div class="p-4" style="max-height:calc(100vh - 56px - 72px);overflow-y:auto;overflow-x:hidden;">
          <div class="text-[#d1d9d4] space-y-4">
            <h3 class="text-white text-lg font-bold">Welcome to Satwik!</h3>
            <p>By using our app, you agree to these terms. Please read them carefully. If you do not agree, do not use the app. Your use of Satwik is also subject to our Privacy Policy.</p>
            <h4 class="text-white font-semibold">Changes to Terms</h4>
            <p>We may update these terms; continuing to use the app means you accept the changes.</p>
            <h4 class="text-white font-semibold">Service Provision</h4>
            <p>We provide information and tools for farmers but cannot guarantee accuracy. You are responsible for your decisions.</p>
            <h4 class="text-white font-semibold">User Conduct</h4>
            <p>Do not misuse the app or access it unlawfully. We may suspend access on violations.</p>
            <h4 class="text-white font-semibold">Intellectual Property</h4>
            <p>Content is protected by IP laws. Do not copy or distribute without permission.</p>
            <h4 class="text-white font-semibold">Governing Law</h4>
            <p>Indian law applies; disputes resolved in Indian courts.</p>
            <h4 class="text-white font-semibold">Contact Us</h4>
            <p>support@satwik.com</p>
          </div>
        </div>
        <div class="p-4" style="position:sticky;bottom:0;background:rgba(17,23,20,0.85);backdrop-filter:blur(6px);">
          <button id="acceptTerms" class="w-full h-12 rounded-lg bg-[var(--primary-500)] text-[var(--neutral-900)] text-base font-bold">I Agree</button>
        </div>
      </div>

      <!-- FARM DETAILS PAGE (view saved info) -->
      <div id="farmDetailsPage" class="hidden from-right">
        <div class="precaution-header">
          <button class="back-button" id="backFromFarmDetails">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="precaution-title">Cultivation Guiedlines</h2>
        </div>
        <div class="p-4 space-y-4 text-white">
          <div class="settings-section">
            <h3>Farmer</h3>
            <p id="fd_name">—</p>
            <p id="fd_contact" class="text-[#9eb7a8] text-sm">—</p>
            <p id="fd_address" class="text-[#9eb7a8] text-sm">—</p>
          </div>
          <div class="settings-section">
            <h3>Land</h3>
            <p>Size: <span id="fd_land_size">—</span></p>
            <p>Type: <span id="fd_land_type">—</span></p>
            <p>Soil: <span id="fd_soil_type">—</span></p>
            <p>Water: <span id="fd_water_source">—</span></p>
          </div>
        </div>
      </div>

      <!-- DASHBOARD PAGE -->
      <div id="dashboardPage" class="hidden flex flex-col h-full bg-gray-950">

        <!-- Fixed Top Header -->
        <header class="sticky top-0 z-50 bg-gray-950/95 backdrop-blur-sm p-4 flex items-center justify-between">
          <div class="flex items-center gap-2">
            <span class="material-symbols-outlined text-[var(--primary-500)] text-2xl">eco</span>
            <span class="text-white font-bold text-lg">Satwik</span>
          </div>
          <h2 id="pageTitle" class="text-white text-xl font-bold text-center flex-1">Home</h2>
          <div class="flex items-center gap-2">
            <button class="text-white text-2xl"><span class="material-symbols-outlined">notifications</span></button>
            <button class="text-white text-2xl"><span class="material-symbols-outlined">search</span></button>
            <button id="profileBtn" class="text-white text-2xl"><span class="material-symbols-outlined">account_circle</span></button>
          </div>
        </header>

        <!-- Scrollable Content -->
        <main id="mainContent">
          <!-- Home Content -->
          <div id="homeContent" class="space-y-4">
            <!-- Weather Cards -->
            <div class="weather-card flex items-center gap-4 rounded-lg bg-gray-900 p-4" data-weather="sunny" onclick="showWeatherPrecautions('sunny')" style="cursor: pointer;">
              <div class="flex-grow">
                <p class="text-gray-400 text-sm">Today</p>
                <p class="text-white font-bold">Weather: Sunny, 28°C</p>
                <p class="text-gray-400 text-sm">Tasks: Harvest corn, check irrigation</p>
              </div>
              <div class="w-24 h-24 bg-cover bg-center rounded-lg" style='background-image: url("https://images.unsplash.com/photo-1501973801540-537f08ccae7b?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80");'>
              </div>
            </div>
            <div class="weather-card flex items-center gap-4 rounded-lg bg-gray-900 p-4" data-weather="partly-cloudy" onclick="showWeatherPrecautions('partly-cloudy')" style="cursor: pointer;">
              <div class="flex-grow">
                <p class="text-gray-400 text-sm">Tomorrow</p>
                <p class="text-white font-bold">Weather: Partly Cloudy, 26°C</p>
                <p class="text-gray-400 text-sm">Tasks: Plant soybeans, fertilize fields</p>
              </div>
              <div class="w-24 h-24 bg-cover bg-center rounded-lg" style='background-image: url("https://images.unsplash.com/photo-1521295121783-8a321d551ad2?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80");'>
              </div>
            </div>
            <div class="weather-card flex items-center gap-4 rounded-lg bg-gray-900 p-4" data-weather="rainy" onclick="showWeatherPrecautions('rainy')" style="cursor: pointer;">
              <div class="flex-grow">
                <p class="text-gray-400 text-sm">Day After Tomorrow</p>
                <p class="text-white font-bold">Weather: Rainy, 24°C</p>
                <p class="text-gray-400 text-sm">Tasks: Maintain drainage, cover crops</p>
              </div>
              <div class="w-24 h-24 bg-cover bg-center rounded-lg" style='background-image: url("https://images.unsplash.com/photo-1504386106331-3e4e71712b38?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80");'>
              </div>
            </div>

            <!-- Streak -->
            <div class="rounded-lg bg-gray-900 p-4">
              <p class="text-gray-400 text-sm">Streak</p>
              <p class="text-white font-bold text-lg">Next Activity Has to be done🌱</p>
              <p class="text-gray-400 text-sm">Keep it up to earn rewards!</p>
            </div>

            <!-- Goals -->
            <div class="rounded-lg bg-gray-900 p-4">
              <p class="text-gray-400 text-sm mb-2">Your Goals</p>
              <ul class="space-y-2">
                <li class="flex items-center justify-between">
                  <span class="text-white">Removing Weeds</span>
                  <span class="text-green-400 text-sm">100% Done</span>
                </li>
                <li class="flex items-center justify-between">
                  <span class="text-white">Plough 2-3 Times</span>
                  <span class="text-green-400 text-sm">50% Done</span>
                </li>
                <li class="flex items-center justify-between">
                  <span class="text-white">Irrigation Channel Layout</span>
                  <span class="text-green-400 text-sm">30% Done</span>
                </li>
              </ul>
            </div>

            <!-- Progress Tracker -->
            <div class="rounded-lg bg-gray-900 p-4 flex items-center justify-between">
              <div>
                <p class="text-gray-400 text-sm">Overall Progress</p>
                <p class="text-white font-bold text-lg">25%</p>
              </div>
              <div class="w-16 h-16 rounded-full border-4 border-green-500 flex items-center justify-center text-white font-bold">25%</div>
            </div>

            <!-- Latest News -->
            <div class="rounded-lg bg-gray-900 p-4">
              <p class="text-gray-400 text-sm mb-2">Latest News</p>
              <div class="space-y-3">
                <div class="p-3 bg-gray-800 rounded-lg">
                  <p class="text-white font-medium">New subsidy for organic farming announced</p>
                  <p class="text-gray-400 text-xs">2h ago</p>
                </div>
                <div class="p-3 bg-gray-800 rounded-lg">
                  <p class="text-white font-medium">Rainfall expected in the northern region</p>
                  <p class="text-gray-400 text-xs">5h ago</p>
                </div>
              </div>
            </div>

            <!-- Irrigation Reminder -->
            <div class="rounded-lg bg-gray-900 p-4">
              <p class="text-gray-400 text-sm">Reminder</p>
              <p class="text-white font-bold">Irrigation Needed Tomorrow 💧</p>
            </div>

            <!-- Home Info Button Container -->
            <div class="home-buttons-container">
              <div id="home-info-btn" class="home-info-btn">
                <span class="material-symbols-outlined text-2xl">info</span>
              </div>
            </div>
          </div>

          <!-- Question Page Content -->
          <div id="questionPage" class="hidden flex flex-col h-full bg-gray-950">
            <div class="flex-1 p-4 flex flex-col justify-end space-y-4">
              <!-- Question Messages -->
              <div class="flex items-start gap-3 justify-end">
                <div class="bg-[var(--primary-500)] rounded-lg p-3 max-w-xs">
                  <p class="text-white text-sm">How to improve soil quality for growing tomatoes?</p>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <div class="bg-gray-800 rounded-full h-8 w-8 flex items-center justify-center">
                  <span class="material-symbols-outlined text-[var(--primary-500)] text-lg">psychology</span>
                </div>
                <div class="bg-gray-800 rounded-lg p-3 max-w-xs">
                  <p class="text-gray-300 text-sm">Improving soil for tomatoes involves adding organic matter like compost, ensuring proper drainage, and maintaining a pH between 6.0 and 6.8. Regular soil testing is recommended.</p>
                </div>
              </div>
            </div>
            <!-- Satwik AI Bar Fixed -->
            <div class="p-4 bg-[#111714] sticky bottom-0">
              <div class="relative">
                <input class="w-full bg-[#29382f] text-white placeholder-gray-400 border-none rounded-full py-3 pl-4 pr-12 focus:ring-2 focus:ring-[var(--primary-500)]" placeholder="Ask Satwik AI..." type="text" />
                <button class="absolute inset-y-0 right-0 flex items-center pr-3">
                  <span class="material-symbols-outlined text-white">send</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Schemes Page Content -->
          <div id="schemesPage" class="hidden">
            <div class="relative mb-6 p-4">
              <span class="material-symbols-outlined absolute left-7 top-1/2 -translate-y-1/2 text-[#9eb7a8]">search</span>
              <input class="w-full rounded-full bg-[#1c2620] py-3 pl-10 pr-4 text-white placeholder:text-[#9eb7a8] focus:outline-none focus:ring-2 focus:ring-[var(--primary-500)]" placeholder="Search for schemes" type="text" />
            </div>
            <div class="grid grid-cols-1 gap-4 px-4 pb-20">
              <div class="flex flex-col gap-3 rounded-lg overflow-hidden bg-[#1c2620] shadow-lg cursor-pointer hover:bg-[#29382f] transition-colors" data-scheme="pm-kisan" onclick="openScheme('pm-kisan')">
                <div class="w-full h-40 bg-center bg-no-repeat bg-cover" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCTkzrDTFr-Vh4z68I8WHKdVqBEw_uEktnQfW8GbJUoxJ4Dqc2zWEYs-9SLp-hW2Hz_IynMB5qkhngTGz24DXXLcg-kllGmMWYM5R4o2cXHrwOzo0vGQBefbVoCyjjs-TcG6T_95Iu4p5ONxTI3MltG5a62uCvAoNPZyJAayqOE10-8X5iNnDILUN-1xw6LEa6LrHqsEXHswAKWbT2JAM2vf5WAtR_Pefgzm5e1CmrM4-Q4AHBWEZRvzzmpziFSll7YkR0o2T2gD2h1");'>
                </div>
                <div class="p-4">
                  <h3 class="text-white text-lg font-semibold">Pradhan Mantri Kisan Samman Nidhi</h3>
                  <p class="text-[#9eb7a8] text-sm mt-1">Financial support for small farmers</p>
                  <div class="mt-3 flex justify-between items-center">
                    <span class="text-[var(--primary-500)] text-sm font-medium">₹6,000/year</span>
                    <button class="text-xs bg-[var(--primary-500)] text-[var(--neutral-900)] px-3 py-1 rounded-full font-bold">Apply</button>
                  </div>
                </div>
              </div>
              <div class="flex flex-col gap-3 rounded-lg overflow-hidden bg-[#1c2620] shadow-lg cursor-pointer hover:bg-[#29382f] transition-colors" data-scheme="pm-fasal-bima" onclick="openScheme('pm-fasal-bima')">
                <div class="w-full h-40 bg-center bg-no-repeat bg-cover" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuArDhKy02STnYnDcZs8TsZetekIN-yMtPYsouM9-02ChjTS839Sy6H3fFiFYhC1CKdrrS9csK_p2wrrfokgNZaVvFw2q31gA_Ib_fArWR6CKsr1Tuktr3WvGhPnbYWBLIPXdfDxTtcrTr4sbXIXtdi2GHaV36fA6Ye3JgKATU4d_T8Yy8Ij7qdyky0F_rWrQQ5AD8i08Mzrzb2oAVBOR_tJMxn4rVCoaOkgRib0JoJEBeOBLye19_JUZR7RHbqgq7xl2eLaGze5o-9Q");'>
                </div>
                <div class="p-4">
                  <h3 class="text-white text-lg font-semibold">Pradhan Mantri Fasal Bima Yojana</h3>
                  <p class="text-[#9eb7a8] text-sm mt-1">Crop insurance against natural calamities</p>
                  <div class="mt-3 flex justify-between items-center">
                    <span class="text-[var(--primary-500)] text-sm font-medium">Premium: 1.5-5%</span>
                    <button class="text-xs bg-[var(--primary-500)] text-[var(--neutral-900)] px-3 py-1 rounded-full font-bold">Apply</button>
                  </div>
                </div>
              </div>
              <div class="flex flex-col gap-3 rounded-lg overflow-hidden bg-[#1c2620] shadow-lg cursor-pointer hover:bg-[#29382f] transition-colors" data-scheme="paramparagat-krishi" onclick="openScheme('paramparagat-krishi')">
                <div class="w-full h-40 bg-center bg-no-repeat bg-cover" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBRRjq-WHR7z1ADrsRS0b8hx8ASd2Dn18KHIfW7CR6R1w75RBEpKv7m8-aQc5SCgqb Vaughn5mvr7_6bZ820ri1EhZxBENfNDv4dhzhIMBPsoncy_MS_RqQ69B6iTI5W39TV19n-bW1P0_w_eU5jc8ZBd1DdIA3ZfZFsHnccKByV3inAvFNDYBi2fVhAejzUUROEtUK_lo7ai857NB_jD30zGLt9O8CBIAsqpjbW1ek5hrO0YE-bIaZrQj5KL1js0LkW5v91TVRGO1idg3");'>
                </div>
                <div class="p-4">
                  <h3 class="text-white text-lg font-semibold">Paramparagat Krishi Vikas Yojana</h3>
                  <p class="text-[#9eb7a8] text-sm mt-1">Promoting organic farming practices</p>
                  <div class="mt-3 flex justify-between items-center">
                    <span class="text-[var(--primary-500)] text-sm font-medium">₹50,000/hectare</span>
                    <button class="text-xs bg-[var(--primary-500)] text-[var(--neutral-900)] px-3 py-1 rounded-full font-bold">Apply</button>
                  </div>
                </div>
              </div>
              <div class="flex flex-col gap-3 rounded-lg overflow-hidden bg-[#1c2620] shadow-lg cursor-pointer hover:bg-[#29382f] transition-colors" data-scheme="rashtriya-krishi" onclick="openScheme('rashtriya-krishi')">
                <div class="w-full h-40 bg-center bg-no-repeat bg-cover" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCeroMX0HLGTASL6WpqlB7eXJ2RWbIXbIlQe80_BUNxf3FwYeooM4uTHxFiurQdTlU2aEJG2pF2L8BSWtpkHuIq58wGzy0cFd7oAg-HEsyEnuEGghDh4lWxhPTjdVmyosVb33Z9R8ckthuYMGde5d7Xrbhh5Ert7E9Ju1Q-y2kBndw1Rjy-uOumF9jDc6Tx9yjDK4GD4Ufo66mTxfK2p3NtqD8fCjnA60Kqs6oUxeHeSHaTofOAlJ7UHwUXoSwt_LmTe0KHzpcg1yT-");'>
                </div>
                <div class="p-4">
                  <h3 class="text-white text-lg font-semibold">Rashtriya Krishi Vikas Yojana</h3>
                  <p class="text-[#9eb7a8] text-sm mt-1">Comprehensive agricultural development</p>
                  <div class="mt-3 flex justify-between items-center">
                    <span class="text-[var(--primary-500)] text-sm font-medium">Subsidy: 50-100%</span>
                    <button class="text-xs bg-[var(--primary-500)] text-[var(--neutral-900)] px-3 py-1 rounded-full font-bold">Apply</button>
                  </div>
                </div>
              </div>
              <div class="flex flex-col gap-3 rounded-lg overflow-hidden bg-[#1c2620] shadow-lg cursor-pointer hover:bg-[#29382f] transition-colors" data-scheme="kisan-credit-card" onclick="openScheme('kisan-credit-card')">
                <div class="w-full h-40 bg-center bg-no-repeat bg-cover" style='background-image: url("https://images.unsplash.com/photo-1620654458539-b8c433e2912a?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80");'>
                </div>
                <div class="p-4">
                  <h3 class="text-white text-lg font-semibold">Kisan Credit Card Scheme</h3>
                  <p class="text-[#9eb7a8] text-sm mt-1">Credit access for farmers at low interest rates</p>
                  <div class="mt-3 flex justify-between items-center">
                    <span class="text-[var(--primary-500)] text-sm font-medium">Up to ₹3 lakhs</span>
                    <button class="text-xs bg-[var(--primary-500)] text-[var(--neutral-900)] px-3 py-1 rounded-full font-bold">Apply</button>
                  </div>
                </div>
              </div>
              <div class="flex flex-col gap-3 rounded-lg overflow-hidden bg-[#1c2620] shadow-lg cursor-pointer hover:bg-[#29382f] transition-colors" data-scheme="oilseeds-mission" onclick="openScheme('oilseeds-mission')">
                <div class="w-full h-40 bg-center bg-no-repeat bg-cover" style='background-image: url("https://images.unsplash.com/photo-1620654459069-b5e54b714515?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80");'>
                </div>
                <div class="p-4">
                  <h3 class="text-white text-lg font-semibold">National Mission on Oilseeds & Oil Palm</h3>
                  <p class="text-[#9eb7a8] text-sm mt-1">Increasing domestic production of oilseeds</p>
                  <div class="mt-3 flex justify-between items-center">
                    <span class="text-[var(--primary-500)] text-sm font-medium">Subsidy available</span>
                    <button class="text-xs bg-[var(--primary-500)] text-[var(--neutral-900)] px-3 py-1 rounded-full font-bold">Apply</button>
                  </div>
                </div>
              </div>
              <div class="flex flex-col gap-3 rounded-lg overflow-hidden bg-[#1c2620] shadow-lg cursor-pointer hover:bg-[#29382f] transition-colors" data-scheme="micro-irrigation" onclick="openScheme('micro-irrigation')">
                <div class="w-full h-40 bg-center bg-no-repeat bg-cover" style='background-image: url("https://images.unsplash.com/photo-1620654458531-b6d6c2e0a32c?ixlib=rb-4.0.3&auto-format&fit=crop&w=400&q=80");'>
                </div>
                <div class="p-4">
                  <h3 class="text-white text-lg font-semibold">Micro Irrigation Fund Scheme</h3>
                  <p class="text-[#9eb7a8] text-sm mt-1">Promoting water conservation technologies</p>
                  <div class="mt-3 flex justify-between items-center">
                    <span class="text-[var(--primary-500)] text-sm font-medium">55% subsidy</span>
                    <button class="text-xs bg-[var(--primary-500)] text-[var(--neutral-900)] px-3 py-1 rounded-full font-bold">Apply</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Calendar Page Content -->
          <div id="calendarPage" class="hidden">
            <div class="rounded-lg bg-[#1C2620] p-4">
              <div class="flex items-center justify-between pb-4">
                <button id="prev-month" class="rounded-full p-2 hover:bg-[#29382F]">
                  <span class="material-symbols-outlined text-white">chevron_left</span>
                </button>
                <p id="current-month" class="text-white text-lg font-bold">July 2024</p>
                <button id="next-month" class="rounded-full p-2 hover:bg-[#29382F]">
                  <span class="material-symbols-outlined text-white">chevron_right</span>
                </button>
              </div>
              <div class="grid grid-cols-7 text-center" id="weekdays">
                <p class="text-[#9eb7a8] text-sm font-bold">S</p>
                <p class="text-[#9eb7a8] text-sm font-bold">M</p>
                <p class="text-[#9eb7a8] text-sm font-bold">T</p>
                <p class="text-[#9eb7a8] text-sm font-bold">W</p>
                <p class="text-[#9eb7a8] text-sm font-bold">T</p>
                <p class="text-[#9eb7a8] text-sm font-bold">F</p>
                <p class="text-[#9eb7a8] text-sm font-bold">S</p>
              </div>
              <div class="grid grid-cols-7 gap-1 mt-2" id="calendar-days">
                <!-- Calendar days will be generated by JavaScript -->
              </div>
            </div>

            <h2 id="selected-date-title" class="mt-6 px-4 text-xl font-bold text-white">Daily Expenses</h2>
            <div id="expenses-container" class="mt-4 space-y-3">
              <!-- Expenses will be populated by JavaScript -->
            </div>

            <!-- Buttons Container - Fixed position inside the app container -->
            <div class="calendar-buttons-container">
              <!-- Add Expense Button -->
              <div id="add-expense-btn" class="add-expense-btn hidden">
                <span class="material-symbols-outlined text-2xl">add</span>
              </div>

              <!-- Expense Summary Button -->
              <div id="expense-summary-btn" class="expense-summary-btn hidden">
                <span class="material-symbols-outlined text-2xl">pie_chart</span>
              </div>
            </div>

            <!-- Add Expense Modal -->
            <div id="expense-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
              <div class="bg-[#1C2620] rounded-lg p-6 w-[92vw] max-w-[400px] max-h-[85vh] overflow-y-auto">
                <h3 class="text-white text-lg font-bold mb-4">Add Expense</h3>
                <div class="space-y-4">
                  <div>
                    <label class="text-[#9eb7a8] text-sm">Amount (₹)</label>
                    <input id="expense-amount" type="number" class="w-full bg-[#29382F] text-white rounded-lg p-3 mt-1" placeholder="Enter amount" />
                  </div>
                  <div>
                    <label class="text-[#9eb7a8] text-sm">Category</label>
                    <select id="expense-category" class="w-full bg-[#29382F] text-white rounded-lg p-3 mt-1">
                      <option value="Seeds">Seeds</option>
                      <option value="Fertilizers">Fertilizers</option>
                      <option value="Equipment">Equipment</option>
                      <option value="Labor">Labor</option>
                      <option value="Irrigation">Irrigation</option>
                      <option value="Transport">Transport</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                  <div>
                    <label class="text-[#9eb7a8] text-sm">Description</label>
                    <input id="expense-description" type="text" class="w-full bg-[#29382F] text-white rounded-lg p-3 mt-1" placeholder="Short description" />
                  </div>
                </div>
                <div class="flex justify-end gap-3 mt-6">
                  <button id="cancel-expense" class="px-4 py-2 text-[#9eb7a8]">Cancel</button>
                  <button id="save-expense" class="px-4 py-2 bg-[var(--primary-500)] text-[var(--neutral-900)] rounded-lg font-bold">Save</button>
                </div>
              </div>
            </div>

            <!-- Expense Summary Modal -->
            <div id="expense-summary-modal" class="modal hidden">
              <div class="modal-content">
                <h3 class="text-white text-lg font-bold mb-4">Total Expenses Summary</h3>
                <div class="chart-container">
                  <canvas id="expense-chart"></canvas>
                </div>
                <div id="expense-summary-details" class="text-white mt-4">
                  <!-- Summary details will be populated here -->
                </div>
                <div class="flex justify-end mt-6">
                  <button id="close-summary" class="px-4 py-2 bg-[var(--primary-500)] text-[var(--neutral-900)] rounded-lg font-bold">Close</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Settings Page Content -->
          <div id="settingsPage" class="hidden p-4">
            <h2 class="text-white text-xl font-bold mb-4">Settings</h2>

            <div class="settings-section">
              <h3>Account</h3>
              <div class="settings-item">
                <div class="settings-icon">
                  <span class="material-symbols-outlined text-white">person</span>
                </div>
                <div class="settings-text">Profile</div>
                <span class="material-symbols-outlined settings-arrow">chevron_right</span>
              </div>
              <div class="settings-item">
                <div class="settings-icon">
                  <span class="material-symbols-outlined text-white">credit_card</span>
                </div>
                <div class="settings-text">Payment Methods</div>
                <span class="material-symbols-outlined settings-arrow">chevron_right</span>
              </div>
              <div class="settings-item">
                <div class="settings-icon">
                  <span class="material-symbols-outlined text-white">location_on</span>
                </div>
                <div class="settings-text">Address</div>
                <span class="material-symbols-outlined settings-arrow">chevron_right</span>
              </div>
            </div>

            <div class="settings-section">
              <h3>Notifications</h3>
              <div class="settings-item">
                <div class="settings-icon">
                  <span class="material-symbols-outlined text-white">notifications</span>
                </div>
                <div class="settings-text">Push Notifications</div>
                <label class="toggle-switch">
                  <input type="checkbox" />
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="settings-item">
                <div class="settings-icon">
                  <span class="material-symbols-outlined text-white">mail</span>
                </div>
                <div class="settings-text">Email Notifications</div>
                <label class="toggle-switch">
                  <input type="checkbox" checked />
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

            <div class="settings-section">
              <h3>Privacy</h3>
              <div class="settings-item">
                <div class="settings-icon">
                  <span class="material-symbols-outlined text-white">shield</span>
                </div>
                <div class="settings-text">Data Sharing</div>
                <label class="toggle-switch">
                  <input type="checkbox" checked />
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="settings-item">
                <div class="settings-icon">
                  <span class="material-symbols-outlined text-white">description</span>
                </div>
                <div class="settings-text">Terms of Service</div>
                <span class="material-symbols-outlined settings-arrow">chevron_right</span>
              </div>
              <div class="settings-item">
                <div class="settings-icon">
                  <span class="material-symbols-outlined text-white">description</span>
                </div>
                <div class="settings-text">Privacy Policy</div>
                <span class="material-symbols-outlined settings-arrow">chevron_right</span>
              </div>
            </div>

            <div class="settings-section">
              <h3>App Preferences</h3>
              <div class="settings-item" onclick="toggleLanguage()">
                <div class="settings-icon">
                  <span class="material-symbols-outlined text-white">language</span>
                </div>
                <div class="settings-text">Language</div>
                <div class="flex items-center">
                  <span id="currentLanguage" class="text-[var(--neutral-400)] mr-2">English</span>
                  <span class="material-symbols-outlined settings-arrow">chevron_right</span>
                </div>
              </div>
              <div id="themeToggle" class="settings-item cursor-pointer">
                <div class="settings-icon">
                  <span class="material-symbols-outlined text-white">dark_mode</span>
                </div>
                <div class="settings-text">Theme</div>
                <div class="flex items-center">
                  <span id="themeLabel" class="text-[var(--neutral-400)] mr-2">Dark</span>
                  <span class="material-symbols-outlined settings-arrow">chevron_right</span>
                </div>
              </div>
            </div>

            <div class="settings-section">
              <h3>Farming Tools</h3>
              <div class="settings-item" id="openDemandForecasting">
                <div class="settings-icon">
                  <span class="material-symbols-outlined text-white">trending_up</span>
                </div>
                <div class="settings-text">Demand Forecasting</div>
                <span class="material-symbols-outlined settings-arrow">chevron_right</span>
              </div>
              <div class="settings-item" id="openListService">
                <div class="settings-icon">
                  <span class="material-symbols-outlined text-white">add_business</span>
                </div>
                <div class="settings-text">List Your Service</div>
                <span class="material-symbols-outlined settings-arrow">chevron_right</span>
              </div>
            </div>

            <button class="logout-btn">
              Logout
            </button>
          </div>

          <!-- Profile Page Content -->
          <div id="profilePage" class="hidden p-4">
            <div class="profile-header">
              <div class="profile-info">
                <img src="https://lh3.googleusercontent.com/aida-public/AB6AXuAsNERuIiDzTS4Q8dzW3d9PmCcljW3VWkBIZDmsOFWI7c1RQO96mV1Rn8yXwfxpS0m8AnVKJwIetkBaf09IjenyYku1o0JeYYYMfcd6ZK9RFPoioH4sFn2y4DuEJnhiUFgKZacpZjfoANCSwFDEa-bf_SRaFoGB03I3vE1fm85d8K-pOrwFPjitFOJpqftsTMTQmZTO2IIwM0X0Ilb9b5OyLK0FujHNfh9hWcg-GiYNXEMNgdeX0_le6UHlMQhyR4Z6eDAN4v9k8Yn9" alt="Profile" class="profile-avatar" />
                <div>
                  <h3 class="profile-name">Arjun Sharma</h3>
                  <p class="profile-email">arjun.sharma@email.com</p>
                </div>
              </div>
              <div class="coins-display">
                <span class="material-symbols-outlined text-[var(--primary-500)]">monetization_on</span>
                <span id="coins-count" class="coins-count">350</span>
              </div>
            </div>

            <div class="profile-menu">
              <div class="profile-menu-item" id="openProfileFromSettings">
                <div class="profile-menu-icon">
                  <span class="material-symbols-outlined">edit</span>
                </div>
                <div class="profile-menu-text">Edit Profile</div>
                <span class="material-symbols-outlined profile-menu-arrow">chevron_right</span>
              </div>
              <div class="profile-menu-item" id="openUserAddress">
                <div class="profile-menu-icon">
                  <span class="material-symbols-outlined">location_on</span>
                </div>
                <div class="profile-menu-text">User Address</div>
                <span class="material-symbols-outlined profile-menu-arrow">chevron_right</span>
              </div>
              <div class="profile-menu-item">
                <div class="profile-menu-icon">
                  <span class="material-symbols-outlined">grass</span>
                </div>
                <div class="profile-menu-text">Farm Details</div>
                <span class="material-symbols-outlined profile-menu-arrow">chevron_right</span>
              </div>
              <div class="profile-menu-item" id="openCropManagement">
                <div class="profile-menu-icon">
                  <span class="material-symbols-outlined">agriculture</span>
                </div>
                <div class="profile-menu-text">Crop Management</div>
                <span class="material-symbols-outlined profile-menu-arrow">chevron_right</span>
              </div>
              <div class="profile-menu-item">
                <div class="profile-menu-icon">
                  <span class="material-symbols-outlined">history</span>
                </div>
                <div class="profile-menu-text">Past Track</div>
                <span class="material-symbols-outlined profile-menu-arrow">chevron_right</span>
              </div>
              <div class="profile-menu-item">
                <div class="profile-menu-icon">
                  <span class="material-symbols-outlined">help</span>
                </div>
                <div class="profile-menu-text">Help & Support</div>
                <span class="material-symbols-outlined profile-menu-arrow">chevron_right</span>
              </div>
              <div class="profile-menu-item" id="openPostDisaster">
                <div class="profile-menu-icon">
                  <span class="material-symbols-outlined">emergency</span>
                </div>
                <div class="profile-menu-text">Post-Disaster Help</div>
                <span class="material-symbols-outlined profile-menu-arrow">chevron_right</span>
              </div>
            </div>
          </div>
        </main>

        <!-- Fixed Bottom Navigation -->
        <footer class="sticky bottom-0 z-50 bg-gray-900/95 backdrop-blur-sm border-t border-gray-800 py-2 flex justify-around">
          <div class="nav-link nav-active" data-page="Home">
            <span class="material-symbols-outlined">home</span>
            <p class="text-xs font-medium">Home</p>
          </div>
          <div class="nav-link" data-page="Question">
            <span class="material-symbols-outlined">quiz</span>
            <p class="text-xs font-medium">Question</p>
          </div>
          <div class="nav-link" data-page="Schemes">
            <span class="material-symbols-outlined">account_balance</span>
            <p class="text-xs font-medium">Schemes</p>
          </div>
          <div class="nav-link" data-page="Calendar">
            <span class="material-symbols-outlined">calendar_month</span>
            <p class="text-xs font-medium">Calendar</p>
          </div>
          <div class="nav-link" data-page="Settings">
            <span class="material-symbols-outlined">settings</span>
            <p class="text-xs font-medium">Settings</p>
          </div>
        </footer>
      </div>

      <!-- Weather Precaution Page -->
      <div id="weatherPrecautionPage" class="hidden from-bottom">
        <div class="precaution-header">
          <button class="back-button" id="backFromPrecaution">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="precaution-title">Weather Precautions</h2>
        </div>

        <div class="weather-icon-large">
          <span id="weatherPrecautionIcon">wb_sunny</span>
        </div>

        <h2 class="weather-type" id="weatherPrecautionType">Sunny Weather</h2>
        <p class="weather-temp" id="weatherPrecautionTemp">28°C</p>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">check_circle</span> Recommended Activities</h3>
          <ul class="precaution-list" id="recommendedActivities">
            <li>Irrigation during early morning or late evening</li>
            <li>Harvesting of matured crops</li>
            <li>Weeding and soil preparation</li>
            <li>Application of organic fertilizers</li>
          </ul>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">cancel</span> Activities to Avoid</h3>
          <ul class="precaution-list" id="activitiesToAvoid">
            <li>Avoid working during peak sun hours (12 PM - 3 PM)</li>
            <li>Don't apply chemical pesticides in high temperatures</li>
            <li>Avoid heavy irrigation during daytime</li>
            <li>Postpone transplanting of seedlings</li>
          </ul>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">lightbulb</span> Additional Tips</h3>
          <ul class="precaution-list" id="additionalTips">
            <li>Use shade nets for sensitive crops</li>
            <li>Ensure proper hydration for farm workers</li>
            <li>Mulching can help retain soil moisture</li>
            <li>Monitor plants for signs of heat stress</li>
          </ul>
        </div>
      </div>

      <!-- Plantation Planning Page -->
      <div id="infoPage" class="hidden from-bottom">
        <div class="precaution-header">
          <button class="back-button" id="backFromInfo">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="precaution-title">New Plantation Plan</h2>
        </div>

        <div class="weather-icon-large">
          <span class="material-symbols-outlined text-6xl text-[var(--primary-500)]">eco</span>
        </div>

        <h2 class="weather-type">Create Your Plantation Plan</h2>
        <p class="weather-temp">Get personalized weekly and daily guidance</p>

        <!-- Plantation Form -->
        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">agriculture</span> Plantation Details</h3>
          
          <div class="form-group">
            <label class="form-label">Which plant do you want to grow?</label>
            <select id="plantType" class="form-select" style="max-width:100%;width:100%;overflow:hidden;text-overflow:ellipsis;">
              <option value="">Select Plant</option>
              <optgroup label="Plantation Crops">
                <option value="coconut">Coconut</option>
                <option value="rubber">Rubber</option>
                <option value="arecanut">Arecanut</option>
                <option value="cashew_nut">Cashew nut</option>
                <option value="cocoa">Cocoa</option>
                <option value="coffee">Coffee</option>
                <option value="tea">Tea</option>
              </optgroup>
              <optgroup label="Food Crops - Cereals & Millets">
                <option value="rice">Rice (paddy)</option>
                <option value="maize">Maize (limited areas)</option>
                <option value="finger_millet">Finger millet (ragi)</option>
              </optgroup>
              <optgroup label="Food Crops - Pulses">
                <option value="red_gram">Red gram (tur dal)</option>
                <option value="green_gram">Green gram (moong dal)</option>
                <option value="black_gram">Black gram (urad dal)</option>
                <option value="cowpea">Cowpea</option>
              </optgroup>
              <optgroup label="Horticultural / Vegetable Crops">
                <option value="tapioca">Tapioca (cassava)</option>
                <option value="elephant_foot_yam">Elephant foot yam</option>
                <option value="colocasia">Colocasia (chembu)</option>
                <option value="cucumber">Cucumber</option>
                <option value="pumpkin">Pumpkin</option>
                <option value="bitter_gourd">Bitter gourd</option>
                <option value="ash_gourd">Ash gourd</option>
                <option value="snake_gourd">Snake gourd</option>
                <option value="brinjal">Brinjal (eggplant)</option>
                <option value="tomato">Tomato</option>
                <option value="chili">Chilli</option>
                <option value="beans">Beans</option>
              </optgroup>
              <optgroup label="Fruit Crops">
                <option value="banana">Banana (Nendran, Robusta, Poovan, etc.)</option>
                <option value="mango">Mango</option>
                <option value="jackfruit">Jackfruit</option>
                <option value="papaya">Papaya</option>
                <option value="pineapple">Pineapple</option>
                <option value="guava">Guava</option>
                <option value="sapota">Sapota (chikoo)</option>
              </optgroup>
              <optgroup label="Spice Crops">
                <option value="black_pepper">Black pepper</option>
                <option value="cardamom">Cardamom</option>
                <option value="clove">Clove</option>
                <option value="nutmeg">Nutmeg</option>
                <option value="cinnamon">Cinnamon</option>
                <option value="ginger">Ginger</option>
                <option value="turmeric">Turmeric</option>
              </optgroup>
              <optgroup label="Oilseed Crops">
                <option value="coconut">Coconut</option>
                <option value="sesame">Sesame</option>
                <option value="groundnut">Groundnut (limited areas)</option>
              </optgroup>
              <optgroup label="Commercial / Cash Crops">
                <option value="sugarcane">Sugarcane</option>
                <option value="cotton">Cotton (very limited)</option>
                <option value="rubber">Rubber</option>
              </optgroup>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">What was your previous crop?</label>
            <select id="previousCrop" class="form-select">
              <option value="">Select Previous Crop</option>
              <option value="none">No previous crop (New field)</option>
              <optgroup label="Plantation Crops">
                <option value="coconut">Coconut</option>
                <option value="rubber">Rubber</option>
                <option value="arecanut">Arecanut</option>
                <option value="cashew_nut">Cashew nut</option>
                <option value="cocoa">Cocoa</option>
                <option value="coffee">Coffee</option>
                <option value="tea">Tea</option>
              </optgroup>
              <optgroup label="Food Crops - Cereals & Millets">
                <option value="rice">Rice (paddy)</option>
                <option value="maize">Maize (limited areas)</option>
                <option value="finger_millet">Finger millet (ragi)</option>
              </optgroup>
              <optgroup label="Food Crops - Pulses">
                <option value="red_gram">Red gram (tur dal)</option>
                <option value="green_gram">Green gram (moong dal)</option>
                <option value="black_gram">Black gram (urad dal)</option>
                <option value="cowpea">Cowpea</option>
              </optgroup>
              <optgroup label="Horticultural / Vegetable Crops">
                <option value="tapioca">Tapioca (cassava)</option>
                <option value="elephant_foot_yam">Elephant foot yam</option>
                <option value="colocasia">Colocasia (chembu)</option>
                <option value="cucumber">Cucumber</option>
                <option value="pumpkin">Pumpkin</option>
                <option value="bitter_gourd">Bitter gourd</option>
                <option value="ash_gourd">Ash gourd</option>
                <option value="snake_gourd">Snake gourd</option>
                <option value="brinjal">Brinjal (eggplant)</option>
                <option value="tomato">Tomato</option>
                <option value="chili">Chilli</option>
                <option value="beans">Beans</option>
              </optgroup>
              <optgroup label="Fruit Crops">
                <option value="banana">Banana (Nendran, Robusta, Poovan, etc.)</option>
                <option value="mango">Mango</option>
                <option value="jackfruit">Jackfruit</option>
                <option value="papaya">Papaya</option>
                <option value="pineapple">Pineapple</option>
                <option value="guava">Guava</option>
                <option value="sapota">Sapota (chikoo)</option>
              </optgroup>
              <optgroup label="Spice Crops">
                <option value="black_pepper">Black pepper</option>
                <option value="cardamom">Cardamom</option>
                <option value="clove">Clove</option>
                <option value="nutmeg">Nutmeg</option>
                <option value="cinnamon">Cinnamon</option>
                <option value="ginger">Ginger</option>
                <option value="turmeric">Turmeric</option>
              </optgroup>
              <optgroup label="Oilseed Crops">
                <option value="coconut">Coconut</option>
                <option value="sesame">Sesame</option>
                <option value="groundnut">Groundnut (limited areas)</option>
              </optgroup>
              <optgroup label="Commercial / Cash Crops">
                <option value="sugarcane">Sugarcane</option>
                <option value="cotton">Cotton (very limited)</option>
                <option value="rubber">Rubber</option>
              </optgroup>
            </select>
          </div>

          

          <div class="form-group">
            <label class="form-label">Size of your land (in acres)</label>
            <input type="number" id="landSize" class="form-input" placeholder="Enter land size" min="0.1" step="0.1">
          </div>

          <button id="generatePlan" class="plan-button">
            <span class="material-symbols-outlined">rocket_launch</span>
            Generate My Plan
          </button>
        </div>

      </div>

      <!-- Past Track Page (in-app) -->
      <div id="pastTrackPage" class="hidden from-bottom">
        <div class="precaution-header">
          <button class="back-button" id="backFromPastTrack">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="precaution-title">Past Track</h2>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">eco</span> Previous Crop</h3>
          <p class="weather-temp" id="ptCrop">—</p>
          <p class="weather-type text-sm" style="opacity:.8">Crop grown in last cycle</p>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">payments</span> Finances</h3>
          <ul class="precaution-list">
            <li>Total Amount Paid: <strong id="ptCost">—</strong></li>
            <li>Total Revenue: <strong id="ptRevenue">—</strong></li>
            <li>Profit: <strong id="ptProfit">—</strong></li>
          </ul>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">schedule</span> Duration</h3>
          <ul class="precaution-list">
            <li>Length: <strong id="ptDuration">—</strong></li>
            <li>Range: <strong id="ptRange">—</strong></li>
          </ul>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">summarize</span> Summary</h3>
          <p id="ptSummary">—</p>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">lightbulb</span> Advice</h3>
          <ul class="precaution-list" id="ptAdvice"></ul>
        </div>
      </div>

      <!-- Crop Management Page (in-app) -->
      <div id="cropManagementPage" class="hidden from-bottom">
        <div class="precaution-header">
          <button class="back-button" id="backFromCropManagement">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="precaution-title">Crop Management</h2>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">eco</span> Select Field</h3>
          <div class="p-2">
            <select class="w-full bg-[var(--neutral-800)] text-white rounded-md p-3 border border-[var(--neutral-700)]">
              <option>Field 1 - North Acre</option>
              <option>Field 2 - South Pasture</option>
              <option>Greenhouse A</option>
            </select>
          </div>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">inventory_2</span> Crop Details</h3>
          <div class="p-2 grid grid-cols-2 gap-3">
            <div>
              <label class="text-[var(--neutral-300)] text-sm mb-1 block">Current Crop</label>
              <input type="text" value="Wheat" class="w-full bg-[var(--neutral-800)] text-white rounded-md p-3 border border-[var(--neutral-700)]" />
            </div>
            <div>
              <label class="text-[var(--neutral-300)] text-sm mb-1 block">Planting Date</label>
              <input type="date" value="2024-03-15" class="w-full bg-[var(--neutral-800)] text-white rounded-md p-3 border border-[var(--neutral-700)]" />
            </div>
            <div>
              <label class="text-[var(--neutral-300)] text-sm mb-1 block">Harvest Date</label>
              <input type="date" value="2024-08-01" class="w-full bg-[var(--neutral-800)] text-white rounded-md p-3 border border-[var(--neutral-700)]" />
            </div>
            <div>
              <label class="text-[var(--neutral-300)] text-sm mb-1 block">Yield Estimate</label>
              <input type="text" value="5 tons/acre" class="w-full bg-[var(--neutral-800)] text-white rounded-md p-3 border border-[var(--neutral-700)]" />
            </div>
          </div>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">water_drop</span> Management</h3>
          <div class="p-2 space-y-3">
            <div>
              <label class="text-[var(--neutral-300)] text-sm mb-1 block">Irrigation Schedule</label>
              <input type="text" value="Twice a week" class="w-full bg-[var(--neutral-800)] text-white rounded-md p-3 border border-[var(--neutral-700)]" />
            </div>
            <div>
              <label class="text-[var(--neutral-300)] text-sm mb-1 block">Fertilizer Applications</label>
              <input type="text" value="Nitrogen-rich, bi-weekly" class="w-full bg-[var(--neutral-800)] text-white rounded-md p-3 border border-[var(--neutral-700)]" />
            </div>
            <div>
              <label class="text-[var(--neutral-300)] text-sm mb-1 block">Notes</label>
              <textarea class="w-full min-h-28 bg-[var(--neutral-800)] text-white rounded-md p-3 border border-[var(--neutral-700)]" placeholder="e.g., Noticed some pest activity on the west side..."></textarea>
            </div>
          </div>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">save</span> Actions</h3>
          <div class="p-2 space-y-2">
            <button class="w-full bg-[var(--primary-500)] text-[var(--neutral-900)] rounded-md p-3 font-semibold">
              <span class="material-symbols-outlined mr-2">save</span>
              Save Crop Details
            </button>
            <button class="w-full bg-[var(--neutral-700)] text-white rounded-md p-3 font-semibold">
              <span class="material-symbols-outlined mr-2">refresh</span>
              Update Status
            </button>
          </div>
        </div>
      </div>

      <!-- Cultivation Guidance Page (in-app) -->
      <div id="cultivationGuidancePage" class="hidden from-bottom">
        <div class="precaution-header">
          <button class="back-button" id="backFromCultivationGuidance">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="precaution-title">Cultivation Guidance</h2>
        </div>

        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">agriculture</span> Select a Process</h3>
          <div class="p-2">
            <div class="grid grid-cols-2 gap-4">
              <div class="relative bg-[var(--neutral-800)] rounded-xl shadow-sm hover:shadow-lg transition-shadow duration-300 flex flex-col items-center justify-center p-4 aspect-square cursor-pointer" onclick="toggleProcessDetails('ploughing')">
                <div class="absolute top-2 right-2 text-[var(--neutral-400)]">
                  <span class="material-symbols-outlined text-sm" id="ploughing-arrow">expand_more</span>
                </div>
                <div class="bg-[var(--primary-500)]/20 p-4 rounded-full mb-3">
                  <span class="material-symbols-outlined text-[var(--primary-500)] text-3xl">agriculture</span>
                </div>
                <h4 class="text-base font-bold text-center text-white">Ploughing</h4>
              </div>

              <div class="relative bg-[var(--neutral-800)] rounded-xl shadow-sm hover:shadow-lg transition-shadow duration-300 flex flex-col items-center justify-center p-4 aspect-square cursor-pointer" onclick="toggleProcessDetails('sowing')">
                <div class="absolute top-2 right-2 text-[var(--neutral-400)]">
                  <span class="material-symbols-outlined text-sm" id="sowing-arrow">expand_more</span>
                </div>
                <div class="bg-[var(--primary-500)]/20 p-4 rounded-full mb-3">
                  <span class="material-symbols-outlined text-[var(--primary-500)] text-3xl">eco</span>
                </div>
                <h4 class="text-base font-bold text-center text-white">Sowing</h4>
              </div>

              <div class="relative bg-[var(--neutral-800)] rounded-xl shadow-sm hover:shadow-lg transition-shadow duration-300 flex flex-col items-center justify-center p-4 aspect-square cursor-pointer" onclick="toggleProcessDetails('irrigation')">
                <div class="absolute top-2 right-2 text-[var(--neutral-400)]">
                  <span class="material-symbols-outlined text-sm" id="irrigation-arrow">expand_more</span>
                </div>
                <div class="bg-[var(--primary-500)]/20 p-4 rounded-full mb-3">
                  <span class="material-symbols-outlined text-[var(--primary-500)] text-3xl">water_drop</span>
                </div>
                <h4 class="text-base font-bold text-center text-white">Irrigation</h4>
              </div>

              <div class="relative bg-[var(--neutral-800)] rounded-xl shadow-sm hover:shadow-lg transition-shadow duration-300 flex flex-col items-center justify-center p-4 aspect-square cursor-pointer" onclick="toggleProcessDetails('fertilization')">
                <div class="absolute top-2 right-2 text-[var(--neutral-400)]">
                  <span class="material-symbols-outlined text-sm" id="fertilization-arrow">expand_more</span>
                </div>
                <div class="bg-[var(--primary-500)]/20 p-4 rounded-full mb-3">
                  <span class="material-symbols-outlined text-[var(--primary-500)] text-3xl">science</span>
                </div>
                <h4 class="text-base font-bold text-center text-white">Fertilization</h4>
              </div>

              <div class="relative bg-[var(--neutral-800)] rounded-xl shadow-sm hover:shadow-lg transition-shadow duration-300 flex flex-col items-center justify-center p-4 aspect-square cursor-pointer" onclick="toggleProcessDetails('harvesting')">
                <div class="absolute top-2 right-2 text-[var(--neutral-400)]">
                  <span class="material-symbols-outlined text-sm" id="harvesting-arrow">expand_more</span>
                </div>
                <div class="bg-[var(--primary-500)]/20 p-4 rounded-full mb-3">
                  <span class="material-symbols-outlined text-[var(--primary-500)] text-3xl">grass</span>
                </div>
                <h4 class="text-base font-bold text-center text-white">Harvesting</h4>
              </div>

              <div class="relative bg-[var(--neutral-800)] rounded-xl shadow-sm hover:shadow-lg transition-shadow duration-300 flex flex-col items-center justify-center p-4 aspect-square cursor-pointer" onclick="toggleProcessDetails('storage')">
                <div class="absolute top-2 right-2 text-[var(--neutral-400)]">
                  <span class="material-symbols-outlined text-sm" id="storage-arrow">expand_more</span>
                </div>
                <div class="bg-[var(--primary-500)]/20 p-4 rounded-full mb-3">
                  <span class="material-symbols-outlined text-[var(--primary-500)] text-3xl">inventory_2</span>
                </div>
                <h4 class="text-base font-bold text-center text-white">Storage</h4>
              </div>
            </div>
          </div>
        </div>

        <!-- Process Details Dropdowns -->
        <div id="ploughing-details" class="precaution-section hidden">
          <h3><span class="material-symbols-outlined">agriculture</span> Ploughing Steps</h3>
          <div class="p-2">
            <div class="space-y-3">
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 1: Field Preparation</h4>
                <p class="text-[var(--neutral-300)] text-sm">Clear the field of weeds, stones, and debris. Mark field boundaries.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 2: Soil Testing</h4>
                <p class="text-[var(--neutral-300)] text-sm">Test soil pH, moisture content, and nutrient levels before ploughing.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 3: Ploughing Depth</h4>
                <p class="text-[var(--neutral-300)] text-sm">Plough to 15-20 cm depth for most crops. Use appropriate plough type.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 4: Leveling</h4>
                <p class="text-[var(--neutral-300)] text-sm">Level the ploughed field using a leveler or harrow for uniform surface.</p>
              </div>
            </div>
          </div>
        </div>

        <div id="sowing-details" class="precaution-section hidden">
          <h3><span class="material-symbols-outlined">eco</span> Sowing Steps</h3>
          <div class="p-2">
            <div class="space-y-3">
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 1: Seed Selection</h4>
                <p class="text-[var(--neutral-300)] text-sm">Choose high-quality, disease-free seeds suitable for your region and season.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 2: Seed Treatment</h4>
                <p class="text-[var(--neutral-300)] text-sm">Treat seeds with fungicides or bio-agents to prevent diseases.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 3: Sowing Method</h4>
                <p class="text-[var(--neutral-300)] text-sm">Use appropriate sowing method: broadcasting, drilling, or transplanting.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 4: Spacing & Depth</h4>
                <p class="text-[var(--neutral-300)] text-sm">Maintain proper row spacing and sowing depth as per crop requirements.</p>
              </div>
            </div>
          </div>
        </div>

        <div id="irrigation-details" class="precaution-section hidden">
          <h3><span class="material-symbols-outlined">water_drop</span> Irrigation Steps</h3>
          <div class="p-2">
            <div class="space-y-3">
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 1: Water Source Check</h4>
                <p class="text-[var(--neutral-300)] text-sm">Ensure adequate water supply from wells, canals, or other sources.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 2: Irrigation Method</h4>
                <p class="text-[var(--neutral-300)] text-sm">Choose method: flood, drip, sprinkler, or furrow irrigation based on crop needs.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 3: Timing</h4>
                <p class="text-[var(--neutral-300)] text-sm">Irrigate early morning or evening to minimize water loss through evaporation.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 4: Water Management</h4>
                <p class="text-[var(--neutral-300)] text-sm">Monitor soil moisture and avoid over-irrigation to prevent waterlogging.</p>
              </div>
            </div>
          </div>
        </div>

        <div id="fertilization-details" class="precaution-section hidden">
          <h3><span class="material-symbols-outlined">science</span> Fertilization Steps</h3>
          <div class="p-2">
            <div class="space-y-3">
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 1: Soil Analysis</h4>
                <p class="text-[var(--neutral-300)] text-sm">Analyze soil to determine nutrient deficiencies and required fertilizer types.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 2: Fertilizer Selection</h4>
                <p class="text-[var(--neutral-300)] text-sm">Choose organic or chemical fertilizers based on crop requirements and soil condition.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 3: Application Method</h4>
                <p class="text-[var(--neutral-300)] text-sm">Apply fertilizers through broadcasting, banding, or foliar application methods.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 4: Timing & Dosage</h4>
                <p class="text-[var(--neutral-300)] text-sm">Apply at right growth stages with correct dosage to avoid fertilizer burn.</p>
              </div>
            </div>
          </div>
        </div>

        <div id="harvesting-details" class="precaution-section hidden">
          <h3><span class="material-symbols-outlined">grass</span> Harvesting Steps</h3>
          <div class="p-2">
            <div class="space-y-3">
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 1: Maturity Check</h4>
                <p class="text-[var(--neutral-300)] text-sm">Check crop maturity indicators like grain hardness, color, and moisture content.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 2: Weather Planning</h4>
                <p class="text-[var(--neutral-300)] text-sm">Plan harvesting during dry weather to avoid moisture damage to crops.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 3: Harvesting Method</h4>
                <p class="text-[var(--neutral-300)] text-sm">Use manual harvesting or combine harvesters based on crop type and field size.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 4: Post-Harvest Handling</h4>
                <p class="text-[var(--neutral-300)] text-sm">Clean, sort, and prepare harvested produce for storage or immediate sale.</p>
              </div>
            </div>
          </div>
        </div>

        <div id="storage-details" class="precaution-section hidden">
          <h3><span class="material-symbols-outlined">inventory_2</span> Storage Steps</h3>
          <div class="p-2">
            <div class="space-y-3">
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 1: Storage Preparation</h4>
                <p class="text-[var(--neutral-300)] text-sm">Clean and disinfect storage area. Check for proper ventilation and temperature control.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 2: Moisture Control</h4>
                <p class="text-[var(--neutral-300)] text-sm">Ensure proper moisture levels (12-14% for grains) to prevent mold and spoilage.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 3: Pest Management</h4>
                <p class="text-[var(--neutral-300)] text-sm">Use fumigation or natural pest control methods to protect stored produce.</p>
              </div>
              <div class="bg-[var(--neutral-800)] p-4 rounded-lg">
                <h4 class="text-white font-semibold mb-2">Step 4: Regular Monitoring</h4>
                <p class="text-[var(--neutral-300)] text-sm">Regularly check stored produce for signs of spoilage, pests, or temperature changes.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Weekly Plan Page -->
      <div id="weeklyPlanPage" class="hidden from-bottom">
        <div class="precaution-header">
          <button class="back-button" id="backFromWeeklyPlan">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="precaution-title">Weekly Plan</h2>
        </div>

        <div class="weather-icon-large">
          <span class="material-symbols-outlined text-6xl text-[var(--primary-500)]">calendar_month</span>
        </div>

        <h2 class="weather-type" id="weeklyPlanTitle">Your Plantation Plan</h2>
        <p class="weather-temp" id="weeklyPlanSubtitle">Complete weekly schedule</p>

        <!-- Weekly Plan Content -->
        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">schedule</span> Weekly Schedule</h3>
          <div id="weeklyPlanContent"></div>
        </div>

        <!-- Daily Plan Section -->
        <div class="precaution-section">
          <h3><span class="material-symbols-outlined">today</span> This Week's Daily Tasks</h3>
          <div id="dailyPlanContent"></div>
        </div>
      </div>

      <!-- Demand Forecasting Page -->
      <div id="demandForecastingPage" class="hidden from-bottom">
        <div class="precaution-header">
          <button class="back-button" id="backFromDemandForecasting">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="precaution-title">Demand Forecasting</h2>
        </div>

        <div class="precaution-section">
          <!-- Input Section -->
          <div class="mb-8">
            <h3 class="text-lg font-bold mb-4 text-white">Input Section</h3>
            <form id="forecastForm" class="space-y-4">
              <select id="cropSelect" class="w-full h-14 px-4 bg-[#1a241f] text-white rounded-lg border border-white/10 focus:ring-2 focus:ring-[var(--primary-500)] appearance-none form-select">
                <option value="">Select Crop</option>
                <option value="rice">Rice</option>
                <option value="wheat">Wheat</option>
                <option value="maize">Maize</option>
                <option value="cotton">Cotton</option>
                <option value="sugarcane">Sugarcane</option>
                <option value="tomato">Tomato</option>
                <option value="onion">Onion</option>
                <option value="potato">Potato</option>
                <option value="chili">Chili</option>
                <option value="brinjal">Brinjal</option>
                <option value="okra">Okra</option>
                <option value="cabbage">Cabbage</option>
                <option value="cauliflower">Cauliflower</option>
                <option value="spinach">Spinach</option>
              </select>
              
              <select id="locationSelect" class="w-full h-14 px-4 bg-[#1a241f] text-white rounded-lg border border-white/10 focus:ring-2 focus:ring-[var(--primary-500)] appearance-none form-select">
                <option value="">Select Location</option>
                <option value="thiruvananthapuram">Thiruvananthapuram</option>
                <option value="kollam">Kollam</option>
                <option value="pathanamthitta">Pathanamthitta</option>
                <option value="alappuzha">Alappuzha</option>
                <option value="kottayam">Kottayam</option>
                <option value="idukki">Idukki</option>
                <option value="ernakulam">Ernakulam</option>
                <option value="thrissur">Thrissur</option>
                <option value="palakkad">Palakkad</option>
                <option value="malappuram">Malappuram</option>
                <option value="kozhikode">Kozhikode</option>
                <option value="wayanad">Wayanad</option>
                <option value="kannur">Kannur</option>
                <option value="kasaragod">Kasaragod</option>
              </select>
              
              <input id="cultivationArea" type="number" min="0.1" step="0.1" placeholder="Estimated Cultivation Area (acres)" class="w-full h-14 px-4 bg-[#1a241f] text-white rounded-lg border border-white/10 placeholder:text-white/60 focus:ring-2 focus:ring-[var(--primary-500)]" />
              
              <select id="seasonSelect" class="w-full h-14 px-4 bg-[#1a241f] text-white rounded-lg border border-white/10 focus:ring-2 focus:ring-[var(--primary-500)] appearance-none form-select">
                <option value="">Select Season</option>
                <option value="kharif">Kharif (June-October)</option>
                <option value="rabi">Rabi (October-March)</option>
                <option value="zaid">Zaid (March-June)</option>
              </select>
              
              <button type="submit" class="w-full h-12 px-4 bg-[var(--primary-500)] text-[var(--neutral-900)] font-bold rounded-lg hover:bg-opacity-90 transition-colors">
                Get Forecast
              </button>
            </form>
          </div>

          <!-- Results Section -->
          <div id="forecastResults" class="hidden">
            <!-- Prediction Section -->
            <div class="mb-8">
              <h3 class="text-lg font-bold mb-4 text-white">Prediction Section</h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="bg-[#29382f] rounded-xl shadow-lg overflow-hidden">
                  <div class="p-4">
                    <h4 class="text-lg font-bold text-white">Expected Demand</h4>
                    <p class="text-2xl font-bold text-[var(--primary-500)]" id="demandValue">--</p>
                  </div>
                </div>
                <div class="bg-[#29382f] rounded-xl shadow-lg overflow-hidden">
                  <div class="p-4">
                    <h4 class="text-lg font-bold text-white">Market Price Trend</h4>
                    <p class="text-2xl font-bold text-[var(--primary-500)]" id="priceTrend">--</p>
                  </div>
                </div>
                <div class="bg-[#29382f] rounded-xl shadow-lg overflow-hidden">
                  <div class="p-4">
                    <h4 class="text-lg font-bold text-white">Suggested Quantity</h4>
                    <p class="text-2xl font-bold text-[var(--primary-500)]" id="suggestedQuantity">--</p>
                  </div>
                </div>
                <div class="bg-[#29382f] rounded-xl shadow-lg overflow-hidden">
                  <div class="p-4">
                    <h4 class="text-lg font-bold text-white">Risk Factor</h4>
                    <p class="text-2xl font-bold text-[var(--primary-500)]" id="riskFactor">--</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Visualization Section -->
            <div class="mb-8">
              <h3 class="text-lg font-bold mb-4 text-white">Visualization</h3>
              <div class="space-y-6">
                <!-- Price Trend Chart -->
                <div class="p-4 bg-[#29382f] rounded-xl">
                  <h4 class="font-semibold text-white mb-2">Price Trend Over Months</h4>
                  <p class="text-3xl font-bold text-white" id="priceChange">--</p>
                  <div class="flex items-center text-sm mb-4">
                    <p class="text-white/60">Last 6 Months</p>
                    <p class="text-[var(--primary-500)] ml-2" id="priceChangePercent">--</p>
                  </div>
                  <div class="mt-4 h-36">
                    <canvas id="priceChart" width="400" height="144"></canvas>
                  </div>
                  <div class="flex justify-between text-xs text-white/60 mt-2">
                    <span>Jan</span><span>Feb</span><span>Mar</span><span>Apr</span><span>May</span><span>Jun</span>
                  </div>
                </div>

                <!-- Current Price -->
                <div class="bg-[var(--primary-500)]/10 border border-[var(--primary-500)] rounded-xl p-4 text-center">
                  <p class="text-white">After this month, the price is</p>
                  <p class="text-3xl font-bold text-[var(--primary-500)] mt-1" id="currentPrice">--</p>
                </div>

                <!-- Demand vs Supply Chart -->
                <div class="p-4 bg-[#29382f] rounded-xl">
                  <h4 class="font-semibold text-white mb-2">Demand vs Supply</h4>
                  <p class="text-3xl font-bold text-white" id="demandSupplyStatus">--</p>
                  <div class="flex items-center text-sm mb-4">
                    <p class="text-white/60">Current Season</p>
                    <p class="text-[var(--primary-500)] ml-2" id="demandSupplyPercent">--</p>
                  </div>
                  <div class="mt-4 h-36 flex items-end gap-6 px-4">
                    <div class="flex-1 flex flex-col items-center gap-2">
                      <div class="w-full bg-[var(--primary-500)]/30 rounded-t-lg" style="height: 75%;">
                        <div class="w-full bg-[var(--primary-500)] rounded-t-lg" style="height: 100%;" id="demandBar"></div>
                      </div>
                      <p class="text-xs text-white/60">Demand</p>
                    </div>
                    <div class="flex-1 flex flex-col items-center gap-2">
                      <div class="w-full bg-[var(--primary-500)]/30 rounded-t-lg" style="height: 70%;">
                        <div class="w-full bg-[var(--primary-500)] rounded-t-lg" style="height: 100%;" id="supplyBar"></div>
                      </div>
                      <p class="text-xs text-white/60">Supply</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Export Button -->
            <div class="mt-6">
              <button id="exportReport" class="w-full h-12 px-4 bg-[#1a241f] text-white font-bold rounded-lg border border-[var(--primary-500)] hover:bg-[var(--primary-500)] hover:text-[var(--neutral-900)] transition-colors">
                Download Report
              </button>
            </div>

            <!-- Crop Comparison Pie Chart -->
            <div class="mt-8">
              <h3 class="text-lg font-bold mb-4 text-white">Crop Market Share (4-Month Projection)</h3>
              <div class="p-4 bg-[#29382f] rounded-xl">
                <h4 class="font-semibold text-white mb-2">All Crops Market Value Distribution</h4>
                <p class="text-sm text-white/60 mb-4">Based on projected values after 4 months</p>
                <div class="h-80 flex items-center justify-center">
                  <canvas id="cropComparisonChart" width="300" height="300"></canvas>
                  <div id="pieChartFallback" class="hidden text-center">
                    <div class="text-6xl mb-4">📊</div>
                    <p class="text-white/60">Loading crop comparison chart...</p>
                  </div>
                </div>
                <div class="mt-4 text-center">
                  <p class="text-sm text-white/60">Highest Value Crop: <span id="highestValueCrop" class="text-[var(--primary-500)] font-bold">--</span></p>
                  <p class="text-xs text-white/40 mt-1">Projected after 4 months of cultivation</p>
                </div>
              </div>
            </div>
          </div>

          <!-- No Data Message -->
          <div id="noDataMessage" class="hidden p-4 bg-[#29382f] rounded-lg text-center">
            <span class="material-symbols-outlined text-4xl text-[#9eb7a8] mb-2">info</span>
            <p class="text-[#9eb7a8]">Data not available for this crop. Please try another crop or check back later.</p>
          </div>

        </div>
      </div>

      <!-- List Your Service Page -->
      <div id="listServicePage" class="hidden from-bottom">
        <div class="precaution-header">
          <button class="back-button" id="backFromListService">
            <span class="material-symbols-outlined">arrow_back</span>
          </button>
          <h2 class="precaution-title">List Your Service</h2>
        </div>

        <div class="precaution-section">
          <form id="listServiceForm" class="space-y-6">
            <div class="space-y-2">
              <label class="text-sm font-medium text-white/70" for="service-type">Service Type</label>
              <div class="relative">
                <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-[var(--primary-500)]">agriculture</span>
                <select class="form-select w-full appearance-none rounded-lg border-2 border-[var(--primary-500)]/20 bg-[#1a241f] py-3 pl-12 text-white focus:border-[var(--primary-500)] focus:outline-none focus:ring-0" id="service-type">
                  <option selected="">Crop Dusting</option>
                  <option>Harvesting</option>
                  <option>Equipment Rental</option>
                  <option>Soil Analysis</option>
                </select>
              </div>
            </div>
            
            <div class="space-y-2">
              <label class="text-sm font-medium text-white/70" for="service-description">Service Description</label>
              <textarea class="w-full rounded-lg border-2 border-[var(--primary-500)]/20 bg-[#1a241f] p-3 text-white focus:border-[var(--primary-500)] focus:outline-none focus:ring-0 placeholder:text-white/50" id="service-description" placeholder="Describe the service you are offering..." rows="4"></textarea>
            </div>
            
            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
              <div class="space-y-2">
                <label class="text-sm font-medium text-white/70" for="contact-person">Contact Person</label>
                <input class="w-full rounded-lg border-2 border-[var(--primary-500)]/20 bg-[#1a241f] p-3 text-white focus:border-[var(--primary-500)] focus:outline-none focus:ring-0 placeholder:text-white/50" id="contact-person" placeholder="e.g., John Doe" type="text"/>
              </div>
              <div class="space-y-2">
                <label class="text-sm font-medium text-white/70" for="contact-number">Contact Number</label>
                <input class="w-full rounded-lg border-2 border-[var(--primary-500)]/20 bg-[#1a241f] p-3 text-white focus:border-[var(--primary-500)] focus:outline-none focus:ring-0 placeholder:text-white/50" id="contact-number" placeholder="e.g., +1 234 567 890" type="tel"/>
              </div>
            </div>
            
            <div class="space-y-2">
              <label class="text-sm font-medium text-white/70" for="email">Email Address</label>
              <input class="w-full rounded-lg border-2 border-[var(--primary-500)]/20 bg-[#1a241f] p-3 text-white focus:border-[var(--primary-500)] focus:outline-none focus:ring-0 placeholder:text-white/50" id="email" placeholder="e.g., john.doe@example.com" type="email"/>
            </div>
            
            <div class="space-y-2">
              <label class="text-sm font-medium text-white/70" for="service-location">Service Location</label>
              <input class="w-full rounded-lg border-2 border-[var(--primary-500)]/20 bg-[#1a241f] p-3 text-white focus:border-[var(--primary-500)] focus:outline-none focus:ring-0 placeholder:text-white/50" id="service-location" placeholder="e.g., Springfield, IL" type="text"/>
            </div>
            
            <div class="space-y-4 rounded-xl bg-[var(--primary-500)]/10 p-4">
              <h3 class="font-bold text-white">Service Availability</h3>
              <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                <input class="w-full rounded-lg border-2 border-[var(--primary-500)]/20 bg-[#1a241f] p-3 text-white focus:border-[var(--primary-500)] focus:outline-none focus:ring-0" type="date"/>
                <input class="w-full rounded-lg border-2 border-[var(--primary-500)]/20 bg-[#1a241f] p-3 text-white focus:border-[var(--primary-500)] focus:outline-none focus:ring-0" type="time"/>
              </div>
            </div>
            
            <div class="space-y-4 rounded-xl bg-[var(--primary-500)]/10 p-4">
              <h3 class="font-bold text-white">Pricing Model</h3>
              <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                <select class="form-select w-full appearance-none rounded-lg border-2 border-[var(--primary-500)]/20 bg-[#1a241f] p-3 text-white focus:border-[var(--primary-500)] focus:outline-none focus:ring-0">
                  <option>Hourly Rate</option>
                  <option>Per Acre</option>
                  <option selected="">Fixed Price</option>
                </select>
                <div class="relative">
                  <span class="absolute left-3 top-1/2 -translate-y-1/2 text-[var(--primary-500)] font-bold">₹</span>
                  <input class="w-full rounded-lg border-2 border-[var(--primary-500)]/20 bg-[#1a241f] p-3 pl-8 text-white focus:border-[var(--primary-500)] focus:outline-none focus:ring-0 placeholder:text-white/50" placeholder="100.00" type="number"/>
                </div>
              </div>
            </div>
            
            <div class="space-y-2">
              <label class="text-sm font-medium text-white/70">Upload Photos/Videos</label>
              <div class="flex items-center justify-center rounded-xl border-2 border-dashed border-[var(--primary-500)]/50 bg-[var(--primary-500)]/10 p-8 text-center cursor-pointer hover:border-[var(--primary-500)]/70 transition-colors" id="file-upload-area">
                <div class="space-y-2">
                  <span class="material-symbols-outlined text-4xl text-[var(--primary-500)]">cloud_upload</span>
                  <p class="font-semibold text-white">Click to upload or drag and drop</p>
                  <p class="text-xs text-white/70">SVG, PNG, JPG or GIF (MAX. 800x400px)</p>
                  <input class="sr-only" type="file" id="file-upload" multiple accept="image/*,video/*"/>
                </div>
              </div>
            </div>
            
            <div class="pt-4">
              <button class="w-full rounded-xl bg-[var(--primary-500)] py-4 font-bold text-[var(--neutral-900)] transition-transform active:scale-[0.98]" type="submit">Submit Service</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Plantation Bottom Bar -->
      <div id="plantationBottomBar" class="plantation-bottom-bar hidden">
        <div class="bottom-bar-content">
          <div class="bottom-bar-item">
            <span class="material-symbols-outlined">agriculture</span>
            <span>Plantation Guide</span>
          </div>
          <div class="bottom-bar-item">
            <span class="material-symbols-outlined">calendar_month</span>
            <span>Weekly Plan</span>
          </div>
          <div class="bottom-bar-item">
            <span class="material-symbols-outlined">eco</span>
            <span>Farm Tips</span>
          </div>
        </div>
      </div>

    </div>

    <script>
      // Ensure the weather precaution page, info page, and weekly plan page overlay inside the mobile container
      document.addEventListener('DOMContentLoaded', function() {
        var app = document.getElementById('appContainer');
        var wp = document.getElementById('weatherPrecautionPage');
        var ip = document.getElementById('infoPage');
        var wpp = document.getElementById('weeklyPlanPage');
        var ptp = document.getElementById('pastTrackPage');
        var cmp = document.getElementById('cropManagementPage');
        if (app && wp && wp.parentElement !== app) {
          app.appendChild(wp);
        }
        if (app && ip && ip.parentElement !== app) {
          app.appendChild(ip);
        }
        if (app && wpp && wpp.parentElement !== app) {
          app.appendChild(wpp);
        }
        if (app && ptp && ptp.parentElement !== app) {
          app.appendChild(ptp);
        }
        if (app && cmp && cmp.parentElement !== app) {
          app.appendChild(cmp);
        }
        var cgp = document.getElementById('cultivationGuidancePage');
        if (app && cgp && cgp.parentElement !== app) {
          app.appendChild(cgp);
        }
        var ecp = document.getElementById('expertContactsPage');
        if (app && ecp && ecp.parentElement !== app) {
          app.appendChild(ecp);
        }

        // Weather cards use inline onclick handlers - no additional setup needed

        // Weather cards use inline onclick handlers - no fallback needed

        var uap = document.getElementById('userAddressPage');
        if (app && uap && uap.parentElement !== app) {
          app.appendChild(uap);
        }
        var epp = document.getElementById('editProfilePage');
        if (app && epp && epp.parentElement !== app) {
          app.appendChild(epp);
        }
        var pdp = document.getElementById('postDisasterPage');
        if (app && pdp && pdp.parentElement !== app) {
          app.appendChild(pdp);
        }
        // set initial slide direction based on orientation and lock scroll on body
        setPrecautionSlideDirection();
        setInfoSlideDirection();
        setWeeklyPlanSlideDirection();
        window.addEventListener('resize', setPrecautionSlideDirection);
        window.addEventListener('resize', setInfoSlideDirection);
        window.addEventListener('resize', setWeeklyPlanSlideDirection);
        window.addEventListener('resize', setPastTrackSlideDirection);
        document.body.style.overflow = 'hidden';
        // Ensure crop management back works even if earlier hook misses
        var cmBack = document.getElementById('backFromCropManagement');
        if (cmBack) {
          cmBack.addEventListener('click', function(){
            var cm = document.getElementById('cropManagementPage');
            if (cm) { cm.classList.remove('active'); setTimeout(function(){ cm.classList.add('hidden'); cm.style.transform=''; }, 250); }
          });
        }
      });

      // Sample expense data structure
      let expensesData = {};
      let currentDate = new Date();
      let selectedDate = new Date();
      let userLoginDate = new Date(); // Will be set when user logs in
      let userCoins = 350; // Initial coins

      // Plantation planning data
      const plantationPlans = {
        tomato: {
          name: "Tomato",
          duration: 12, // weeks
          weeklyPlan: [
            { week: 1, title: "Soil Preparation", tasks: ["Test soil pH (6.0-6.8)", "Add organic compost", "Prepare raised beds", "Install irrigation system"] },
            { week: 2, title: "Seedling Preparation", tasks: ["Start seeds indoors", "Prepare seed trays", "Maintain temperature 20-25°C", "Water gently"] },
            { week: 3, title: "Transplanting", tasks: ["Harden off seedlings", "Transplant to field", "Space plants 60cm apart", "Water immediately"] },
            { week: 4, title: "Early Growth", tasks: ["Install support stakes", "Apply mulch", "Monitor for pests", "Light watering"] },
            { week: 5, title: "Growth Phase", tasks: ["Tie plants to stakes", "Remove suckers", "Apply balanced fertilizer", "Regular watering"] },
            { week: 6, title: "Flowering", tasks: ["Monitor flower development", "Ensure pollination", "Continue staking", "Water deeply"] },
            { week: 7, title: "Fruit Setting", tasks: ["Watch for fruit set", "Apply calcium fertilizer", "Maintain consistent moisture", "Check for diseases"] },
            { week: 8, title: "Fruit Development", tasks: ["Monitor fruit growth", "Support heavy branches", "Apply potassium fertilizer", "Regular irrigation"] },
            { week: 9, title: "Ripening Phase", tasks: ["Reduce watering slightly", "Monitor for pests", "Harvest ripe fruits", "Continue support"] },
            { week: 10, title: "Peak Harvest", tasks: ["Daily harvesting", "Sort and grade fruits", "Store properly", "Monitor plant health"] },
            { week: 11, title: "Late Harvest", tasks: ["Continue harvesting", "Remove diseased fruits", "Prepare for end season", "Plan next crop"] },
            { week: 12, title: "Season End", tasks: ["Final harvest", "Remove plant debris", "Prepare soil for next crop", "Record yields"] }
          ]
        },
        wheat: {
          name: "Wheat",
          duration: 16,
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Plow the field", "Level the land", "Remove weeds", "Test soil nutrients"] },
            { week: 2, title: "Seed Preparation", tasks: ["Select quality seeds", "Treat seeds with fungicide", "Calculate seed rate", "Prepare seed drill"] },
            { week: 3, title: "Sowing", tasks: ["Sow seeds at proper depth", "Maintain row spacing", "Cover seeds properly", "Light irrigation"] },
            { week: 4, title: "Germination", tasks: ["Monitor germination", "Check for gaps", "Light weeding", "Maintain soil moisture"] },
            { week: 5, title: "Early Growth", tasks: ["First weeding", "Apply nitrogen fertilizer", "Monitor for pests", "Light irrigation"] },
            { week: 6, title: "Tillering", tasks: ["Second weeding", "Apply phosphorus", "Monitor tiller development", "Control weeds"] },
            { week: 7, title: "Vegetative Growth", tasks: ["Third weeding", "Apply potassium", "Monitor growth", "Irrigation as needed"] },
            { week: 8, title: "Stem Elongation", tasks: ["Monitor stem growth", "Apply micronutrients", "Check for diseases", "Maintain irrigation"] },
            { week: 9, title: "Heading", tasks: ["Monitor head development", "Apply final fertilizer", "Check for lodging", "Irrigation management"] },
            { week: 10, title: "Flowering", tasks: ["Monitor flowering", "Ensure pollination", "Check for pests", "Maintain moisture"] },
            { week: 11, title: "Grain Filling", tasks: ["Monitor grain development", "Apply foliar spray", "Check for diseases", "Irrigation control"] },
            { week: 12, title: "Maturity", tasks: ["Monitor grain maturity", "Check moisture content", "Prepare for harvest", "Plan harvesting"] },
            { week: 13, title: "Harvesting", tasks: ["Harvest at right time", "Use combine harvester", "Collect straw", "Grade the grain"] },
            { week: 14, title: "Post Harvest", tasks: ["Dry the grain", "Clean and grade", "Store properly", "Calculate yield"] },
            { week: 15, title: "Storage", tasks: ["Check storage conditions", "Monitor for pests", "Maintain quality", "Plan marketing"] },
            { week: 16, title: "Field Preparation", tasks: ["Remove crop residues", "Prepare for next crop", "Record yields", "Plan rotation"] }
          ]
        },
        rice: {
          name: "Rice",
          duration: 20,
          weeklyPlan: [
            { week: 1, title: "Nursery Preparation", tasks: ["Prepare nursery bed", "Level the area", "Apply organic manure", "Create seedbeds"] },
            { week: 2, title: "Seed Treatment", tasks: ["Select quality seeds", "Soak seeds in water", "Treat with fungicide", "Prepare for sowing"] },
            { week: 3, title: "Nursery Sowing", tasks: ["Sow seeds in nursery", "Cover with soil", "Maintain moisture", "Protect from birds"] },
            { week: 4, title: "Nursery Care", tasks: ["Monitor germination", "Apply light fertilizer", "Control weeds", "Maintain water level"] },
            { week: 5, title: "Field Preparation", tasks: ["Plow the main field", "Level the field", "Prepare bunds", "Install irrigation"] },
            { week: 6, title: "Transplanting", tasks: ["Uproot seedlings", "Transplant in rows", "Maintain spacing", "Water immediately"] },
            { week: 7, title: "Early Growth", tasks: ["Monitor establishment", "Apply first fertilizer", "Control weeds", "Maintain water"] },
            { week: 8, title: "Tillering", tasks: ["Monitor tiller development", "Apply nitrogen", "Control weeds", "Water management"] },
            { week: 9, title: "Active Tillering", tasks: ["Apply phosphorus", "Monitor growth", "Control pests", "Maintain irrigation"] },
            { week: 10, title: "Panicle Initiation", tasks: ["Apply potassium", "Monitor panicle development", "Check for diseases", "Water control"] },
            { week: 11, title: "Panicle Development", tasks: ["Monitor panicle growth", "Apply micronutrients", "Control pests", "Irrigation management"] },
            { week: 12, title: "Flowering", tasks: ["Monitor flowering", "Ensure pollination", "Check for pests", "Maintain moisture"] },
            { week: 13, title: "Grain Filling", tasks: ["Monitor grain development", "Apply foliar spray", "Control diseases", "Water management"] },
            { week: 14, title: "Maturity", tasks: ["Monitor grain maturity", "Check moisture content", "Prepare for harvest", "Plan harvesting"] },
            { week: 15, title: "Harvesting", tasks: ["Harvest at right time", "Use combine or manual", "Collect straw", "Grade the grain"] },
            { week: 16, title: "Post Harvest", tasks: ["Dry the grain", "Clean and grade", "Store properly", "Calculate yield"] },
            { week: 17, title: "Storage", tasks: ["Check storage conditions", "Monitor for pests", "Maintain quality", "Plan marketing"] },
            { week: 18, title: "Field Preparation", tasks: ["Remove crop residues", "Prepare for next crop", "Record yields", "Plan rotation"] },
            { week: 19, title: "Planning", tasks: ["Analyze results", "Plan improvements", "Order seeds", "Prepare equipment"] },
            { week: 20, title: "Rest", tasks: ["Field rest period", "Equipment maintenance", "Market analysis", "Next season planning"] }
          ]
        },
        corn: {
          name: "Corn",
          duration: 14,
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Plow and harrow field", "Remove weeds and debris", "Test soil pH (6.0-7.0)", "Apply organic matter"] },
            { week: 2, title: "Seed Selection", tasks: ["Choose hybrid seeds", "Treat seeds with fungicide", "Calculate seed rate", "Prepare planting equipment"] },
            { week: 3, title: "Planting", tasks: ["Plant seeds 2-3cm deep", "Maintain 75cm row spacing", "Space plants 25cm apart", "Water immediately"] },
            { week: 4, title: "Early Growth", tasks: ["Monitor germination", "Check for gaps", "Light weeding", "Apply starter fertilizer"] },
            { week: 5, title: "Vegetative Growth", tasks: ["Apply nitrogen fertilizer", "Control weeds", "Monitor for pests", "Maintain soil moisture"] },
            { week: 6, title: "Rapid Growth", tasks: ["Apply second nitrogen dose", "Continue weed control", "Check for diseases", "Irrigation as needed"] },
            { week: 7, title: "Tasseling", tasks: ["Monitor tassel emergence", "Apply final fertilizer", "Check for lodging", "Maintain irrigation"] },
            { week: 8, title: "Silking", tasks: ["Monitor silk emergence", "Ensure pollination", "Check for pests", "Water management"] },
            { week: 9, title: "Grain Filling", tasks: ["Monitor kernel development", "Apply foliar spray", "Control diseases", "Maintain moisture"] },
            { week: 10, title: "Maturity", tasks: ["Check kernel maturity", "Monitor moisture content", "Prepare for harvest", "Plan harvesting"] },
            { week: 11, title: "Harvesting", tasks: ["Harvest at 20-25% moisture", "Use combine harvester", "Collect stover", "Grade the grain"] },
            { week: 12, title: "Post Harvest", tasks: ["Dry the grain", "Clean and grade", "Store properly", "Calculate yield"] },
            { week: 13, title: "Storage", tasks: ["Check storage conditions", "Monitor for pests", "Maintain quality", "Plan marketing"] },
            { week: 14, title: "Field Preparation", tasks: ["Remove crop residues", "Prepare for next crop", "Record yields", "Plan rotation"] }
          ]
        },
        potato: {
          name: "Potato",
          duration: 16,
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Deep plowing", "Remove stones and debris", "Test soil pH (5.5-6.5)", "Apply organic manure"] },
            { week: 2, title: "Seed Preparation", tasks: ["Select healthy seed tubers", "Cut tubers with 2-3 eyes", "Treat with fungicide", "Allow cut surfaces to heal"] },
            { week: 3, title: "Planting", tasks: ["Plant tubers 10-15cm deep", "Maintain 60cm row spacing", "Space plants 25cm apart", "Cover with soil"] },
            { week: 4, title: "Emergence", tasks: ["Monitor sprout emergence", "Check for gaps", "Light weeding", "Maintain soil moisture"] },
            { week: 5, title: "Early Growth", tasks: ["Apply first fertilizer", "Control weeds", "Monitor for pests", "Light irrigation"] },
            { week: 6, title: "Vegetative Growth", tasks: ["Apply second fertilizer", "Continue weed control", "Check for diseases", "Maintain irrigation"] },
            { week: 7, title: "Rapid Growth", tasks: ["Apply final fertilizer", "Control weeds", "Monitor growth", "Irrigation management"] },
            { week: 8, title: "Tuber Initiation", tasks: ["Monitor tuber formation", "Apply potassium", "Check for pests", "Maintain moisture"] },
            { week: 9, title: "Tuber Development", tasks: ["Monitor tuber growth", "Apply micronutrients", "Control diseases", "Water management"] },
            { week: 10, title: "Tuber Bulking", tasks: ["Monitor tuber size", "Apply foliar spray", "Check for pests", "Maintain irrigation"] },
            { week: 11, title: "Maturity", tasks: ["Check tuber maturity", "Monitor skin set", "Prepare for harvest", "Plan harvesting"] },
            { week: 12, title: "Harvesting", tasks: ["Harvest at right time", "Use potato harvester", "Sort and grade", "Handle carefully"] },
            { week: 13, title: "Post Harvest", tasks: ["Cure the tubers", "Store in cool place", "Monitor for rot", "Calculate yield"] },
            { week: 14, title: "Storage", tasks: ["Check storage conditions", "Monitor temperature", "Maintain quality", "Plan marketing"] },
            { week: 15, title: "Field Preparation", tasks: ["Remove crop residues", "Prepare for next crop", "Record yields", "Plan rotation"] },
            { week: 16, title: "Planning", tasks: ["Analyze results", "Plan improvements", "Order seeds", "Prepare equipment"] }
          ]
        },
        onion: {
          name: "Onion",
          duration: 18,
          weeklyPlan: [
            { week: 1, title: "Nursery Preparation", tasks: ["Prepare raised beds", "Apply organic manure", "Level the surface", "Create seedbeds"] },
            { week: 2, title: "Seed Sowing", tasks: ["Sow seeds thinly", "Cover with soil", "Maintain moisture", "Protect from birds"] },
            { week: 3, title: "Nursery Care", tasks: ["Monitor germination", "Apply light fertilizer", "Control weeds", "Maintain water"] },
            { week: 4, title: "Seedling Growth", tasks: ["Monitor growth", "Apply nitrogen", "Control pests", "Maintain irrigation"] },
            { week: 5, title: "Field Preparation", tasks: ["Plow the main field", "Apply organic matter", "Prepare ridges", "Install irrigation"] },
            { week: 6, title: "Transplanting", tasks: ["Uproot seedlings", "Transplant on ridges", "Maintain spacing", "Water immediately"] },
            { week: 7, title: "Establishment", tasks: ["Monitor establishment", "Apply first fertilizer", "Control weeds", "Maintain water"] },
            { week: 8, title: "Early Growth", tasks: ["Apply nitrogen", "Control weeds", "Monitor for pests", "Light irrigation"] },
            { week: 9, title: "Vegetative Growth", tasks: ["Apply phosphorus", "Continue weed control", "Check for diseases", "Maintain irrigation"] },
            { week: 10, title: "Bulb Initiation", tasks: ["Apply potassium", "Monitor bulb formation", "Control pests", "Water management"] },
            { week: 11, title: "Bulb Development", tasks: ["Monitor bulb growth", "Apply micronutrients", "Control diseases", "Irrigation management"] },
            { week: 12, title: "Bulb Maturation", tasks: ["Monitor bulb size", "Apply foliar spray", "Check for pests", "Maintain moisture"] },
            { week: 13, title: "Maturity", tasks: ["Check bulb maturity", "Monitor neck fall", "Prepare for harvest", "Plan harvesting"] },
            { week: 14, title: "Harvesting", tasks: ["Harvest at right time", "Use proper tools", "Sort and grade", "Handle carefully"] },
            { week: 15, title: "Curing", tasks: ["Cure the bulbs", "Dry properly", "Monitor for rot", "Prepare for storage"] },
            { week: 16, title: "Storage", tasks: ["Store in cool place", "Monitor conditions", "Maintain quality", "Plan marketing"] },
            { week: 17, title: "Field Preparation", tasks: ["Remove crop residues", "Prepare for next crop", "Record yields", "Plan rotation"] },
            { week: 18, title: "Planning", tasks: ["Analyze results", "Plan improvements", "Order seeds", "Prepare equipment"] }
          ]
        },
        chili: {
          name: "Chili",
          duration: 20,
          weeklyPlan: [
            { week: 1, title: "Nursery Preparation", tasks: ["Prepare seedbeds", "Apply organic manure", "Level the surface", "Create raised beds"] },
            { week: 2, title: "Seed Treatment", tasks: ["Select quality seeds", "Treat with fungicide", "Soak in water", "Prepare for sowing"] },
            { week: 3, title: "Nursery Sowing", tasks: ["Sow seeds thinly", "Cover with soil", "Maintain moisture", "Protect from birds"] },
            { week: 4, title: "Nursery Care", tasks: ["Monitor germination", "Apply light fertilizer", "Control weeds", "Maintain water level"] },
            { week: 5, title: "Field Preparation", tasks: ["Plow the main field", "Apply organic matter", "Prepare ridges", "Install irrigation"] },
            { week: 6, title: "Transplanting", tasks: ["Uproot seedlings", "Transplant on ridges", "Maintain spacing", "Water immediately"] },
            { week: 7, title: "Establishment", tasks: ["Monitor establishment", "Apply first fertilizer", "Control weeds", "Maintain water"] },
            { week: 8, title: "Early Growth", tasks: ["Apply nitrogen", "Control weeds", "Monitor for pests", "Light irrigation"] },
            { week: 9, title: "Vegetative Growth", tasks: ["Apply phosphorus", "Continue weed control", "Check for diseases", "Maintain irrigation"] },
            { week: 10, title: "Flowering", tasks: ["Monitor flower development", "Apply potassium", "Control pests", "Water management"] },
            { week: 11, title: "Fruit Setting", tasks: ["Monitor fruit set", "Apply micronutrients", "Control diseases", "Irrigation management"] },
            { week: 12, title: "Fruit Development", tasks: ["Monitor fruit growth", "Apply foliar spray", "Check for pests", "Maintain moisture"] },
            { week: 13, title: "First Harvest", tasks: ["Harvest first fruits", "Continue care", "Monitor plant health", "Regular picking"] },
            { week: 14, title: "Peak Harvest", tasks: ["Daily harvesting", "Sort and grade", "Store properly", "Monitor quality"] },
            { week: 15, title: "Late Harvest", tasks: ["Continue harvesting", "Remove diseased fruits", "Prepare for end season", "Plan next crop"] },
            { week: 16, title: "Final Harvest", tasks: ["Final harvest", "Remove plant debris", "Prepare soil", "Record yields"] },
            { week: 17, title: "Post Harvest", tasks: ["Dry the fruits", "Process for storage", "Monitor quality", "Plan marketing"] },
            { week: 18, title: "Storage", tasks: ["Store properly", "Monitor conditions", "Maintain quality", "Plan sales"] },
            { week: 19, title: "Field Preparation", tasks: ["Remove crop residues", "Prepare for next crop", "Record yields", "Plan rotation"] },
            { week: 20, title: "Planning", tasks: ["Analyze results", "Plan improvements", "Order seeds", "Prepare equipment"] }
          ]
        },
        cotton: {
          name: "Cotton",
          duration: 24,
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Deep plowing", "Remove weeds", "Test soil pH (6.0-8.0)", "Apply organic matter"] },
            { week: 2, title: "Seed Preparation", tasks: ["Select quality seeds", "Treat with fungicide", "Calculate seed rate", "Prepare planting equipment"] },
            { week: 3, title: "Planting", tasks: ["Plant seeds 2-3cm deep", "Maintain 90cm row spacing", "Space plants 30cm apart", "Water immediately"] },
            { week: 4, title: "Emergence", tasks: ["Monitor germination", "Check for gaps", "Light weeding", "Maintain soil moisture"] },
            { week: 5, title: "Early Growth", tasks: ["Apply first fertilizer", "Control weeds", "Monitor for pests", "Light irrigation"] },
            { week: 6, title: "Vegetative Growth", tasks: ["Apply second fertilizer", "Continue weed control", "Check for diseases", "Maintain irrigation"] },
            { week: 7, title: "Rapid Growth", tasks: ["Apply third fertilizer", "Control weeds", "Monitor growth", "Irrigation management"] },
            { week: 8, title: "Square Formation", tasks: ["Monitor square development", "Apply final fertilizer", "Check for pests", "Maintain moisture"] },
            { week: 9, title: "Flowering", tasks: ["Monitor flower development", "Apply micronutrients", "Control pests", "Water management"] },
            { week: 10, title: "Boll Formation", tasks: ["Monitor boll development", "Apply foliar spray", "Control diseases", "Irrigation management"] },
            { week: 11, title: "Boll Development", tasks: ["Monitor boll growth", "Continue pest control", "Check for diseases", "Maintain moisture"] },
            { week: 12, title: "Boll Maturation", tasks: ["Monitor boll maturity", "Apply final spray", "Check for pests", "Prepare for harvest"] },
            { week: 13, title: "First Picking", tasks: ["Harvest first bolls", "Continue care", "Monitor plant health", "Regular picking"] },
            { week: 14, title: "Peak Picking", tasks: ["Daily picking", "Sort and grade", "Store properly", "Monitor quality"] },
            { week: 15, title: "Late Picking", tasks: ["Continue picking", "Remove diseased bolls", "Prepare for end season", "Plan next crop"] },
            { week: 16, title: "Final Picking", tasks: ["Final harvest", "Remove plant debris", "Prepare soil", "Record yields"] },
            { week: 17, title: "Ginning", tasks: ["Separate cotton from seeds", "Grade the cotton", "Package properly", "Store safely"] },
            { week: 18, title: "Storage", tasks: ["Store in dry place", "Monitor conditions", "Maintain quality", "Plan marketing"] },
            { week: 19, title: "Marketing", tasks: ["Grade and price", "Find buyers", "Negotiate prices", "Plan sales"] },
            { week: 20, title: "Field Preparation", tasks: ["Remove crop residues", "Prepare for next crop", "Record yields", "Plan rotation"] },
            { week: 21, title: "Planning", tasks: ["Analyze results", "Plan improvements", "Order seeds", "Prepare equipment"] },
            { week: 22, title: "Equipment Maintenance", tasks: ["Clean and repair equipment", "Store properly", "Plan for next season", "Update records"] },
            { week: 23, title: "Market Analysis", tasks: ["Analyze market trends", "Plan pricing strategy", "Research new varieties", "Update knowledge"] },
            { week: 24, title: "Rest", tasks: ["Field rest period", "Personal rest", "Family time", "Next season planning"] }
          ]
        },
        sugarcane: {
          name: "Sugarcane",
          duration: 52,
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Deep plowing", "Remove weeds", "Test soil pH (6.0-7.5)", "Apply organic matter"] },
            { week: 2, title: "Seed Preparation", tasks: ["Select healthy setts", "Treat with fungicide", "Calculate seed rate", "Prepare planting equipment"] },
            { week: 3, title: "Planting", tasks: ["Plant setts in furrows", "Maintain 90cm row spacing", "Cover with soil", "Water immediately"] },
            { week: 4, title: "Emergence", tasks: ["Monitor sprout emergence", "Check for gaps", "Light weeding", "Maintain soil moisture"] },
            { week: 5, title: "Early Growth", tasks: ["Apply first fertilizer", "Control weeds", "Monitor for pests", "Light irrigation"] },
            { week: 6, title: "Vegetative Growth", tasks: ["Apply second fertilizer", "Continue weed control", "Check for diseases", "Maintain irrigation"] },
            { week: 7, title: "Rapid Growth", tasks: ["Apply third fertilizer", "Control weeds", "Monitor growth", "Irrigation management"] },
            { week: 8, title: "Tillering", tasks: ["Monitor tiller development", "Apply nitrogen", "Control pests", "Maintain moisture"] },
            { week: 9, title: "Active Tillering", tasks: ["Apply phosphorus", "Continue weed control", "Check for diseases", "Maintain irrigation"] },
            { week: 10, title: "Grand Growth", tasks: ["Apply potassium", "Monitor growth", "Control pests", "Water management"] },
            { week: 11, title: "Peak Growth", tasks: ["Apply micronutrients", "Continue care", "Monitor for diseases", "Irrigation management"] },
            { week: 12, title: "Maturity", tasks: ["Monitor cane maturity", "Check sugar content", "Prepare for harvest", "Plan harvesting"] },
            { week: 13, title: "Harvesting", tasks: ["Harvest at right time", "Use proper tools", "Sort and grade", "Transport to mill"] },
            { week: 14, title: "Post Harvest", tasks: ["Remove crop residues", "Prepare for next crop", "Record yields", "Plan rotation"] },
            { week: 15, title: "Field Preparation", tasks: ["Plow the field", "Apply organic matter", "Prepare for next crop", "Plan rotation"] },
            { week: 16, title: "Planning", tasks: ["Analyze results", "Plan improvements", "Order seeds", "Prepare equipment"] },
            { week: 17, title: "Equipment Maintenance", tasks: ["Clean and repair equipment", "Store properly", "Plan for next season", "Update records"] },
            { week: 18, title: "Market Analysis", tasks: ["Analyze market trends", "Plan pricing strategy", "Research new varieties", "Update knowledge"] },
            { week: 19, title: "Rest", tasks: ["Field rest period", "Personal rest", "Family time", "Next season planning"] },
            { week: 20, title: "Preparation", tasks: ["Prepare for next season", "Order inputs", "Plan field layout", "Update records"] },
            { week: 21, title: "Soil Testing", tasks: ["Test soil nutrients", "Plan fertilizer schedule", "Check pH levels", "Plan amendments"] },
            { week: 22, title: "Seed Selection", tasks: ["Select new varieties", "Order quality seeds", "Plan planting schedule", "Prepare equipment"] },
            { week: 23, title: "Field Layout", tasks: ["Plan field layout", "Mark planting rows", "Prepare irrigation", "Plan drainage"] },
            { week: 24, title: "Final Preparation", tasks: ["Final field preparation", "Check equipment", "Plan planting date", "Prepare inputs"] },
            { week: 25, title: "Planting Season", tasks: ["Start planting", "Monitor progress", "Check quality", "Maintain schedule"] },
            { week: 26, title: "Early Care", tasks: ["Monitor establishment", "Apply first fertilizer", "Control weeds", "Maintain irrigation"] },
            { week: 27, title: "Growth Monitoring", tasks: ["Monitor growth", "Apply second fertilizer", "Control pests", "Maintain irrigation"] },
            { week: 28, title: "Mid Season Care", tasks: ["Apply third fertilizer", "Continue weed control", "Check for diseases", "Maintain irrigation"] },
            { week: 29, title: "Peak Growth", tasks: ["Monitor peak growth", "Apply final fertilizer", "Control pests", "Water management"] },
            { week: 30, title: "Maturity Check", tasks: ["Check cane maturity", "Monitor sugar content", "Prepare for harvest", "Plan harvesting"] },
            { week: 31, title: "Harvest Preparation", tasks: ["Prepare harvesting equipment", "Plan harvest schedule", "Arrange transport", "Prepare storage"] },
            { week: 32, title: "Harvesting", tasks: ["Start harvesting", "Monitor quality", "Transport to mill", "Record yields"] },
            { week: 33, title: "Post Harvest", tasks: ["Complete harvesting", "Remove crop residues", "Prepare for next crop", "Record yields"] },
            { week: 34, title: "Field Preparation", tasks: ["Plow the field", "Apply organic matter", "Prepare for next crop", "Plan rotation"] },
            { week: 35, title: "Planning", tasks: ["Analyze results", "Plan improvements", "Order seeds", "Prepare equipment"] },
            { week: 36, title: "Equipment Maintenance", tasks: ["Clean and repair equipment", "Store properly", "Plan for next season", "Update records"] },
            { week: 37, title: "Market Analysis", tasks: ["Analyze market trends", "Plan pricing strategy", "Research new varieties", "Update knowledge"] },
            { week: 38, title: "Rest", tasks: ["Field rest period", "Personal rest", "Family time", "Next season planning"] },
            { week: 39, title: "Preparation", tasks: ["Prepare for next season", "Order inputs", "Plan field layout", "Update records"] },
            { week: 40, title: "Soil Testing", tasks: ["Test soil nutrients", "Plan fertilizer schedule", "Check pH levels", "Plan amendments"] },
            { week: 41, title: "Seed Selection", tasks: ["Select new varieties", "Order quality seeds", "Plan planting schedule", "Prepare equipment"] },
            { week: 42, title: "Field Layout", tasks: ["Plan field layout", "Mark planting rows", "Prepare irrigation", "Plan drainage"] },
            { week: 43, title: "Final Preparation", tasks: ["Final field preparation", "Check equipment", "Plan planting date", "Prepare inputs"] },
            { week: 44, title: "Planting Season", tasks: ["Start planting", "Monitor progress", "Check quality", "Maintain schedule"] },
            { week: 45, title: "Early Care", tasks: ["Monitor establishment", "Apply first fertilizer", "Control weeds", "Maintain irrigation"] },
            { week: 46, title: "Growth Monitoring", tasks: ["Monitor growth", "Apply second fertilizer", "Control pests", "Maintain irrigation"] },
            { week: 47, title: "Mid Season Care", tasks: ["Apply third fertilizer", "Continue weed control", "Check for diseases", "Maintain irrigation"] },
            { week: 48, title: "Peak Growth", tasks: ["Monitor peak growth", "Apply final fertilizer", "Control pests", "Water management"] },
            { week: 49, title: "Maturity Check", tasks: ["Check cane maturity", "Monitor sugar content", "Prepare for harvest", "Plan harvesting"] },
            { week: 50, title: "Harvest Preparation", tasks: ["Prepare harvesting equipment", "Plan harvest schedule", "Arrange transport", "Prepare storage"] },
            { week: 51, title: "Harvesting", tasks: ["Start harvesting", "Monitor quality", "Transport to mill", "Record yields"] },
            { week: 52, title: "Year End", tasks: ["Complete harvesting", "Remove crop residues", "Prepare for next year", "Record annual yields"] }
          ]
        },
        coconut: {
          name: "Coconut",
          duration: 260, // weeks (5 years)
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Clear the area", "Remove weeds and debris", "Test soil pH (5.5-7.0)", "Apply organic manure"] },
            { week: 2, title: "Pit Preparation", tasks: ["Dig pits 1m x 1m x 1m", "Fill with soil and compost", "Allow to settle", "Prepare for planting"] },
            { week: 3, title: "Seedling Selection", tasks: ["Choose healthy seedlings", "Check for diseases", "Prepare planting material", "Plan planting schedule"] },
            { week: 4, title: "Planting", tasks: ["Plant seedlings in pits", "Maintain proper spacing", "Water immediately", "Provide support"] },
            { week: 5, title: "Early Care", tasks: ["Monitor establishment", "Apply first fertilizer", "Control weeds", "Maintain irrigation"] },
            { week: 6, title: "Growth Phase", tasks: ["Apply nitrogen fertilizer", "Continue weed control", "Monitor for pests", "Light irrigation"] },
            { week: 7, title: "Vegetative Growth", tasks: ["Apply phosphorus", "Control weeds", "Check for diseases", "Maintain irrigation"] },
            { week: 8, title: "Rapid Growth", tasks: ["Apply potassium", "Continue care", "Monitor growth", "Irrigation management"] },
            { week: 9, title: "Establishment", tasks: ["Apply micronutrients", "Control pests", "Check for diseases", "Water management"] },
            { week: 10, title: "Mature Care", tasks: ["Regular fertilization", "Pest control", "Disease management", "Harvest planning"] }
          ]
        },
        rubber: {
          name: "Rubber",
          duration: 260, // weeks (5 years)
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Clear the area", "Remove weeds", "Test soil pH (5.5-6.5)", "Apply organic matter"] },
            { week: 2, title: "Pit Preparation", tasks: ["Dig pits 60cm x 60cm x 60cm", "Fill with soil and compost", "Allow to settle", "Prepare for planting"] },
            { week: 3, title: "Seedling Selection", tasks: ["Choose healthy seedlings", "Check for diseases", "Prepare planting material", "Plan planting schedule"] },
            { week: 4, title: "Planting", tasks: ["Plant seedlings in pits", "Maintain proper spacing", "Water immediately", "Provide support"] },
            { week: 5, title: "Early Care", tasks: ["Monitor establishment", "Apply first fertilizer", "Control weeds", "Maintain irrigation"] },
            { week: 6, title: "Growth Phase", tasks: ["Apply nitrogen fertilizer", "Continue weed control", "Monitor for pests", "Light irrigation"] },
            { week: 7, title: "Vegetative Growth", tasks: ["Apply phosphorus", "Control weeds", "Check for diseases", "Maintain irrigation"] },
            { week: 8, title: "Rapid Growth", tasks: ["Apply potassium", "Continue care", "Monitor growth", "Irrigation management"] },
            { week: 9, title: "Establishment", tasks: ["Apply micronutrients", "Control pests", "Check for diseases", "Water management"] },
            { week: 10, title: "Mature Care", tasks: ["Regular fertilization", "Pest control", "Disease management", "Tapping preparation"] }
          ]
        },
        arecanut: {
          name: "Arecanut",
          duration: 260, // weeks (5 years)
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Clear the area", "Remove weeds", "Test soil pH (6.0-7.0)", "Apply organic matter"] },
            { week: 2, title: "Pit Preparation", tasks: ["Dig pits 60cm x 60cm x 60cm", "Fill with soil and compost", "Allow to settle", "Prepare for planting"] },
            { week: 3, title: "Seedling Selection", tasks: ["Choose healthy seedlings", "Check for diseases", "Prepare planting material", "Plan planting schedule"] },
            { week: 4, title: "Planting", tasks: ["Plant seedlings in pits", "Maintain proper spacing", "Water immediately", "Provide support"] },
            { week: 5, title: "Early Care", tasks: ["Monitor establishment", "Apply first fertilizer", "Control weeds", "Maintain irrigation"] },
            { week: 6, title: "Growth Phase", tasks: ["Apply nitrogen fertilizer", "Continue weed control", "Monitor for pests", "Light irrigation"] },
            { week: 7, title: "Vegetative Growth", tasks: ["Apply phosphorus", "Control weeds", "Check for diseases", "Maintain irrigation"] },
            { week: 8, title: "Rapid Growth", tasks: ["Apply potassium", "Continue care", "Monitor growth", "Irrigation management"] },
            { week: 9, title: "Establishment", tasks: ["Apply micronutrients", "Control pests", "Check for diseases", "Water management"] },
            { week: 10, title: "Mature Care", tasks: ["Regular fertilization", "Pest control", "Disease management", "Harvest planning"] }
          ]
        },
        cashew_nut: {
          name: "Cashew Nut",
          duration: 260, // weeks (5 years)
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Clear the area", "Remove weeds", "Test soil pH (6.0-7.0)", "Apply organic matter"] },
            { week: 2, title: "Pit Preparation", tasks: ["Dig pits 60cm x 60cm x 60cm", "Fill with soil and compost", "Allow to settle", "Prepare for planting"] },
            { week: 3, title: "Seedling Selection", tasks: ["Choose healthy seedlings", "Check for diseases", "Prepare planting material", "Plan planting schedule"] },
            { week: 4, title: "Planting", tasks: ["Plant seedlings in pits", "Maintain proper spacing", "Water immediately", "Provide support"] },
            { week: 5, title: "Early Care", tasks: ["Monitor establishment", "Apply first fertilizer", "Control weeds", "Maintain irrigation"] },
            { week: 6, title: "Growth Phase", tasks: ["Apply nitrogen fertilizer", "Continue weed control", "Monitor for pests", "Light irrigation"] },
            { week: 7, title: "Vegetative Growth", tasks: ["Apply phosphorus", "Control weeds", "Check for diseases", "Maintain irrigation"] },
            { week: 8, title: "Rapid Growth", tasks: ["Apply potassium", "Continue care", "Monitor growth", "Irrigation management"] },
            { week: 9, title: "Establishment", tasks: ["Apply micronutrients", "Control pests", "Check for diseases", "Water management"] },
            { week: 10, title: "Mature Care", tasks: ["Regular fertilization", "Pest control", "Disease management", "Harvest planning"] }
          ]
        },
        cocoa: {
          name: "Cocoa",
          duration: 260, // weeks (5 years)
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Clear the area", "Remove weeds", "Test soil pH (6.0-7.0)", "Apply organic matter"] },
            { week: 2, title: "Pit Preparation", tasks: ["Dig pits 60cm x 60cm x 60cm", "Fill with soil and compost", "Allow to settle", "Prepare for planting"] },
            { week: 3, title: "Seedling Selection", tasks: ["Choose healthy seedlings", "Check for diseases", "Prepare planting material", "Plan planting schedule"] },
            { week: 4, title: "Planting", tasks: ["Plant seedlings in pits", "Maintain proper spacing", "Water immediately", "Provide support"] },
            { week: 5, title: "Early Care", tasks: ["Monitor establishment", "Apply first fertilizer", "Control weeds", "Maintain irrigation"] },
            { week: 6, title: "Growth Phase", tasks: ["Apply nitrogen fertilizer", "Continue weed control", "Monitor for pests", "Light irrigation"] },
            { week: 7, title: "Vegetative Growth", tasks: ["Apply phosphorus", "Control weeds", "Check for diseases", "Maintain irrigation"] },
            { week: 8, title: "Rapid Growth", tasks: ["Apply potassium", "Continue care", "Monitor growth", "Irrigation management"] },
            { week: 9, title: "Establishment", tasks: ["Apply micronutrients", "Control pests", "Check for diseases", "Water management"] },
            { week: 10, title: "Mature Care", tasks: ["Regular fertilization", "Pest control", "Disease management", "Harvest planning"] }
          ]
        },
        coffee: {
          name: "Coffee",
          duration: 260, // weeks (5 years)
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Clear the area", "Remove weeds", "Test soil pH (6.0-7.0)", "Apply organic matter"] },
            { week: 2, title: "Pit Preparation", tasks: ["Dig pits 60cm x 60cm x 60cm", "Fill with soil and compost", "Allow to settle", "Prepare for planting"] },
            { week: 3, title: "Seedling Selection", tasks: ["Choose healthy seedlings", "Check for diseases", "Prepare planting material", "Plan planting schedule"] },
            { week: 4, title: "Planting", tasks: ["Plant seedlings in pits", "Maintain proper spacing", "Water immediately", "Provide support"] },
            { week: 5, title: "Early Care", tasks: ["Monitor establishment", "Apply first fertilizer", "Control weeds", "Maintain irrigation"] },
            { week: 6, title: "Growth Phase", tasks: ["Apply nitrogen fertilizer", "Continue weed control", "Monitor for pests", "Light irrigation"] },
            { week: 7, title: "Vegetative Growth", tasks: ["Apply phosphorus", "Control weeds", "Check for diseases", "Maintain irrigation"] },
            { week: 8, title: "Rapid Growth", tasks: ["Apply potassium", "Continue care", "Monitor growth", "Irrigation management"] },
            { week: 9, title: "Establishment", tasks: ["Apply micronutrients", "Control pests", "Check for diseases", "Water management"] },
            { week: 10, title: "Mature Care", tasks: ["Regular fertilization", "Pest control", "Disease management", "Harvest planning"] }
          ]
        },
        tea: {
          name: "Tea",
          duration: 260, // weeks (5 years)
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Clear the area", "Remove weeds", "Test soil pH (5.0-6.0)", "Apply organic matter"] },
            { week: 2, title: "Pit Preparation", tasks: ["Dig pits 60cm x 60cm x 60cm", "Fill with soil and compost", "Allow to settle", "Prepare for planting"] },
            { week: 3, title: "Seedling Selection", tasks: ["Choose healthy seedlings", "Check for diseases", "Prepare planting material", "Plan planting schedule"] },
            { week: 4, title: "Planting", tasks: ["Plant seedlings in pits", "Maintain proper spacing", "Water immediately", "Provide support"] },
            { week: 5, title: "Early Care", tasks: ["Monitor establishment", "Apply first fertilizer", "Control weeds", "Maintain irrigation"] },
            { week: 6, title: "Growth Phase", tasks: ["Apply nitrogen fertilizer", "Continue weed control", "Monitor for pests", "Light irrigation"] },
            { week: 7, title: "Vegetative Growth", tasks: ["Apply phosphorus", "Control weeds", "Check for diseases", "Maintain irrigation"] },
            { week: 8, title: "Rapid Growth", tasks: ["Apply potassium", "Continue care", "Monitor growth", "Irrigation management"] },
            { week: 9, title: "Establishment", tasks: ["Apply micronutrients", "Control pests", "Check for diseases", "Water management"] },
            { week: 10, title: "Mature Care", tasks: ["Regular fertilization", "Pest control", "Disease management", "Harvest planning"] }
          ]
        },
        maize: {
          name: "Maize",
          duration: 16,
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Plow and harrow field", "Remove weeds and debris", "Test soil pH (6.0-7.0)", "Apply organic matter"] },
            { week: 2, title: "Seed Selection", tasks: ["Choose hybrid seeds", "Treat seeds with fungicide", "Calculate seed rate", "Prepare planting equipment"] },
            { week: 3, title: "Planting", tasks: ["Plant seeds 3-4cm deep", "Maintain 75cm row spacing", "Space plants 25cm apart", "Water immediately"] },
            { week: 4, title: "Emergence", tasks: ["Monitor germination", "Check for gaps", "Light weeding", "Maintain soil moisture"] },
            { week: 5, title: "Early Growth", tasks: ["Apply first fertilizer", "Control weeds", "Monitor for pests", "Light irrigation"] },
            { week: 6, title: "Vegetative Growth", tasks: ["Apply second fertilizer", "Continue weed control", "Check for diseases", "Maintain irrigation"] },
            { week: 7, title: "Rapid Growth", tasks: ["Apply third fertilizer", "Control weeds", "Monitor growth", "Irrigation management"] },
            { week: 8, title: "Tasseling", tasks: ["Monitor tassel emergence", "Apply final fertilizer", "Check for lodging", "Maintain irrigation"] },
            { week: 9, title: "Silking", tasks: ["Monitor silk emergence", "Ensure pollination", "Check for pests", "Water management"] },
            { week: 10, title: "Grain Filling", tasks: ["Monitor kernel development", "Apply foliar spray", "Control diseases", "Maintain moisture"] },
            { week: 11, title: "Maturity", tasks: ["Check kernel maturity", "Monitor moisture content", "Prepare for harvest", "Plan harvesting"] },
            { week: 12, title: "Harvesting", tasks: ["Harvest at 20-25% moisture", "Use combine harvester", "Collect stover", "Grade the grain"] },
            { week: 13, title: "Post Harvest", tasks: ["Dry the grain", "Clean and grade", "Store properly", "Calculate yield"] },
            { week: 14, title: "Storage", tasks: ["Check storage conditions", "Monitor for pests", "Maintain quality", "Plan marketing"] },
            { week: 15, title: "Field Preparation", tasks: ["Remove crop residues", "Prepare for next crop", "Record yields", "Plan rotation"] },
            { week: 16, title: "Planning", tasks: ["Analyze results", "Plan improvements", "Order seeds", "Prepare equipment"] }
          ]
        },
        finger_millet: {
          name: "Finger Millet",
          duration: 16,
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Plow and harrow field", "Remove weeds and debris", "Test soil pH (6.0-7.0)", "Apply organic matter"] },
            { week: 2, title: "Seed Selection", tasks: ["Choose quality seeds", "Treat seeds with fungicide", "Calculate seed rate", "Prepare planting equipment"] },
            { week: 3, title: "Planting", tasks: ["Plant seeds 2-3cm deep", "Maintain 30cm row spacing", "Space plants 10cm apart", "Water immediately"] },
            { week: 4, title: "Emergence", tasks: ["Monitor germination", "Check for gaps", "Light weeding", "Maintain soil moisture"] },
            { week: 5, title: "Early Growth", tasks: ["Apply first fertilizer", "Control weeds", "Monitor for pests", "Light irrigation"] },
            { week: 6, title: "Vegetative Growth", tasks: ["Apply second fertilizer", "Continue weed control", "Check for diseases", "Maintain irrigation"] },
            { week: 7, title: "Rapid Growth", tasks: ["Apply third fertilizer", "Control weeds", "Monitor growth", "Irrigation management"] },
            { week: 8, title: "Flowering", tasks: ["Monitor flower development", "Apply final fertilizer", "Check for pests", "Maintain irrigation"] },
            { week: 9, title: "Grain Filling", tasks: ["Monitor grain development", "Apply foliar spray", "Control diseases", "Maintain moisture"] },
            { week: 10, title: "Maturity", tasks: ["Check grain maturity", "Monitor moisture content", "Prepare for harvest", "Plan harvesting"] },
            { week: 11, title: "Harvesting", tasks: ["Harvest at right time", "Use sickle or combine", "Collect straw", "Grade the grain"] },
            { week: 12, title: "Post Harvest", tasks: ["Dry the grain", "Clean and grade", "Store properly", "Calculate yield"] },
            { week: 13, title: "Storage", tasks: ["Check storage conditions", "Monitor for pests", "Maintain quality", "Plan marketing"] },
            { week: 14, title: "Field Preparation", tasks: ["Remove crop residues", "Prepare for next crop", "Record yields", "Plan rotation"] },
            { week: 15, title: "Planning", tasks: ["Analyze results", "Plan improvements", "Order seeds", "Prepare equipment"] },
            { week: 16, title: "Rest", tasks: ["Field rest period", "Equipment maintenance", "Market analysis", "Next season planning"] }
          ]
        },
        red_gram: {
          name: "Red Gram",
          duration: 20,
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Plow and harrow field", "Remove weeds and debris", "Test soil pH (6.0-7.0)", "Apply organic matter"] },
            { week: 2, title: "Seed Selection", tasks: ["Choose quality seeds", "Treat seeds with fungicide", "Calculate seed rate", "Prepare planting equipment"] },
            { week: 3, title: "Planting", tasks: ["Plant seeds 3-4cm deep", "Maintain 45cm row spacing", "Space plants 15cm apart", "Water immediately"] },
            { week: 4, title: "Emergence", tasks: ["Monitor germination", "Check for gaps", "Light weeding", "Maintain soil moisture"] },
            { week: 5, title: "Early Growth", tasks: ["Apply first fertilizer", "Control weeds", "Monitor for pests", "Light irrigation"] },
            { week: 6, title: "Vegetative Growth", tasks: ["Apply second fertilizer", "Continue weed control", "Check for diseases", "Maintain irrigation"] },
            { week: 7, title: "Rapid Growth", tasks: ["Apply third fertilizer", "Control weeds", "Monitor growth", "Irrigation management"] },
            { week: 8, title: "Flowering", tasks: ["Monitor flower development", "Apply final fertilizer", "Check for pests", "Maintain irrigation"] },
            { week: 9, title: "Pod Formation", tasks: ["Monitor pod development", "Apply foliar spray", "Control diseases", "Maintain moisture"] },
            { week: 10, title: "Pod Development", tasks: ["Monitor pod growth", "Continue pest control", "Check for diseases", "Maintain moisture"] },
            { week: 11, title: "Pod Maturation", tasks: ["Monitor pod maturity", "Apply final spray", "Check for pests", "Prepare for harvest"] },
            { week: 12, title: "Harvesting", tasks: ["Harvest at right time", "Use sickle or combine", "Collect pods", "Grade the grain"] },
            { week: 13, title: "Post Harvest", tasks: ["Dry the grain", "Clean and grade", "Store properly", "Calculate yield"] },
            { week: 14, title: "Storage", tasks: ["Check storage conditions", "Monitor for pests", "Maintain quality", "Plan marketing"] },
            { week: 15, title: "Field Preparation", tasks: ["Remove crop residues", "Prepare for next crop", "Record yields", "Plan rotation"] },
            { week: 16, title: "Planning", tasks: ["Analyze results", "Plan improvements", "Order seeds", "Prepare equipment"] },
            { week: 17, title: "Equipment Maintenance", tasks: ["Clean and repair equipment", "Store properly", "Plan for next season", "Update records"] },
            { week: 18, title: "Market Analysis", tasks: ["Analyze market trends", "Plan pricing strategy", "Research new varieties", "Update knowledge"] },
            { week: 19, title: "Rest", tasks: ["Field rest period", "Personal rest", "Family time", "Next season planning"] },
            { week: 20, title: "Preparation", tasks: ["Prepare for next season", "Order seeds", "Plan rotation", "Update records"] }
          ]
        },
        green_gram: {
          name: "Green Gram",
          duration: 12,
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Plow and harrow field", "Remove weeds and debris", "Test soil pH (6.0-7.0)", "Apply organic matter"] },
            { week: 2, title: "Seed Selection", tasks: ["Choose quality seeds", "Treat seeds with fungicide", "Calculate seed rate", "Prepare planting equipment"] },
            { week: 3, title: "Planting", tasks: ["Plant seeds 2-3cm deep", "Maintain 30cm row spacing", "Space plants 10cm apart", "Water immediately"] },
            { week: 4, title: "Emergence", tasks: ["Monitor germination", "Check for gaps", "Light weeding", "Maintain soil moisture"] },
            { week: 5, title: "Early Growth", tasks: ["Apply first fertilizer", "Control weeds", "Monitor for pests", "Light irrigation"] },
            { week: 6, title: "Vegetative Growth", tasks: ["Apply second fertilizer", "Continue weed control", "Check for diseases", "Maintain irrigation"] },
            { week: 7, title: "Rapid Growth", tasks: ["Apply third fertilizer", "Control weeds", "Monitor growth", "Irrigation management"] },
            { week: 8, title: "Flowering", tasks: ["Monitor flower development", "Apply final fertilizer", "Check for pests", "Maintain irrigation"] },
            { week: 9, title: "Pod Formation", tasks: ["Monitor pod development", "Apply foliar spray", "Control diseases", "Maintain moisture"] },
            { week: 10, title: "Pod Development", tasks: ["Monitor pod growth", "Continue pest control", "Check for diseases", "Maintain moisture"] },
            { week: 11, title: "Harvesting", tasks: ["Harvest at right time", "Use sickle or combine", "Collect pods", "Grade the grain"] },
            { week: 12, title: "Post Harvest", tasks: ["Dry the grain", "Clean and grade", "Store properly", "Calculate yield"] }
          ]
        },
        black_gram: {
          name: "Black Gram",
          duration: 12,
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Plow and harrow field", "Remove weeds and debris", "Test soil pH (6.0-7.0)", "Apply organic matter"] },
            { week: 2, title: "Seed Selection", tasks: ["Choose quality seeds", "Treat seeds with fungicide", "Calculate seed rate", "Prepare planting equipment"] },
            { week: 3, title: "Planting", tasks: ["Plant seeds 2-3cm deep", "Maintain 30cm row spacing", "Space plants 10cm apart", "Water immediately"] },
            { week: 4, title: "Emergence", tasks: ["Monitor germination", "Check for gaps", "Light weeding", "Maintain soil moisture"] },
            { week: 5, title: "Early Growth", tasks: ["Apply first fertilizer", "Control weeds", "Monitor for pests", "Light irrigation"] },
            { week: 6, title: "Vegetative Growth", tasks: ["Apply second fertilizer", "Continue weed control", "Check for diseases", "Maintain irrigation"] },
            { week: 7, title: "Rapid Growth", tasks: ["Apply third fertilizer", "Control weeds", "Monitor growth", "Irrigation management"] },
            { week: 8, title: "Flowering", tasks: ["Monitor flower development", "Apply final fertilizer", "Check for pests", "Maintain irrigation"] },
            { week: 9, title: "Pod Formation", tasks: ["Monitor pod development", "Apply foliar spray", "Control diseases", "Maintain moisture"] },
            { week: 10, title: "Pod Development", tasks: ["Monitor pod growth", "Continue pest control", "Check for diseases", "Maintain moisture"] },
            { week: 11, title: "Harvesting", tasks: ["Harvest at right time", "Use sickle or combine", "Collect pods", "Grade the grain"] },
            { week: 12, title: "Post Harvest", tasks: ["Dry the grain", "Clean and grade", "Store properly", "Calculate yield"] }
          ]
        },
        sesame: {
          name: "Sesame",
          duration: 16,
          weeklyPlan: [
            { week: 1, title: "Land Preparation", tasks: ["Plow and harrow field", "Remove weeds and debris", "Test soil pH (6.0-7.0)", "Apply organic matter"] },
            { week: 2, title: "Seed Selection", tasks: ["Choose quality seeds", "Treat seeds with fungicide", "Calculate seed rate", "Prepare planting equipment"] },
            { week: 3, title: "Planting", tasks: ["Plant seeds 1-2cm deep", "Maintain 30cm row spacing", "Space plants 10cm apart", "Water immediately"] },
            { week: 4, title: "Emergence", tasks: ["Monitor germination", "Check for gaps", "Light weeding", "Maintain soil moisture"] },
            { week: 5, title: "Early Growth", tasks: ["Apply first fertilizer", "Control weeds", "Monitor for pests", "Light irrigation"] },
            { week: 6, title: "Vegetative Growth", tasks: ["Apply second fertilizer", "Continue weed control", "Check for diseases", "Maintain irrigation"] },
            { week: 7, title: "Rapid Growth", tasks: ["Apply third fertilizer", "Control weeds", "Monitor growth", "Irrigation management"] },
            { week: 8, title: "Flowering", tasks: ["Monitor flower development", "Apply final fertilizer", "Check for pests", "Maintain irrigation"] },
            { week: 9, title: "Pod Formation", tasks: ["Monitor pod development", "Apply foliar spray", "Control diseases", "Maintain moisture"] },
            { week: 10, title: "Pod Development", tasks: ["Monitor pod growth", "Continue pest control", "Check for diseases", "Maintain moisture"] },
            { week: 11, title: "Pod Maturation", tasks: ["Monitor pod maturity", "Apply final spray", "Check for pests", "Prepare for harvest"] },
            { week: 12, title: "Harvesting", tasks: ["Harvest at right time", "Use sickle or combine", "Collect pods", "Grade the grain"] },
            { week: 13, title: "Post Harvest", tasks: ["Dry the grain", "Clean and grade", "Store properly", "Calculate yield"] },
            { week: 14, title: "Storage", tasks: ["Check storage conditions", "Monitor for pests", "Maintain quality", "Plan marketing"] },
            { week: 15, title: "Field Preparation", tasks: ["Remove crop residues", "Prepare for next crop", "Record yields", "Plan rotation"] },
            { week: 16, title: "Planning", tasks: ["Analyze results", "Plan improvements", "Order seeds", "Prepare equipment"] }
          ]
        }
      };

      // Weather precaution data
      const weatherPrecautions = {
        sunny: {
          icon: 'Sunny',
          type: 'Sunny Weather',
          temp: '28\u00B0C',
          recommended: [
            'Irrigation during early morning or late evening',
            'Harvesting of matured crops',
            'Weeding and soil preparation',
            'Application of organic fertilizers'
          ],
          avoid: [
            'Avoid working during peak sun hours (12 PM - 3 PM)',
            "Don't apply chemical pesticides in high temperatures",
            'Avoid heavy irrigation during daytime',
            'Postpone transplanting of seedlings'
          ],
          tips: [
            'Use shade nets for sensitive crops',
            'Ensure proper hydration for farm workers',
            'Mulching can help retain soil moisture',
            'Monitor plants for signs of heat stress'
          ]
        },
        'partly-cloudy': {
          icon: 'Cloudy',
          type: 'Partly Cloudy Weather',
          temp: '26\u00B0C',
          recommended: [
            'Ideal time for planting and transplanting',
            'Application of fertilizers and nutrients',
            'Pruning and training of plants',
            'Light irrigation as needed'
          ],
          avoid: [
            'Avoid heavy pruning that might stress plants',
            "Don't apply chemicals if rain is forecasted",
            'Avoid working with wet soil to prevent compaction',
            'Postpone harvesting of grains to avoid moisture'
          ],
          tips: [
            'Monitor weather for sudden changes',
            'Good day for most farm activities',
            'Check soil moisture before irrigation',
            'Ideal conditions for photosynthesis'
          ]
        },
        rainy: {
          icon: 'Rain',
          type: 'Rainy Weather',
          temp: '24\u00B0C',
          recommended: [
            'Drainage management and field preparation',
            'Cover crops and storage protection',
            'Planning and maintenance activities',
            'Indoor tasks and equipment repair'
          ],
          avoid: [
            'Avoid field work during heavy rainfall',
            "Don't apply fertilizers or pesticides before rain",
            'Avoid working with electrical equipment in wet conditions',
            'Postpone harvesting to avoid spoilage'
          ],
          tips: [
            'Ensure proper drainage in fields',
            'Protect harvested crops from moisture',
            'Check for pest infestations that thrive in wet conditions',
            'Plan for next cropping season'
          ]
        }
      };

      // Initialize the app
      function initApp() {
        // Load expenses from localStorage
        const savedExpenses = localStorage.getItem('userExpenses');
        if (savedExpenses) {
          expensesData = JSON.parse(savedExpenses);
        }

        // Load coins from localStorage
        const savedCoins = localStorage.getItem('userCoins');
        if (savedCoins) {
          userCoins = parseInt(savedCoins);
          document.getElementById('coins-count').textContent = userCoins;
        }

        // Set user login date if not already set
        const savedLoginDate = localStorage.getItem('userLoginDate');
        if (savedLoginDate) {
          userLoginDate = new Date(savedLoginDate);
        } else {
          userLoginDate = new Date();
          localStorage.setItem('userLoginDate', userLoginDate.toISOString());
        }

        // Initialize calendar
        initCalendar();

        // Show home info button initially
        document.getElementById('home-info-btn').classList.remove('hidden');

        // Weather cards now use inline onclick handlers for single-click functionality

        // Add event listener for back button
        document.getElementById('backFromPrecaution').addEventListener('click', function() {
          hideWeatherPrecautions();
        });

        // Add event listener for info page back button
        document.getElementById('backFromInfo').addEventListener('click', function() {
          hideInfoPage();
        });

        // Add event listener for weekly plan back button
        document.getElementById('backFromWeeklyPlan').addEventListener('click', function() {
          hideWeeklyPlanPage();
        });

        // Add event listener for home info button
        document.getElementById('home-info-btn').addEventListener('click', function() {
          console.log('Home info button clicked!');
          showInfoPage();
        });

        // Add event listener for generate plan button
        document.getElementById('generatePlan').addEventListener('click', function() {
          generatePlantationPlan();
        });


        // Add file upload functionality
        var fileUploadArea = document.getElementById('file-upload-area');
        var fileUploadInput = document.getElementById('file-upload');
        if (fileUploadArea && fileUploadInput) {
          fileUploadArea.addEventListener('click', function() {
            fileUploadInput.click();
          });
          
          fileUploadInput.addEventListener('change', function(e) {
            var files = e.target.files;
            if (files.length > 0) {
              console.log('Files selected:', files.length);
              // You can add preview functionality here
            }
          });
        }

        // Add form submission functionality
        var listServiceForm = document.getElementById('listServiceForm');
        if (listServiceForm) {
          listServiceForm.addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Service form submitted!');
            
            // Get form data
            var formData = new FormData(listServiceForm);
            var serviceData = {
              serviceType: document.getElementById('service-type').value,
              description: document.getElementById('service-description').value,
              contactPerson: document.getElementById('contact-person').value,
              contactNumber: document.getElementById('contact-number').value,
              email: document.getElementById('email').value,
              location: document.getElementById('service-location').value
            };
            
            console.log('Service data:', serviceData);
            
            // Show success message
            alert('Service submitted successfully! We will review and publish it soon.');
            
            // Reset form
            listServiceForm.reset();
          });
        }

        // Add event listeners for bottom bar items
        document.querySelectorAll('.bottom-bar-item').forEach(function(item, index) {
          item.addEventListener('click', function() {
            // Remove active class from all items
            document.querySelectorAll('.bottom-bar-item').forEach(function(el) {
              el.classList.remove('active');
            });
            
            // Add active class to clicked item
            this.classList.add('active');
            
            // Handle different actions based on index
            if (index === 0) {
              // Plantation Guide - show info page
              showInfoPage();
            } else if (index === 1) {
              // Weekly Plan - show weekly plan page if plan exists
              if (window.currentPlan) {
                showWeeklyPlanPage();
              } else {
                showNotification('Please generate a plan first!');
              }
            } else if (index === 2) {
              // Farm Tips - show notification
              showNotification('Farm Tips: Use organic fertilizers, maintain proper spacing, and monitor soil moisture regularly!');
            }
          });
        });
      }

      // Show weather precautions page
      function showWeatherPrecautions(weatherType) {
        console.log('showWeatherPrecautions called with:', weatherType);
        var precautionData = weatherPrecautions[weatherType];
        console.log('Precaution data:', precautionData);

        if (precautionData) {
          console.log('Setting slide direction...');
          setPrecautionSlideDirection();
          document.getElementById('weatherPrecautionIcon').textContent = precautionData.icon;
          document.getElementById('weatherPrecautionType').textContent = (translations[currentLang][precautionData.type] || precautionData.type);
          document.getElementById('weatherPrecautionTemp').textContent = precautionData.temp;

          // Populate recommended activities
          var recommendedList = document.getElementById('recommendedActivities');
          recommendedList.innerHTML = '';
          precautionData.recommended.forEach(function(activity) {
            var li = document.createElement('li');
            li.textContent = (translations[currentLang][activity] || activity);
            recommendedList.appendChild(li);
          });

          // Populate activities to avoid
          var avoidList = document.getElementById('activitiesToAvoid');
          avoidList.innerHTML = '';
          precautionData.avoid.forEach(function(activity) {
            var li = document.createElement('li');
            li.textContent = (translations[currentLang][activity] || activity);
            avoidList.appendChild(li);
          });

          // Populate additional tips
          var tipsList = document.getElementById('additionalTips');
          tipsList.innerHTML = '';
          precautionData.tips.forEach(function(tip) {
            var li = document.createElement('li');
            li.textContent = (translations[currentLang][tip] || tip);
            tipsList.appendChild(li);
          });

          // Show the precaution page
          var wp = document.getElementById('weatherPrecautionPage');
          console.log('Weather precaution page element:', wp);
          if (wp) {
            console.log('Removing hidden class and adding active class to weather precaution page');
            wp.classList.remove('hidden');
            wp.classList.add('active');
            console.log('Page classes after update:', wp.className);
          } else {
            console.error('Weather precaution page element not found!');
          }
        } else {
          console.error('No precaution data found for weather type:', weatherType);
        }
      }

      // Make function globally accessible
      window.showWeatherPrecautions = showWeatherPrecautions;

      // Hide weather precautions page
      function hideWeatherPrecautions() {
        var wp = document.getElementById('weatherPrecautionPage');
        wp.classList.remove('active');
        wp.classList.add('hidden');
        // reset inline transforms set by swipe interaction
        wp.style.transform = '';
      }

      // Make function globally accessible
      window.hideWeatherPrecautions = hideWeatherPrecautions;

      // Show info page
      function showInfoPage() {
        console.log('showInfoPage function called');
        var infoPage = document.getElementById('infoPage');
        if (!infoPage) {
          console.error('Info page element not found!');
          return;
        }
        
        // Remove hidden class and add active class
        infoPage.classList.remove('hidden');
        infoPage.classList.add('active');
        
        // Show plantation bottom bar
        showPlantationBottomBar();
        
        console.log('Info page classes:', infoPage.className);
        console.log('Info page should be visible now');
      }

      // Hide info page
      function hideInfoPage() {
        var infoPage = document.getElementById('infoPage');
        infoPage.classList.remove('active');
        infoPage.classList.add('hidden');
        // reset inline transforms set by swipe interaction
        infoPage.style.transform = '';
        
        // Hide plantation bottom bar
        hidePlantationBottomBar();
      }

      // Show weekly plan page
      function showWeeklyPlanPage() {
        var weeklyPlanPage = document.getElementById('weeklyPlanPage');
        setWeeklyPlanSlideDirection();
        weeklyPlanPage.classList.remove('hidden');
        weeklyPlanPage.classList.add('active');
        
        // Show plantation bottom bar
        showPlantationBottomBar();
      }

      // Hide weekly plan page
      function hideWeeklyPlanPage() {
        var weeklyPlanPage = document.getElementById('weeklyPlanPage');
        weeklyPlanPage.classList.remove('active');
        weeklyPlanPage.classList.add('hidden');
        // reset inline transforms set by swipe interaction
        weeklyPlanPage.style.transform = '';
        
        // Hide plantation bottom bar
        hidePlantationBottomBar();
      }

      // Decide slide direction for weekly plan page: portrait -> bottom; landscape -> right
      function setWeeklyPlanSlideDirection() {
        var weeklyPlanPage = document.getElementById('weeklyPlanPage');
        if (!weeklyPlanPage) return;
        var portrait = window.innerHeight >= window.innerWidth;
        weeklyPlanPage.classList.remove('from-right', 'from-bottom', 'active');
        if (portrait) {
          weeklyPlanPage.classList.add('from-bottom');
        } else {
          weeklyPlanPage.classList.add('from-right');
        }
      }

      // Decide slide direction for past track page
      function setPastTrackSlideDirection() {
        var ptp = document.getElementById('pastTrackPage');
        if (!ptp) return;
        var portrait = window.innerHeight >= window.innerWidth;
        ptp.classList.remove('from-right', 'from-bottom', 'active');
        if (portrait) {
          ptp.classList.add('from-bottom');
        } else {
          ptp.classList.add('from-right');
        }
      }

      // Show plantation bottom bar
      function showPlantationBottomBar() {
        var bottomBar = document.getElementById('plantationBottomBar');
        if (bottomBar) {
          bottomBar.classList.remove('hidden');
        }
      }

      // Hide plantation bottom bar
      function hidePlantationBottomBar() {
        var bottomBar = document.getElementById('plantationBottomBar');
        if (bottomBar) {
          bottomBar.classList.add('hidden');
        }
      }

      // Decide slide direction for info page: portrait -> bottom; landscape -> right
      function setInfoSlideDirection() {
        var infoPage = document.getElementById('infoPage');
        if (!infoPage) return;
        var portrait = window.innerHeight >= window.innerWidth;
        infoPage.classList.remove('from-right', 'from-bottom', 'active');
        if (portrait) {
          infoPage.classList.add('from-bottom');
        } else {
          infoPage.classList.add('from-right');
        }
      }

      // Decide slide direction: portrait -> bottom; landscape -> right
      function setPrecautionSlideDirection() {
        var wp = document.getElementById('weatherPrecautionPage');
        if (!wp) {
          console.error('Weather precaution page not found in setPrecautionSlideDirection');
          return;
        }
        var portrait = window.innerHeight >= window.innerWidth;
        console.log('Setting slide direction - portrait:', portrait);
        wp.classList.remove('from-right', 'from-bottom', 'active');
        if (portrait) {
          wp.classList.add('from-bottom');
          console.log('Added from-bottom class');
        } else {
          wp.classList.add('from-right');
          console.log('Added from-right class');
        }
        console.log('Final classes:', wp.className);
      }

      // Swipe-to-close interactions
      (function enablePrecautionSwipe() {
        var wp = document.getElementById('weatherPrecautionPage');
        if (!wp) return;
        var startX = 0, startY = 0, currentX = 0, currentY = 0, dragging = false;
        var threshold = 100; // px to trigger close (slightly higher to avoid accidental closes)

        function onStart(e) {
          var t = e.touches ? e.touches[0] : e;
          startX = t.clientX;
          startY = t.clientY;
          dragging = wp.classList.contains('active');
        }
        function onMove(e) {
          if (!dragging) return;
          var t = e.touches ? e.touches[0] : e;
          currentX = t.clientX - startX;
          currentY = t.clientY - startY;
          var portrait = window.innerHeight >= window.innerWidth;
          if (portrait) {
            // drag down
            if (currentY > 0) {
              wp.style.transform = 'translateY(' + currentY + 'px)';
            }
          } else {
            // drag right
            if (currentX > 0) {
              wp.style.transform = 'translateX(' + currentX + 'px)';
            }
          }
        }
        function onEnd() {
          if (!dragging) return;
          var portrait = window.innerHeight >= window.innerWidth;
          var distance = portrait ? currentY : currentX;
          if (distance > threshold) {
            hideWeatherPrecautions();
          } else {
            // snap back
            wp.style.transition = 'transform 0.2s ease-out';
            wp.style.transform = 'translate' + (portrait ? 'Y' : 'X') + '(0)';
            setTimeout(function() { wp.style.transition = ''; }, 220);
          }
          dragging = false;
          startX = startY = currentX = currentY = 0;
        }

        wp.addEventListener('touchstart', onStart, { passive: true });
        wp.addEventListener('touchmove', onMove, { passive: true });
        wp.addEventListener('touchend', onEnd);
        // Optional mouse support
        wp.addEventListener('mousedown', onStart);
        window.addEventListener('mousemove', onMove);
        window.addEventListener('mouseup', onEnd);
      })();

      // Swipe-to-close interactions for info page
      (function enableInfoSwipe() {
        var ip = document.getElementById('infoPage');
        if (!ip) return;
        var startX = 0, startY = 0, currentX = 0, currentY = 0, dragging = false;
        var threshold = 100; // px to trigger close (slightly higher to avoid accidental closes)

        function onStart(e) {
          var t = e.touches ? e.touches[0] : e;
          startX = t.clientX;
          startY = t.clientY;
          dragging = ip.classList.contains('active');
        }
        function onMove(e) {
          if (!dragging) return;
          var t = e.touches ? e.touches[0] : e;
          currentX = t.clientX - startX;
          currentY = t.clientY - startY;
          var portrait = window.innerHeight >= window.innerWidth;
          if (portrait) {
            // drag down
            if (currentY > 0) {
              ip.style.transform = 'translateY(' + currentY + 'px)';
            }
          } else {
            // drag right
            if (currentX > 0) {
              ip.style.transform = 'translateX(' + currentX + 'px)';
            }
          }
        }
        function onEnd() {
          if (!dragging) return;
          var portrait = window.innerHeight >= window.innerWidth;
          var distance = portrait ? currentY : currentX;
          if (distance > threshold) {
            hideInfoPage();
          } else {
            // snap back
            ip.style.transition = 'transform 0.2s ease-out';
            ip.style.transform = 'translate' + (portrait ? 'Y' : 'X') + '(0)';
            setTimeout(function() { ip.style.transition = ''; }, 220);
          }
          dragging = false;
          startX = startY = currentX = currentY = 0;
        }

        ip.addEventListener('touchstart', onStart, { passive: true });
        ip.addEventListener('touchmove', onMove, { passive: true });
        ip.addEventListener('touchend', onEnd);
        // Optional mouse support
        ip.addEventListener('mousedown', onStart);
        window.addEventListener('mousemove', onMove);
        window.addEventListener('mouseup', onEnd);
      })();

      // Swipe-to-close interactions for weekly plan page
      (function enableWeeklyPlanSwipe() {
        var wpp = document.getElementById('weeklyPlanPage');
        if (!wpp) return;
        var startX = 0, startY = 0, currentX = 0, currentY = 0, dragging = false;
        var threshold = 100; // px to trigger close (slightly higher to avoid accidental closes)

        function onStart(e) {
          var t = e.touches ? e.touches[0] : e;
          startX = t.clientX;
          startY = t.clientY;
          dragging = wpp.classList.contains('active');
        }
        function onMove(e) {
          if (!dragging) return;
          var t = e.touches ? e.touches[0] : e;
          currentX = t.clientX - startX;
          currentY = t.clientY - startY;
          var portrait = window.innerHeight >= window.innerWidth;
          if (portrait) {
            // drag down
            if (currentY > 0) {
              wpp.style.transform = 'translateY(' + currentY + 'px)';
            }
          } else {
            // drag right
            if (currentX > 0) {
              wpp.style.transform = 'translateX(' + currentX + 'px)';
            }
          }
        }
        function onEnd() {
          if (!dragging) return;
          var portrait = window.innerHeight >= window.innerWidth;
          var distance = portrait ? currentY : currentX;
          if (distance > threshold) {
            hideWeeklyPlanPage();
          } else {
            // snap back
            wpp.style.transition = 'transform 0.2s ease-out';
            wpp.style.transform = 'translate' + (portrait ? 'Y' : 'X') + '(0)';
            setTimeout(function() { wpp.style.transition = ''; }, 220);
          }
          dragging = false;
          startX = startY = currentX = currentY = 0;
        }

        wpp.addEventListener('touchstart', onStart, { passive: true });
        wpp.addEventListener('touchmove', onMove, { passive: true });
        wpp.addEventListener('touchend', onEnd);
        // Optional mouse support
        wpp.addEventListener('mousedown', onStart);
        window.addEventListener('mousemove', onMove);
        window.addEventListener('mouseup', onEnd);
      })();

      // Initialize calendar
      function initCalendar() {
        updateCalendar();

        // Add event listeners for navigation
        document.getElementById('prev-month').addEventListener('click', function() {
          currentDate.setMonth(currentDate.getMonth() - 1);
          updateCalendar();
        });

        document.getElementById('next-month').addEventListener('click', function() {
          currentDate.setMonth(currentDate.getMonth() + 1);
          updateCalendar();
        });

        // Set today as initially selected
        showExpensesForDate(selectedDate);

        // Add expense button functionality
        document.getElementById('add-expense-btn').addEventListener('click', function() {
          document.getElementById('expense-modal').classList.remove('hidden');
        });

        document.getElementById('cancel-expense').addEventListener('click', function() {
          document.getElementById('expense-modal').classList.add('hidden');
          clearExpenseForm();
        });

        document.getElementById('save-expense').addEventListener('click', function() {
          saveExpense();
        });

        // Expense summary button functionality
        document.getElementById('expense-summary-btn').addEventListener('click', function() {
          showExpenseSummary();
        });

        document.getElementById('close-summary').addEventListener('click', function() {
          document.getElementById('expense-summary-modal').classList.add('hidden');
        });

        // Profile button functionality
        document.getElementById('profileBtn').addEventListener('click', function() {
          showProfilePage();
        });
      }

      // Update calendar display
      function updateCalendar() {
        var monthYearElement = document.getElementById('current-month');
        var calendarDaysElement = document.getElementById('calendar-days');

        // Clear previous calendar days
        calendarDaysElement.innerHTML = '';

        // Set month and year text
        var monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        monthYearElement.textContent = monthNames[currentDate.getMonth()] + ' ' + currentDate.getFullYear();

        // Get first day of month and number of days in month
        var firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getDay();
        var daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();

        // Add empty cells for days before the first day of the month
        for (var i = 0; i < firstDay; i++) {
          var emptyDay = document.createElement('div');
          emptyDay.className = 'h-12 w-full';
          calendarDaysElement.appendChild(emptyDay);
        }

        // Add cells for each day of the month
        for (var d = 1; d <= daysInMonth; d++) {
          var dayElement = document.createElement('div');
          dayElement.className = 'h-12 w-full pt-3 text-sm font-medium';

          var dayNumber = document.createElement('span');
          dayNumber.className = 'calendar-day text-white';
          dayNumber.textContent = d;

          // Check if this day has expenses
          var dateKey = currentDate.getFullYear() + '-' + (currentDate.getMonth() + 1) + '-' + d;
          if (expensesData[dateKey] && expensesData[dateKey].length > 0) {
            dayNumber.classList.add('has-expenses');
          }

          // Check if this is the selected date
          if (currentDate.getMonth() === selectedDate.getMonth() &&
              currentDate.getFullYear() === selectedDate.getFullYear() &&
              d === selectedDate.getDate()) {
            dayNumber.classList.add('selected');
          }

          // Add click event to show expenses for this date
          (function(dayValue, dayNumberEl) {
            dayElement.addEventListener('click', function() {
              // Remove selected class from all days
              document.querySelectorAll('.calendar-day').forEach(function(day) {
                day.classList.remove('selected');
              });

              // Add selected class to clicked day
              dayNumberEl.classList.add('selected');

              // Update selected date and show expenses
              selectedDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), dayValue);
              showExpensesForDate(selectedDate);

              // Show add expense button and summary button
              document.getElementById('add-expense-btn').classList.remove('hidden');
              document.getElementById('expense-summary-btn').classList.remove('hidden');
            });
          })(d, dayNumber);

          dayElement.appendChild(dayNumber);
          calendarDaysElement.appendChild(dayElement);
        }
      }

      // Show expenses for selected date
      function showExpensesForDate(date) {
        var expensesContainer = document.getElementById('expenses-container');
        var dateTitle = document.getElementById('selected-date-title');

        // Format date for display
        var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        dateTitle.textContent = date.toLocaleDateString('en-US', options);

        // Clear previous expenses
        expensesContainer.innerHTML = '';

        // Get date key for expenses data
        var dateKey = date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate();

        // Show expenses for this date or a message if no expenses
        if (expensesData[dateKey] && expensesData[dateKey].length > 0) {
          var total = 0;

          expensesData[dateKey].forEach(function(expense) {
            total += parseFloat(expense.amount);

            var expenseElement = document.createElement('div');
            expenseElement.className = 'flex items-center justify-between rounded-lg bg-[#1C2620] p-3 expense-item';

            expenseElement.innerHTML = '\n                <div class="flex items-center gap-3">\n                    <div class="flex size-12 shrink-0 items-center justify-center rounded-lg bg-[#29382F]">\n                        <span class="material-symbols-outlined text-white">' + getExpenseIcon(expense.category) + '</span>\n                    </div>\n                    <div>\n                        <p class="font-medium text-white">' + expense.category + '</p>\n                        <p class="text-sm text-[#9eb7a8]">' + (expense.description || 'No description') + '</p>\n                    </div>\n                </div>\n                <div class="text-right">\n                    <p class="font-medium text-white">₹' + parseFloat(expense.amount).toFixed(2) + '</p>\n                    <p class="text-xs text-[#9eb7a8]">' + new Date(expense.timestamp).toLocaleTimeString() + '</p>\n                </div>\n            ';

            expensesContainer.appendChild(expenseElement);
          });

          // Add total row
          var totalElement = document.createElement('div');
          totalElement.className = 'flex items-center justify-between rounded-lg bg-[#29382F] p-4 mt-4';
          totalElement.innerHTML = '\n            <p class="font-bold text-white">Total</p>\n            <p class="font-bold text-[var(--primary-500)]">₹' + total.toFixed(2) + '</p>\n        ';
          expensesContainer.appendChild(totalElement);
        } else {
          expensesContainer.innerHTML = '\n            <div class="text-center py-6 text-[#9eb7a8]">\n                <span class="material-symbols-outlined text-4xl mb-2">receipt_long</span>\n                <p>No expenses recorded for this day</p>\n                <p class="text-sm mt-2">Tap the + button to add an expense</p>\n            </div>\n        ';
        }
      }

      // Get appropriate icon for expense category
      function getExpenseIcon(category) {
        var icons = {
          'Seeds': 'grass',
          'Fertilizers': 'science',
          'Equipment': 'handyman',
          'Labor': 'groups',
          'Irrigation': 'water_drop',
          'Transport': 'local_shipping',
          'Other': 'receipt'
        };
        return icons[category] || 'receipt';
      }

      // Clear expense form
      function clearExpenseForm() {
        document.getElementById('expense-amount').value = '';
        document.getElementById('expense-category').value = 'Seeds';
        document.getElementById('expense-description').value = '';
      }

      // Save expense
      function saveExpense() {
        var amount = document.getElementById('expense-amount').value;
        var category = document.getElementById('expense-category').value;
        var description = document.getElementById('expense-description').value;

        if (!amount || parseFloat(amount) <= 0) {
          alert('Please enter a valid amount');
          return;
        }

        var dateKey = selectedDate.getFullYear() + '-' + (selectedDate.getMonth() + 1) + '-' + selectedDate.getDate();

        // Initialize expenses array for this date if it doesn't exist
        if (!expensesData[dateKey]) {
          expensesData[dateKey] = [];
        }

        // Add new expense
        expensesData[dateKey].push({
          amount: parseFloat(amount).toFixed(2),
          category: category,
          description: description,
          timestamp: new Date().toISOString()
        });

        // Save to localStorage
        localStorage.setItem('userExpenses', JSON.stringify(expensesData));

        // Award coins for adding expense
        awardCoins(5);

        // Update UI
        updateCalendar();
        showExpensesForDate(selectedDate);

        // Close modal and clear form
        document.getElementById('expense-modal').classList.add('hidden');
        clearExpenseForm();

        // Show notification
        showNotification('Expense added successfully! +5 coins earned!');
      }

      // Award coins to user
      function awardCoins(amount) {
        userCoins += amount;
        document.getElementById('coins-count').textContent = userCoins;
        localStorage.setItem('userCoins', userCoins);
      }

      // Show expense summary with pie chart
      function showExpenseSummary() {
        // Calculate total expenses by category
        var categoryTotals = {};
        var grandTotal = 0;

        for (var dateKey in expensesData) {
          if (Object.prototype.hasOwnProperty.call(expensesData, dateKey)) {
            expensesData[dateKey].forEach(function(expense) {
              var amount = parseFloat(expense.amount);
              if (!categoryTotals[expense.category]) {
                categoryTotals[expense.category] = 0;
              }
              categoryTotals[expense.category] += amount;
              grandTotal += amount;
            });
          }
        }

        // Prepare data for the chart
        var categories = Object.keys(categoryTotals);
        var amounts = Object.values(categoryTotals);

        // Create the chart
        var ctx = document.getElementById('expense-chart').getContext('2d');

        // Destroy previous chart if it exists
        if (window.expenseChartInstance) {
          window.expenseChartInstance.destroy();
        }

        // Define colors for each category
        var categoryColors = {
          'Seeds': '#38e07b',
          'Fertilizers': '#4caf50',
          'Equipment': '#8bc34a',
          'Labor': '#cddc39',
          'Irrigation': '#ffeb3b',
          'Transport': '#ffc107',
          'Other': '#ff9800'
        };

        var backgroundColors = categories.map(function(category) { return categoryColors[category] || '#9e9e9e'; });

        // Create new chart
        window.expenseChartInstance = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: categories,
            datasets: [{
              data: amounts,
              backgroundColor: backgroundColors,
              borderColor: '#1C2620',
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  color: '#9eb7a8',
                  font: {
                    family: '"Public Sans", "Noto Sans", sans-serif'
                  }
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    var value = context.raw;
                    var percentage = Math.round((value / (grandTotal || 1)) * 100);
                    return '₹' + Number(value).toFixed(2) + ' (' + percentage + '%)';
                  }
                }
              }
            }
          }
        });

        // Update summary details
        var summaryDetails = document.getElementById('expense-summary-details');
        summaryDetails.innerHTML = '\n        <div class="text-center">\n            <p class="text-xl font-bold text-[var(--primary-500)]">Total: ₹' + grandTotal.toFixed(2) + '</p>\n            <p class="text-sm text-[#9eb7a8] mt-2">Across ' + Object.keys(expensesData).length + ' days</p>\n        </div>\n    ';

        // Show the modal
        document.getElementById('expense-summary-modal').classList.remove('hidden');
      }

      // Show profile page
      function showProfilePage() {
        // Hide all pages first
        document.getElementById('homeContent').classList.add('hidden');
        document.getElementById('questionPage').classList.add('hidden');
        document.getElementById('schemesPage').classList.add('hidden');
        document.getElementById('calendarPage').classList.add('hidden');
        document.getElementById('settingsPage').classList.add('hidden');
        document.getElementById('profilePage').classList.remove('hidden');

        // Update page title
        document.getElementById('pageTitle').textContent = 'Profile';

        // Hide calendar buttons and home info button
        document.getElementById('add-expense-btn').classList.add('hidden');
        document.getElementById('expense-summary-btn').classList.add('hidden');
        document.getElementById('home-info-btn').classList.add('hidden');
      }

      // Show notification
      function showNotification(message) {
        try {
          var container = document.getElementById('appContainer') || document.body;
          var n = document.createElement('div');
          n.textContent = message || '';
          n.style.position = 'absolute';
          n.style.left = '50%';
          n.style.transform = 'translateX(-50%)';
          n.style.bottom = '76px';
          n.style.maxWidth = '92vw';
          n.style.zIndex = '2000';
          n.style.background = 'rgba(56, 224, 123, 0.95)';
          n.style.color = '#0b1410';
          n.style.padding = '10px 14px';
          n.style.borderRadius = '9999px';
          n.style.fontWeight = '700';
          n.style.boxShadow = '0 6px 18px rgba(0,0,0,0.35)';
          n.style.whiteSpace = 'nowrap';
          n.style.overflow = 'hidden';
          n.style.textOverflow = 'ellipsis';
          container.appendChild(n);
          setTimeout(function(){
            try { n.remove(); } catch(e) { if (n && n.parentNode) n.parentNode.removeChild(n); }
          }, 2200);
        } catch(e) {}
      }

      // Open government scheme platform
      function openScheme(schemeId) {
        var schemeUrls = {
          'pm-kisan': 'https://pmkisan.gov.in/',
          'pm-fasal-bima': 'https://pmfby.gov.in/',
          'paramparagat-krishi': 'https://pgsindia-ncof.gov.in/',
          'rashtriya-krishi': 'https://rkvy.nic.in/',
          'kisan-credit-card': 'https://www.nabard.org/',
          'oilseeds-mission': 'https://www.nmoop.gov.in/',
          'micro-irrigation': 'https://pmksy.gov.in/'
        };

        var url = schemeUrls[schemeId];
        if (url) {
          // Open in new tab
          window.open(url, '_blank');
          showNotification('Redirecting to official government platform...');
        } else {
          showNotification('Scheme information not available');
        }
      }

      // Generate plantation plan
      function generatePlantationPlan() {
        var plantType = document.getElementById('plantType').value;
        var previousCrop = document.getElementById('previousCrop').value;
        var landSize = document.getElementById('landSize').value;

        if (!plantType || !landSize) {
          alert('Please fill in all required fields!');
          return;
        }

        var plan = plantationPlans[plantType];
        if (!plan) {
          showNotification('Weekly plan not available for this crop yet.');
          window.currentPlan = null;
          return;
        }

        // Store plan data for weekly plan page
        window.currentPlan = plan;
        window.currentLandSize = landSize;
        window.currentPreviousCrop = previousCrop;
        window.currentPlantType = plantType;

        // Hide info page and show weekly plan page
        hideInfoPage();
        showWeeklyPlanPage();
        
        // Generate weekly plan content
        generateWeeklyPlanContent(plan, landSize, previousCrop);
        
        showNotification('Your personalized plantation plan is ready!');

        // Render today's plan summary on Home (first 3 tasks of week 1)
        try {
          var homePlanContainer = document.getElementById('homePlanContainer');
          if (!homePlanContainer) {
          var block = document.createElement('div');
          block.className = 'home-plan';
            block.innerHTML = '<div class="flex items-center justify-between mb-2"><p class="text-gray-400 text-sm">Today\'s Plan</p><button id="homePlanProgressBtn" class="text-xs bg-green-700/20 text-green-400 px-2 py-1 rounded" aria-live="polite" aria-label="Today\'s plan progress">0%</button></div><div id="homePlanContainer"></div>';
            var homeContent = document.getElementById('homeContent');
            homeContent.insertBefore(block, homeContent.firstChild);
            homePlanContainer = document.getElementById('homePlanContainer');
          }
          var tasks = (plan.weeklyPlan && plan.weeklyPlan[0] && plan.weeklyPlan[0].tasks) ? plan.weeklyPlan[0].tasks.slice(0,3) : [];
          var html = '';
          tasks.forEach(function(task, i){
            var icon = getTaskIcon(task);
            var desc = getTaskDescription(task, landSize, previousCrop);
            var id = 'home-plan-cb-' + i;
            html += '<div class="home-plan-item">'
              + '<input id="'+id+'" type="checkbox" class="home-plan-checkbox" aria-label="Complete home task '+(i+1)+'">'
              + '<span class="material-symbols-outlined task-icon">'+icon+'</span>'
              + '<div class="task-content">'
              + '<div class="task-title">'+task+'</div>'
              + '<div class="task-desc">'+desc+'</div>'
              + '</div>'
              + '</div>';
          });
          homePlanContainer.innerHTML = html;
          // Hook up green check, glow effect, and one-time coin award
          document.querySelectorAll('.home-plan-checkbox').forEach(function(cb){
            cb.addEventListener('change', function(){
              // Toggle glow on adjacent icon
              try {
                var parent = cb.closest('.home-plan-item');
                var icon = parent && parent.querySelector('.task-icon');
                if (icon) icon.classList.toggle('icon-glow', cb.checked);
              } catch(e) {}

              if (cb.checked && cb.getAttribute('data-awarded') !== 'true') {
                awardCoins(10);
                cb.setAttribute('data-awarded','true');
                cb.disabled = true;
                cb.checked = true;
                cb.title = 'Completed';
                updateHomePlanProgress();
              }
            });
          });
          // Initialize progress once content is rendered
          updateHomePlanProgress();
        } catch(e) {}
      }

      // Generate weekly plan content
      function generateWeeklyPlanContent(plan, landSize, previousCrop) {
        // Update page title and subtitle
        document.getElementById('weeklyPlanTitle').textContent = `${plan.name} Plantation Plan`;
        document.getElementById('weeklyPlanSubtitle').textContent = `${plan.duration} weeks • ${landSize} acres`;

        // Generate weekly plan
        var weeklyPlanHtml = '';
        plan.weeklyPlan.forEach(function(week) {
          weeklyPlanHtml += `
            <div class="plan-week">
              <h4>Week ${week.week}: ${week.title}</h4>
              <p>${week.tasks.join(' • ')}</p>
            </div>
          `;
        });
        document.getElementById('weeklyPlanContent').innerHTML = weeklyPlanHtml;

        // Generate daily plan for current week (Week 1)
        generateDailyPlan(plan, landSize, previousCrop);
      }

      // Generate daily plan
      function generateDailyPlan(plan, landSize, previousCrop) {
        var dailyPlanHtml = '';
        var currentWeek = 1; // Start with week 1
        
        // Get current week's tasks
        var currentWeekPlan = plan.weeklyPlan[currentWeek - 1];
        if (currentWeekPlan) {
          currentWeekPlan.tasks.forEach(function(task, index) {
            var day = index + 1;
            var taskIcon = getTaskIcon(task);
            var taskDesc = getTaskDescription(task, landSize, previousCrop);
            
            dailyPlanHtml += `
              <div class="daily-task">
                <input type="checkbox" class="daily-checkbox" data-week="${currentWeek}" data-day="${day}" aria-label="Complete day ${day}">
                <span class="material-symbols-outlined task-icon">${taskIcon}</span>
                <div class="task-content">
                  <div class="task-title">Day ${day}: ${task}</div>
                  <div class="task-desc">${taskDesc}</div>
                </div>
              </div>
            `;
          });
        }
        
        document.getElementById('dailyPlanContent').innerHTML = dailyPlanHtml;

        // Attach checkbox coin-award handlers
        try {
          var checkboxes = document.querySelectorAll('.daily-checkbox');
          checkboxes.forEach(function(cb){
            cb.addEventListener('change', function(){
              // Toggle glow on adjacent icon
              try {
                var parent = cb.closest('.daily-task');
                var icon = parent && parent.querySelector('.task-icon');
                if (icon) icon.classList.toggle('icon-glow', cb.checked);
              } catch(e) {}

              // Award coins only when checked first time
              if (cb.checked && cb.getAttribute('data-awarded') !== 'true') {
                awardCoins(10);
                cb.setAttribute('data-awarded', 'true');
                cb.disabled = true; // prevent further toggles after first completion
                cb.checked = true;  // keep it visibly checked
                cb.title = 'Completed';
              }
            });
          });
        } catch(e) {}
      }

      // Update the Home Today's Plan progress button based on completed checkboxes
      function updateHomePlanProgress() {
        try {
          var all = document.querySelectorAll('#homePlanContainer .home-plan-checkbox');
          if (!all || all.length === 0) {
            var btn0 = document.getElementById('homePlanProgressBtn');
            if (btn0) btn0.textContent = '0%';
            return;
          }
          var completed = Array.from(all).filter(function(cb){ return cb.disabled || cb.getAttribute('data-awarded') === 'true' || cb.checked; }).length;
          var pct = Math.round((completed / all.length) * 100);
          var btn = document.getElementById('homePlanProgressBtn');
          if (btn) {
            btn.textContent = pct + '%';
            btn.setAttribute('aria-label', "Today's plan progress " + pct + '%');
          }
        } catch(e) {}
      }

      // Get task icon based on task type
      function getTaskIcon(task) {
        if (task.toLowerCase().includes('soil') || task.toLowerCase().includes('land')) return 'agriculture';
        if (task.toLowerCase().includes('seed') || task.toLowerCase().includes('plant')) return 'eco';
        if (task.toLowerCase().includes('water') || task.toLowerCase().includes('irrigation')) return 'water_drop';
        if (task.toLowerCase().includes('fertilizer') || task.toLowerCase().includes('nutrient')) return 'science';
        if (task.toLowerCase().includes('pest') || task.toLowerCase().includes('disease')) return 'bug_report';
        if (task.toLowerCase().includes('harvest')) return 'grass';
        if (task.toLowerCase().includes('monitor') || task.toLowerCase().includes('check')) return 'visibility';
        return 'task_alt';
      }

      // Get task description based on land size and previous crop
      function getTaskDescription(task, landSize, previousCrop) {
        var desc = '';
        
        if (task.toLowerCase().includes('fertilizer')) {
          var amount = Math.round(landSize * 50); // 50kg per acre
          desc = `Apply ${amount}kg fertilizer for ${landSize} acres`;
        } else if (task.toLowerCase().includes('seed')) {
          var seedAmount = Math.round(landSize * 2); // 2kg per acre
          desc = `Use ${seedAmount}kg seeds for ${landSize} acres`;
        } else if (task.toLowerCase().includes('water')) {
          desc = `Water ${landSize} acres thoroughly`;
        } else if (task.toLowerCase().includes('spacing')) {
          desc = `Maintain proper spacing for ${landSize} acres`;
        } else if (previousCrop !== 'none') {
          desc = `Consider crop rotation from ${previousCrop}`;
        } else {
          desc = `Apply to ${landSize} acres of land`;
        }
        
        return desc;
      }

      // Switch to dashboard
      document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('loginBtn').addEventListener('click', function() {
          var email = document.getElementById('loginEmail').value;
          var password = document.getElementById('loginPassword').value;

          var emailOk = /.+@.+\..+/.test(email) || email.length >= 3; // simple email or username check
          if (!emailOk || !password) {
            alert('Please enter a valid email/username and password');
            return;
          }

          var btn = document.getElementById('loginBtn');
          if (btn) {
            btn.disabled = true;
            btn.innerHTML = '<span class="material-symbols-outlined mr-2 animate-spin" style="font-variation-settings: \"OPSZ\" 24">progress_activity</span> Loading...';
          }

          setTimeout(function(){
            var loginEl = document.getElementById('loginPage');
            var intro1 = document.getElementById('intro1');
            if (loginEl) loginEl.classList.add('hidden');
            if (intro1) intro1.classList.remove('hidden');
            if (btn) { btn.disabled = false; btn.textContent = 'Login'; }
          }, 600);
        });
      });

      // Show/Hide password toggle & Intro navigation
      document.addEventListener('DOMContentLoaded', function() {
        // Landing buttons routing
        var enterFarmer = document.getElementById('enterFarmer');
        if (enterFarmer) enterFarmer.addEventListener('click', function(){
          var lang = (document.getElementById('landingLang')||{}).value || '';
          var email = (document.getElementById('landingEmail')||{}).value || '';
          var phone = (document.getElementById('landingPhone')||{}).value || '';
          // Require at least language + (email or phone)
          if (!lang || (!email && !phone)) {
            alert('Please select a language and enter email or phone');
            return;
          }
          try { localStorage.setItem('appLang', lang); } catch(e) {}
          // Store user info for profile
          try { 
            localStorage.setItem('userEmail', email); 
            localStorage.setItem('userPhone', phone);
            // Update profile display
            var profileName = document.querySelector('.profile-name');
            var profileEmail = document.querySelector('.profile-email');
            if (profileName && email) {
              var nameFromEmail = email.split('@')[0].replace(/[._]/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
              profileName.textContent = nameFromEmail;
            }
            if (profileEmail && email) {
              profileEmail.textContent = email;
            }
          } catch(e) {}
          // Apply language immediately
          try { currentLang = (lang === 'ml') ? 'ml' : 'en'; updateLanguageDisplay(); updateLanguage(); } catch(e) {}
          var landing = document.getElementById('landingPage');
          var login = document.getElementById('loginPage');
          if (landing) landing.classList.add('hidden');
          if (login) login.classList.remove('hidden');
        });
        // Intro flow handlers
        function goToDashboard(){
          var i1 = document.getElementById('intro1');
          var i2 = document.getElementById('intro2');
          var i3 = document.getElementById('intro3');
          var dash = document.getElementById('dashboardPage');
          if (i1) i1.classList.add('hidden');
          if (i2) i2.classList.add('hidden');
          if (i3) i3.classList.add('hidden');
          if (dash) dash.classList.remove('hidden');
          try { initApp(); } catch(e) {}
        }
        function showFarmerInfo(){
          var i1 = document.getElementById('intro1');
          var i2 = document.getElementById('intro2');
          var i3 = document.getElementById('intro3');
          var fi = document.getElementById('farmerInfoPage');
          // Ensure weatherPrecaution overlay is hidden
          try { document.getElementById('weatherPrecautionPage').classList.remove('active'); } catch(e) {}
          if (i1) i1.classList.add('hidden');
          if (i2) i2.classList.add('hidden');
          if (i3) i3.classList.add('hidden');
          if (fi) {
            setInfoSlideDirection();
            fi.classList.remove('hidden');
            fi.classList.add('active');
          }
        }
        // Guard: ensure clicks on Next/Skip always work
        document.body.addEventListener('click', function(e){
          var t = e.target;
          if (!t) return;
          var id = t.id || (t.closest && t.closest('button') && t.closest('button').id);
          switch(id){
            case 'intro1Next': {
              var i1 = document.getElementById('intro1');
              var i2 = document.getElementById('intro2');
              if (i1) i1.classList.add('hidden');
              if (i2) i2.classList.remove('hidden');
              break;
            }
            case 'intro1Skip':
            case 'intro2Skip':
            case 'intro3Skip':
            case 'intro3Next': { showFarmerInfo(); break; }
            case 'intro2Next': {
              var i2 = document.getElementById('intro2');
              var i3 = document.getElementById('intro3');
              if (i2) i2.classList.add('hidden');
              if (i3) i3.classList.remove('hidden');
              break;
            }
          }
        }, true);
        var intro1Next = document.getElementById('intro1Next');
        var intro1Skip = document.getElementById('intro1Skip');
        if (intro1Next) intro1Next.addEventListener('click', function(){
          var i1 = document.getElementById('intro1');
          var i2 = document.getElementById('intro2');
          if (i1) i1.classList.add('hidden');
          if (i2) i2.classList.remove('hidden');
        });
        if (intro1Skip) intro1Skip.addEventListener('click', goToDashboard);
        var intro2Next = document.getElementById('intro2Next');
        var intro2Skip = document.getElementById('intro2Skip');
        if (intro2Next) intro2Next.addEventListener('click', function(){
          var i2 = document.getElementById('intro2');
          var i3 = document.getElementById('intro3');
          if (i2) i2.classList.add('hidden');
          if (i3) i3.classList.remove('hidden');
        });
        if (intro2Skip) intro2Skip.addEventListener('click', goToDashboard);
        var intro3Next = document.getElementById('intro3Next');
        var intro3Skip = document.getElementById('intro3Skip');
        if (intro3Next) intro3Next.addEventListener('click', showFarmerInfo);
        if (intro3Skip) intro3Skip.addEventListener('click', showFarmerInfo);

        // Back from Farmer Info
        var backFromFarmerInfo = document.getElementById('backFromFarmerInfo');
        if (backFromFarmerInfo) backFromFarmerInfo.addEventListener('click', function(){
          var fi = document.getElementById('farmerInfoPage');
          if (fi) { fi.classList.remove('active'); fi.classList.add('hidden'); }
          var i3 = document.getElementById('intro3');
          if (i3) i3.classList.remove('hidden');
        });

        // Save Farmer Info and proceed
        var farmerInfoNext = document.getElementById('farmerInfoNext');
        if (farmerInfoNext) farmerInfoNext.addEventListener('click', function(){
          var data = {
            name: (document.getElementById('fi_name')||{}).value || '',
            age: (document.getElementById('fi_age')||{}).value || '',
            gender: (document.getElementById('fi_gender')||{}).value || '',
            contact: (document.getElementById('fi_contact')||{}).value || '',
            address: (document.getElementById('fi_address')||{}).value || '',
            land_size: (document.getElementById('fi_land_size')||{}).value || '',
            land_type: (document.getElementById('fi_land_type')||{}).value || '',
            soil_type: (document.getElementById('fi_soil_type')||{}).value || '',
            water_source: (document.getElementById('fi_water_source')||{}).value || ''
          };
          try { localStorage.setItem('farmerInfo', JSON.stringify(data)); } catch(e) {}
          try { var nameEl = document.querySelector('.profile-name'); if (nameEl && data.name) nameEl.textContent = data.name; } catch(e) {}
          try {
            document.getElementById('fd_name').textContent = data.name || '—';
            document.getElementById('fd_contact').textContent = data.contact || '—';
            document.getElementById('fd_address').textContent = data.address || '—';
            document.getElementById('fd_land_size').textContent = data.land_size || '—';
            document.getElementById('fd_land_type').textContent = data.land_type || '—';
            document.getElementById('fd_soil_type').textContent = data.soil_type || '—';
            document.getElementById('fd_water_source').textContent = data.water_source || '—';
          } catch(e) {}
          var fi = document.getElementById('farmerInfoPage');
          if (fi) { fi.classList.remove('active'); fi.classList.add('hidden'); }
          var dash = document.getElementById('dashboardPage');
          if (dash) dash.classList.remove('hidden');
          try { initApp(); } catch(e) {}
          var farm = document.getElementById('farmDetailsPage');
          if (farm) { setPastTrackSlideDirection(); farm.classList.remove('hidden'); farm.classList.add('active'); }
          showNotification('Farmer info saved successfully!');
        });

        var backFromFarmDetails = document.getElementById('backFromFarmDetails');
        if (backFromFarmDetails) backFromFarmDetails.addEventListener('click', function(){
          var farm = document.getElementById('farmDetailsPage');
          if (farm) { farm.classList.remove('active'); farm.classList.add('hidden'); }
        });

        // Settings overlay wiring: Privacy Policy and Terms of Service
        try {
          var items = Array.prototype.slice.call(document.querySelectorAll('.settings-item'));
          items.forEach(function(it){
            var txt = it.querySelector('.settings-text');
            if (!txt) return;
            var label = txt.textContent.trim();
            if (label === 'Privacy Policy') {
              it.addEventListener('click', function(){
                var p = document.getElementById('privacyPage');
                if (p) { setInfoSlideDirection(); p.classList.remove('hidden'); p.classList.add('active'); }
              });
            }
            if (label === 'Terms of Service') {
              it.addEventListener('click', function(){
                var t = document.getElementById('termsPage');
                if (t) { setInfoSlideDirection(); t.classList.remove('hidden'); t.classList.add('active'); }
              });
            }
          });
        } catch(e) {}
        var backFromPrivacy = document.getElementById('backFromPrivacy');
        if (backFromPrivacy) backFromPrivacy.addEventListener('click', function(){
          var p = document.getElementById('privacyPage');
          if (p) { p.classList.remove('active'); p.classList.add('hidden'); p.style.transform=''; }
        });
        var acceptPrivacy = document.getElementById('acceptPrivacy');
        if (acceptPrivacy) acceptPrivacy.addEventListener('click', function(){
          try { localStorage.setItem('acceptedPrivacy', 'true'); } catch(e) {}
          var p = document.getElementById('privacyPage');
          if (p) { p.classList.remove('active'); p.classList.add('hidden'); p.style.transform=''; }
        });
        var backFromTerms = document.getElementById('backFromTerms');
        if (backFromTerms) backFromTerms.addEventListener('click', function(){
          var t = document.getElementById('termsPage');
          if (t) { t.classList.remove('active'); t.classList.add('hidden'); t.style.transform=''; }
        });
        var acceptTerms = document.getElementById('acceptTerms');
        if (acceptTerms) acceptTerms.addEventListener('click', function(){
          try { localStorage.setItem('acceptedTerms', 'true'); } catch(e) {}
          var t = document.getElementById('termsPage');
          if (t) { t.classList.remove('active'); t.classList.add('hidden'); t.style.transform=''; }
        });
        // Theme toggle (clickable multiple times)
        try {
          var themeBtn = document.getElementById('themeToggle');
          var themeLabel = document.getElementById('themeLabel');
          var app = document.getElementById('appContainer');
          function applyTheme(mode){
            var isLight = (mode === 'light');
            if (app) {
              app.classList.toggle('theme-light', isLight);
            }
            if (themeLabel) themeLabel.textContent = isLight ? 'Light' : 'Dark';
            try { localStorage.setItem('appTheme', mode); } catch(e) {}
          }
          var savedTheme = null; try { savedTheme = localStorage.getItem('appTheme'); } catch(e) {}
          applyTheme(savedTheme === 'light' ? 'light' : 'dark');
          if (themeBtn) {
            // Remove any existing listeners to prevent multiple bindings
            themeBtn.replaceWith(themeBtn.cloneNode(true));
            themeBtn = document.getElementById('themeToggle');
            themeBtn.addEventListener('click', function(e){
              e.preventDefault();
              e.stopPropagation();
              var current = themeLabel ? themeLabel.textContent : 'Dark';
              var next = (current === 'Dark') ? 'light' : 'dark';
              applyTheme(next);
            });
          }
        } catch(e) {}
        
        var toggleBtn = document.getElementById('togglePassword');
        var toggleIcon = document.getElementById('togglePasswordIcon');
        var passwordInput = document.getElementById('loginPassword');
        if (toggleBtn && passwordInput && toggleIcon) {
          toggleBtn.addEventListener('click', function() {
            var isHidden = passwordInput.type === 'password';
            passwordInput.type = isHidden ? 'text' : 'password';
            toggleIcon.textContent = isHidden ? 'visibility' : 'visibility_off';
            toggleBtn.setAttribute('aria-label', isHidden ? 'Hide password' : 'Show password');
          });
        }
        // Forgot password simple info
        var forgotBtn = document.getElementById('forgotPasswordBtn');
        if (forgotBtn) {
          forgotBtn.addEventListener('click', function(){
            alert('Please contact support or check your email for reset instructions.');
          });
        }
        // Remember me persistence (email only for demo)
        try {
          var remember = document.getElementById('loginRemember');
          var emailInput = document.getElementById('loginEmail');
          if (remember && emailInput) {
            var savedEmail = localStorage.getItem('rememberedEmail');
            if (savedEmail) {
              emailInput.value = savedEmail;
              remember.checked = true;
            }
            emailInput.addEventListener('change', function(){
              if (remember.checked) localStorage.setItem('rememberedEmail', emailInput.value);
            });
            remember.addEventListener('change', function(){
              if (remember.checked) {
                localStorage.setItem('rememberedEmail', emailInput.value);
              } else {
                localStorage.removeItem('rememberedEmail');
              }
            });
          }
        } catch(e) {}
      });

      // Nav highlight + page switch
      var navLinks = document.querySelectorAll('.nav-link');

      navLinks.forEach(function(link) {
        link.addEventListener('click', function() {
          navLinks.forEach(function(l) { l.classList.remove('nav-active'); });
          link.classList.add('nav-active');
          var page = link.getAttribute('data-page');
          console.log('Navigating to page:', page);

          // Hide all pages first
          document.getElementById('homeContent').classList.add('hidden');
          document.getElementById('questionPage').classList.add('hidden');
          document.getElementById('schemesPage').classList.add('hidden');
          document.getElementById('calendarPage').classList.add('hidden');
          document.getElementById('settingsPage').classList.add('hidden');
          document.getElementById('profilePage').classList.add('hidden');

          // Show the selected page
          if (page === 'Home') {
            document.getElementById('homeContent').classList.remove('hidden');
            document.getElementById('add-expense-btn').classList.add('hidden');
            document.getElementById('expense-summary-btn').classList.add('hidden');
            document.getElementById('home-info-btn').classList.remove('hidden');
            console.log('Home page loaded, info button should be visible');
            
            // Update page title
            document.getElementById('pageTitle').textContent = 'Home';
            console.log('Page title set to: Home');
          } else if (page === 'Question') {
            document.getElementById('questionPage').classList.remove('hidden');
            document.getElementById('add-expense-btn').classList.add('hidden');
            document.getElementById('expense-summary-btn').classList.add('hidden');
            document.getElementById('home-info-btn').classList.add('hidden');
            
            // Update page title
            document.getElementById('pageTitle').textContent = 'Question';
            console.log('Page title set to: Question');
          } else if (page === 'Schemes') {
            document.getElementById('schemesPage').classList.remove('hidden');
            document.getElementById('add-expense-btn').classList.add('hidden');
            document.getElementById('expense-summary-btn').classList.add('hidden');
            document.getElementById('home-info-btn').classList.add('hidden');
            
            // Update page title
            document.getElementById('pageTitle').textContent = 'Schemes';
            console.log('Page title set to: Schemes');
          } else if (page === 'Calendar') {
            document.getElementById('calendarPage').classList.remove('hidden');
            document.getElementById('add-expense-btn').classList.remove('hidden');
            document.getElementById('expense-summary-btn').classList.remove('hidden');
            document.getElementById('home-info-btn').classList.add('hidden');
            
            // Update page title
            document.getElementById('pageTitle').textContent = 'Calendar';
          } else if (page === 'Settings') {
            document.getElementById('settingsPage').classList.remove('hidden');
            document.getElementById('add-expense-btn').classList.add('hidden');
            document.getElementById('expense-summary-btn').classList.add('hidden');
            document.getElementById('home-info-btn').classList.add('hidden');
            
            // Update page title
            document.getElementById('pageTitle').textContent = 'Settings';
          }
        });
      });

      // Language switching functionality
      let currentLang = 'en'; // 'en' for English, 'ml' for Malayalam

      // Malayalam translations
      const translations = {
        en: {
          // Navigation
          'Home': 'Home',
          'Question': 'Question',
          'Schemes': 'Schemes',
          'Calendar': 'Calendar',
          'Settings': 'Settings',

          // Settings
          'App Preferences': 'App Preferences',
          'Language': 'Language',
          'English': 'English',
          'Theme': 'Theme',
          'Dark': 'Dark',
          'Account': 'Account',
          'Profile': 'Profile',
          'Payment Methods': 'Payment Methods',
          'Address': 'Address',
          'Notifications': 'Notifications',
          'Push Notifications': 'Push Notifications',
          'Email Notifications': 'Email Notifications',
          'Privacy': 'Privacy',
          'Data Sharing': 'Data Sharing',
          'Terms of Service': 'Terms of Service',
          'Privacy Policy': 'Privacy Policy',

          // Calendar
          'Daily Expenses': 'Daily Expenses',
          'Total Expenses Summary': 'Total Expenses Summary',

          // Weather
          'Weather Precautions': 'Weather Precautions',
          'Sunny Weather': 'Sunny Weather',
          'Partly Cloudy Weather': 'Partly Cloudy Weather',
          'Rainy Weather': 'Rainy Weather',
          // Misc UI
          'Logout': 'Logout',
          'Edit Profile': 'Edit Profile',
          'Farm Details': 'Farm Details',
          'Crop Management': 'Crop Management',
          'Past Track': 'Past Track',
          'Help & Support': 'Help & Support',
          'Today': 'Today',
          'Tomorrow': 'Tomorrow',
          'Day After Tomorrow': 'Day After Tomorrow',
          // Weather precaution details
          'Irrigation during early morning or late evening': 'Irrigation during early morning or late evening',
          'Harvesting of matured crops': 'Harvesting of matured crops',
          'Weeding and soil preparation': 'Weeding and soil preparation',
          'Application of organic fertilizers': 'Application of organic fertilizers',
          'Avoid working during peak sun hours (12 PM - 3 PM)': 'Avoid working during peak sun hours (12 PM - 3 PM)',
          "Don't apply chemical pesticides in high temperatures": "Don't apply chemical pesticides in high temperatures",
          'Avoid heavy irrigation during daytime': 'Avoid heavy irrigation during daytime',
          'Postpone transplanting of seedlings': 'Postpone transplanting of seedlings',
          'Use shade nets for sensitive crops': 'Use shade nets for sensitive crops',
          'Ensure proper hydration for farm workers': 'Ensure proper hydration for farm workers',
          'Mulching can help retain soil moisture': 'Mulching can help retain soil moisture',
          'Monitor plants for signs of heat stress': 'Monitor plants for signs of heat stress',
          'Ideal time for planting and transplanting': 'Ideal time for planting and transplanting',
          'Application of fertilizers and nutrients': 'Application of fertilizers and nutrients',
          'Pruning and training of plants': 'Pruning and training of plants',
          'Light irrigation as needed': 'Light irrigation as needed',
          'Avoid heavy pruning that might stress plants': 'Avoid heavy pruning that might stress plants',
          "Don't apply chemicals if rain is forecasted": "Don't apply chemicals if rain is forecasted",
          'Avoid working with wet soil to prevent compaction': 'Avoid working with wet soil to prevent compaction',
          'Postpone harvesting of grains to avoid moisture': 'Postpone harvesting of grains to avoid moisture',
          'Monitor weather for sudden changes': 'Monitor weather for sudden changes',
          'Good day for most farm activities': 'Good day for most farm activities',
          'Check soil moisture before irrigation': 'Check soil moisture before irrigation',
          'Ideal conditions for photosynthesis': 'Ideal conditions for photosynthesis',
          'Drainage management and field preparation': 'Drainage management and field preparation',
          'Cover crops and storage protection': 'Cover crops and storage protection',
          'Planning and maintenance activities': 'Planning and maintenance activities',
          'Indoor tasks and equipment repair': 'Indoor tasks and equipment repair',
          'Avoid field work during heavy rainfall': 'Avoid field work during heavy rainfall',
          "Don't apply fertilizers or pesticides before rain": "Don't apply fertilizers or pesticides before rain",
          'Avoid working with electrical equipment in wet conditions': 'Avoid working with electrical equipment in wet conditions',
          'Postpone harvesting to avoid spoilage': 'Postpone harvesting to avoid spoilage',
          'Ensure proper drainage in fields': 'Ensure proper drainage in fields',
          'Protect harvested crops from moisture': 'Protect harvested crops from moisture',
          'Check for pest infestations that thrive in wet conditions': 'Check for pest infestations that thrive in wet conditions',
          'Plan for next cropping season': 'Plan for next cropping season',
          'Rainfall expected in the northern region': 'Rainfall expected in the northern region',
          'Irrigation Needed Tomorrow 💧': 'Irrigation Needed Tomorrow 💧'
        },
        ml: {
          // Navigation
          'Home': 'ഹോം',
          'Question': 'ചോദ്യം',
          'Schemes': 'പദ്ധതികൾ',
          'Calendar': 'കലണ്ടർ',
          'Settings': 'ക്രമീകരണങ്ങൾ',

          // Settings
          'App Preferences': 'ആപ്പ് മുൻഗണനകൾ',
          'Language': 'ഭാഷ',
          'English': 'ഇംഗ്ലീഷ്',
          'Theme': 'തീം',
          'Dark': 'ഇരുണ്ട',
          'Account': 'അക്കൗണ്ട്',
          'Profile': 'പ്രൊഫൈൽ',
          'Payment Methods': 'പേയ്മെന്റ് രീതികൾ',
          'Address': 'വിലാസം',
          'Notifications': 'അറിയിപ്പുകൾ',
          'Push Notifications': 'പുഷ് അറിയിപ്പുകൾ',
          'Email Notifications': 'ഇമെയിൽ അറിയിപ്പുകൾ',
          'Privacy': 'സ്വകാര്യത',
          'Data Sharing': 'ഡാറ്റ പങ്കിടൽ',
          'Terms of Service': 'സേവന നിബന്ധനകൾ',
          'Privacy Policy': 'സ്വകാര്യതാ നയം',

          // Calendar
          'Daily Expenses': 'ദൈനംദിന ചെലവുകൾ',
          'Total Expenses Summary': 'മൊത്തം ചെലവുകളുടെ സംഗ്രഹം',

          // Weather
          'Weather Precautions': 'കാലാവസ്ഥാ മുൻകരുതലുകൾ',
          'Sunny Weather': 'സൂര്യപ്രകാശ കാലാവസ്ഥ',
          'Partly Cloudy Weather': 'ഭാഗികമായി മേഘാവൃത കാലാവസ്ഥ',
          'Rainy Weather': 'മഴയുള്ള കാലാവസ്ഥ',
          // Misc UI
          'Logout': 'ലോഗ് ഔട്ട്',
          'Edit Profile': 'പ്രൊഫൈൽ തിരുത്തുക',
          'Farm Details': 'ഫാം വിശദാംശങ്ങൾ',
          'Crop Management': 'വിള പരിപാലനം',
          'Past Track': 'പാസ്റ്റ് ട്രാക്ക്',
          'Help & Support': 'സഹായവും പിന്തുണയും',
          'Today': 'ഇന്ന്',
          'Tomorrow': 'നാളെ',
          'Day After Tomorrow': 'മറ്റേന്ന്',
          // Weather precaution details
          'Irrigation during early morning or late evening': 'കാലത്ത് നേരത്തെയോ വൈകുന്നേരത്തെയോ ജലസേചനം',
          'Harvesting of matured crops': 'കായ്മെത്തിയ വിളകൾ വിളവെടുക്കുക',
          'Weeding and soil preparation': 'പുല്ലേറ്റവും മണ്ണ് തയ്യാറാക്കലും',
          'Application of organic fertilizers': 'സോവിന്യ വളങ്ങൾ പ്രയോഗിക്കുക',
          'Avoid working during peak sun hours (12 PM - 3 PM)': 'ഉച്ചയുടെ കനത്ത ചൂടിൽ (12 PM - 3 PM) ജോലി ഒഴിവാക്കുക',
          "Don't apply chemical pesticides in high temperatures": 'ഉയർന്ന ചൂടിൽ രാസ കീടനാശിനികൾ ഉപയോഗിക്കരുത്',
          'Avoid heavy irrigation during daytime': 'പകൽ സമയത്ത് അത്യധികം ജലസേചനം ഒഴിവാക്കുക',
          'Postpone transplanting of seedlings': 'തൈകൾ മാറ്റിടുന്നത് വൈകിക്കുക',
          'Use shade nets for sensitive crops': 'സെൻസിറ്റീവ് വിളകൾക്ക് ഷേഡ് നെറ്റുകൾ ഉപയോഗിക്കുക',
          'Ensure proper hydration for farm workers': 'തൊഴിലാളികളുടെ ശരിയായ ജലാംശം ഉറപ്പാക്കുക',
          'Mulching can help retain soil moisture': 'മൾച്ചിംഗ് മണ്ണിലെ ഈർപ്പം നിലനിർത്താൻ സഹായിക്കും',
          'Monitor plants for signs of heat stress': 'ചൂട് സമ്മർദ്ദത്തിന്റെ ലക്ഷണങ്ങൾക്കായി സസ്യങ്ങളെ നിരീക്ഷിക്കുക',
          'Ideal time for planting and transplanting': 'നടാനും മാറ്റിടാനും അനുയോജ്യമായ സമയം',
          'Application of fertilizers and nutrients': 'വളങ്ങളും പോഷകങ്ങളും പ്രയോഗിക്കുക',
          'Pruning and training of plants': 'സസ്യങ്ങളുടെ കൊയ്യലും പരിശീലനവും',
          'Light irrigation as needed': 'ആവശ്യത്തിനനുസരിച്ച് ലഘു ജലസേചനം',
          'Avoid heavy pruning that might stress plants': 'സസ്യങ്ങളെ സമ്മർദ്ദപ്പെടുത്തുന്ന കടുത്ത കൊയ്യൽ ഒഴിവാക്കുക',
          "Don't apply chemicals if rain is forecasted": 'മഴ പ്രവചിക്കുന്നുണ്ടെങ്കിൽ രാസവസ്തുക്കൾ പ്രയോഗിക്കരുത്',
          'Avoid working with wet soil to prevent compaction': 'മണ്ണ് കട്ടികൂടാതിരിക്കാനായി ഈർപ്പമുള്ള മണ്ണിൽ ജോലി ഒഴിവാക്കുക',
          'Postpone harvesting of grains to avoid moisture': 'ആർദ്രത ഒഴിവാക്കാൻ ധാന്യ വിളവെടുപ്പ് മാറ്റിവെക്കുക',
          'Monitor weather for sudden changes': 'കാലാവസ്ഥയിലെ പെട്ടെന്നുള്ള മാറ്റങ്ങൾക്കായി നിരീക്ഷിക്കുക',
          'Good day for most farm activities': 'മിക്ക കാർഷിക പ്രവർത്തനങ്ങൾക്കും നല്ല ദിവസം',
          'Check soil moisture before irrigation': 'ജലസേചനത്തിന് മുമ്പ് മണ്ണിലെ ഈർപ്പം പരിശോധിക്കുക',
          'Ideal conditions for photosynthesis': 'ഫോട്ടോസിന്തസിസിന് അനുയോജ്യമായ സാഹചര്യങ്ങൾ',
          'Drainage management and field preparation': 'ഡ്രെയിനേജ് മാനേജ്മെന്റും വയൽ തയ്യാറാക്കലും',
          'Cover crops and storage protection': 'കവർ ക്രോപ്പുകളും സംഭരണ സംരക്ഷണവും',
          'Planning and maintenance activities': 'ആസൂത്രണവും പരിപാലന പ്രവർത്തനങ്ങളും',
          'Indoor tasks and equipment repair': 'ഇൻഡോർ ജോലികളും ഉപകരണങ്ങളുടെ അറ്റകുറ്റപ്പണിയും',
          'Avoid field work during heavy rainfall': 'കനത്ത മഴക്കാലത്ത് വയലിലെ ജോലികൾ ഒഴിവാക്കുക',
          "Don't apply fertilizers or pesticides before rain": 'മഴയ്ക്ക് മുമ്പ് വളങ്ങളോ കീടനാശിനികളോ പ്രയോഗിക്കരുത്',
          'Avoid working with electrical equipment in wet conditions': 'ഈർപ്പമുള്ള സാഹചര്യങ്ങളിൽ ഇലക്ട്രിക്കൽ ഉപകരണങ്ങളുമായി ജോലി ഒഴിവാക്കുക',
          'Postpone harvesting to avoid spoilage': 'വിലാപാകം ഒഴിവാക്കാൻ വിളവെടുപ്പ് മാറ്റിവെക്കുക',
          'Ensure proper drainage in fields': 'വയലുകളിൽ ശരിയായ ഡ്രെയിനേജ് ഉറപ്പാക്കുക',
          'Protect harvested crops from moisture': 'വിളവെടുത്ത വിളകൾ ഈർപ്പത്തിൽ നിന്ന് സംരക്ഷിക്കുക',
          'Check for pest infestations that thrive in wet conditions': 'ഈർപ്പമുള്ള സാഹചര്യത്തിൽ വർദ്ധിക്കുന്ന കീടങ്ങളെ പരിശോധിക്കുക',
          'Plan for next cropping season': 'അടുത്ത കൃഷി സീസണിനായി പദ്ധതി തയ്യാറാക്കുക',
          'Rainfall expected in the northern region': 'വടക്കൻ മേഖലയിൽ മഴ പ്രതീക്ഷിക്കുന്നു',
          'Irrigation Needed Tomorrow 💧': 'നാളെയായി ജലസേചനം ആവശ്യമാണ് 💧'
        }
      };

      function toggleLanguage() {
        currentLang = (currentLang === 'en') ? 'ml' : 'en';
        try { localStorage.setItem('appLang', currentLang); } catch(e) {}
        updateLanguage();
        updateLanguageDisplay();
      }

      function updateLanguageDisplay() {
        var currentLanguageSpan = document.getElementById('currentLanguage');
        if (currentLanguageSpan) {
          currentLanguageSpan.textContent = currentLang === 'en' ? 'English' : 'മലയാളം';
        }
      }

      function updateLanguage() {
        // Set document language attribute
        try { document.documentElement.setAttribute('lang', currentLang === 'en' ? 'en' : 'ml'); } catch(e) {}

        // Update by common selectors
        var elementsToUpdate = [
          { selector: '#pageTitle', key: 'Home' },
          { selector: '.nav-link[data-page="Home"] p', key: 'Home' },
          { selector: '.nav-link[data-page="Question"] p', key: 'Question' },
          { selector: '.nav-link[data-page="Schemes"] p', key: 'Schemes' },
          { selector: '.nav-link[data-page="Calendar"] p', key: 'Calendar' },
          { selector: '.nav-link[data-page="Settings"] p', key: 'Settings' }
        ];

        elementsToUpdate.forEach(function(item) {
          var els = document.querySelectorAll(item.selector);
          els.forEach(function(el) {
            if (translations[currentLang][item.key]) {
              el.textContent = translations[currentLang][item.key];
            }
          });
        });

        // Settings specific labels if present
        var settingsMap = [
          'App Preferences','Language','Theme','Account','Profile','Payment Methods','Address',
          'Notifications','Push Notifications','Email Notifications','Privacy','Data Sharing',
          'Terms of Service','Privacy Policy','Dark'
        ];
        settingsMap.forEach(function(key) {
          var nodes = Array.prototype.slice.call(document.querySelectorAll('.settings-text, h3'));
          nodes.forEach(function(node){
            if (node.textContent.trim() === key && translations[currentLang][key]) {
              node.textContent = translations[currentLang][key];
            }
          });
        });

        // Weather precaution title
        var precautionTitle = document.querySelector('.precaution-title');
        if (precautionTitle && translations[currentLang]['Weather Precautions']) {
          precautionTitle.textContent = translations[currentLang]['Weather Precautions'];
        }

        // Calendar expenses heading
        var expensesTitle = document.getElementById('selected-date-title');
        if (expensesTitle && translations[currentLang]['Daily Expenses']) {
          expensesTitle.textContent = translations[currentLang]['Daily Expenses'];
        }

        // Profile menu items
        var profileItems = ['Edit Profile','Farm Details','Crop Management','Past Track','Help & Support'];
        profileItems.forEach(function(key){
          var nodes = document.querySelectorAll('.profile-menu-text');
          nodes.forEach(function(n){
            if (n.textContent.trim() === key && translations[currentLang][key]) {
              n.textContent = translations[currentLang][key];
            }
          });
        });

        // Logout button
        var logoutBtn = document.querySelector('.logout-btn');
        if (logoutBtn) {
          if (translations[currentLang]['Logout']) {
            logoutBtn.textContent = translations[currentLang]['Logout'];
          }
          // Make logout clickable: return to Satwik login page
          logoutBtn.addEventListener('click', function() {
            try {
              // Hide dashboard, show login
              var dash = document.getElementById('dashboardPage');
              var login = document.getElementById('loginPage');
              if (dash) dash.classList.add('hidden');
              if (login) login.classList.remove('hidden');
              // Optional: clear simple session-like state
              try { sessionStorage.clear(); } catch(e) {}
              // Reset nav highlight to Home for next login
              var links = document.querySelectorAll('.nav-link');
              links.forEach(function(l){ l.classList.remove('nav-active'); });
              var homeLink = document.querySelector('.nav-link[data-page="Home"]');
              if (homeLink) homeLink.classList.add('nav-active');
            } catch(e) {}
          });
        }

        // Day labels
        var dayLabelMap = ['Today','Tomorrow','Day After Tomorrow'];
        dayLabelMap.forEach(function(key){
          var nodes = document.querySelectorAll('p');
          nodes.forEach(function(n){
            if (n.textContent.trim() === key && translations[currentLang][key]) {
              n.textContent = translations[currentLang][key];
            }
          });
        });

        // Generic text-node translation with key inference + caching
        try {
          function findKeyByValue(val, lang){
            var map = translations[lang] || {};
            for (var k in map) { if (map[k] === val) return k; }
            return null;
          }
          var walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null, false);
          var textNodes = [];
          var node;
          while ((node = walker.nextNode())) { textNodes.push(node); }
          textNodes.forEach(function(tn){
            var original = tn.nodeValue;
            if (!original) return;
            var leadingMatch = original.match(/^\s*/);
            var trailingMatch = original.match(/\s*$/);
            var leading = leadingMatch ? leadingMatch[0] : '';
            var trailing = trailingMatch ? trailingMatch[0] : '';
            var trimmed = original.trim();
            if (!trimmed) return;
            var parent = tn.parentElement;
            if (!parent) return;
            var key = parent.getAttribute('data-i18n-key');
            if (!key) {
              // Try to infer from English first
              if (translations.en && translations.en[trimmed]) {
                key = trimmed;
              } else {
                // Try to infer from Malayalam by reverse lookup
                key = findKeyByValue(trimmed, 'ml');
              }
              if (key) parent.setAttribute('data-i18n-key', key);
            }
            if (key && translations[currentLang] && translations[currentLang][key]) {
              tn.nodeValue = leading + translations[currentLang][key] + trailing;
            }
          });
        } catch(e) {}

        // Common attributes translation
        try {
          var attrKeys = ['placeholder','title','aria-label'];
          var allEls = document.querySelectorAll('*');
          allEls.forEach(function(el){
            attrKeys.forEach(function(attr){
              var val = el.getAttribute && el.getAttribute(attr);
              if (!val) return;
              if (translations[currentLang][val]) {
                el.setAttribute(attr, translations[currentLang][val]);
              }
            });
          });
        } catch(e) {}
      }

      // Initialize
      document.addEventListener('DOMContentLoaded', function() {
        try {
          var saved = localStorage.getItem('appLang');
          if (saved === 'en' || saved === 'ml') { currentLang = saved; }
        } catch(e) {}
        updateLanguageDisplay();
        updateLanguage();

        // Observe DOM changes to translate dynamically added content
        try {
          var debounced;
          var translateObserver = new MutationObserver(function(){
            clearTimeout(debounced);
            debounced = setTimeout(function(){ updateLanguage(); }, 100);
          });
          translateObserver.observe(document.body, { childList: true, subtree: true, characterData: true });
        } catch(e) {}
      });
    </script>

    <!-- Demand Forecasting JavaScript -->
    <script>
      // Mock data for demand forecasting
      const cropData = {
        rice: {
          name: "Rice",
          basePrice: 25,
          demandMultiplier: 1.2,
          priceTrend: "increasing",
          riskLevel: "low",
          yieldPerAcre: 3000,
          priceHistory: [22, 24, 25, 27, 28, 30],
          demandHistory: [85, 88, 90, 92, 95, 98],
          supplyHistory: [80, 82, 85, 87, 90, 92]
        },
        wheat: {
          name: "Wheat",
          basePrice: 22,
          demandMultiplier: 1.1,
          priceTrend: "stable",
          riskLevel: "low",
          yieldPerAcre: 2800,
          priceHistory: [20, 21, 22, 22, 23, 24],
          demandHistory: [75, 78, 80, 82, 84, 86],
          supplyHistory: [78, 80, 82, 84, 86, 88]
        },
        maize: {
          name: "Maize",
          basePrice: 18,
          demandMultiplier: 1.3,
          priceTrend: "increasing",
          riskLevel: "medium",
          yieldPerAcre: 2500,
          priceHistory: [16, 17, 18, 19, 20, 21],
          demandHistory: [70, 75, 80, 85, 90, 95],
          supplyHistory: [75, 78, 80, 82, 85, 88]
        },
        cotton: {
          name: "Cotton",
          basePrice: 65,
          demandMultiplier: 0.9,
          priceTrend: "decreasing",
          riskLevel: "high",
          yieldPerAcre: 800,
          priceHistory: [70, 68, 65, 63, 61, 59],
          demandHistory: [60, 58, 55, 52, 50, 48],
          supplyHistory: [65, 67, 70, 72, 75, 78]
        },
        sugarcane: {
          name: "Sugarcane",
          basePrice: 15,
          demandMultiplier: 1.0,
          priceTrend: "stable",
          riskLevel: "low",
          yieldPerAcre: 50000,
          priceHistory: [14, 15, 15, 16, 15, 16],
          demandHistory: [80, 82, 85, 88, 90, 92],
          supplyHistory: [85, 87, 90, 92, 95, 98]
        },
        tomato: {
          name: "Tomato",
          basePrice: 35,
          demandMultiplier: 1.4,
          priceTrend: "increasing",
          riskLevel: "medium",
          yieldPerAcre: 15000,
          priceHistory: [30, 32, 35, 38, 40, 42],
          demandHistory: [80, 85, 90, 95, 100, 105],
          supplyHistory: [75, 78, 80, 82, 85, 88]
        },
        onion: {
          name: "Onion",
          basePrice: 28,
          demandMultiplier: 1.1,
          priceTrend: "volatile",
          riskLevel: "high",
          yieldPerAcre: 12000,
          priceHistory: [25, 30, 28, 35, 32, 30],
          demandHistory: [70, 75, 80, 85, 90, 95],
          supplyHistory: [75, 80, 85, 90, 95, 100]
        },
        potato: {
          name: "Potato",
          basePrice: 20,
          demandMultiplier: 1.0,
          priceTrend: "stable",
          riskLevel: "low",
          yieldPerAcre: 20000,
          priceHistory: [18, 19, 20, 21, 20, 21],
          demandHistory: [85, 88, 90, 92, 95, 98],
          supplyHistory: [90, 92, 95, 98, 100, 102]
        },
        chili: {
          name: "Chili",
          basePrice: 45,
          demandMultiplier: 1.2,
          priceTrend: "increasing",
          riskLevel: "medium",
          yieldPerAcre: 8000,
          priceHistory: [40, 42, 45, 48, 50, 52],
          demandHistory: [75, 80, 85, 90, 95, 100],
          supplyHistory: [80, 82, 85, 88, 90, 92]
        },
        brinjal: {
          name: "Brinjal",
          basePrice: 30,
          demandMultiplier: 1.1,
          priceTrend: "stable",
          riskLevel: "low",
          yieldPerAcre: 10000,
          priceHistory: [28, 29, 30, 31, 30, 32],
          demandHistory: [70, 75, 80, 85, 90, 95],
          supplyHistory: [75, 78, 80, 82, 85, 88]
        },
        okra: {
          name: "Okra",
          basePrice: 25,
          demandMultiplier: 1.0,
          priceTrend: "stable",
          riskLevel: "low",
          yieldPerAcre: 12000,
          priceHistory: [23, 24, 25, 26, 25, 27],
          demandHistory: [65, 70, 75, 80, 85, 90],
          supplyHistory: [70, 75, 80, 85, 90, 95]
        },
        cabbage: {
          name: "Cabbage",
          basePrice: 15,
          demandMultiplier: 0.9,
          priceTrend: "stable",
          riskLevel: "low",
          yieldPerAcre: 15000,
          priceHistory: [14, 15, 15, 16, 15, 16],
          demandHistory: [60, 65, 70, 75, 80, 85],
          supplyHistory: [70, 75, 80, 85, 90, 95]
        },
        cauliflower: {
          name: "Cauliflower",
          basePrice: 20,
          demandMultiplier: 1.0,
          priceTrend: "stable",
          riskLevel: "low",
          yieldPerAcre: 10000,
          priceHistory: [18, 19, 20, 21, 20, 22],
          demandHistory: [65, 70, 75, 80, 85, 90],
          supplyHistory: [70, 75, 80, 85, 90, 95]
        },
        spinach: {
          name: "Spinach",
          basePrice: 12,
          demandMultiplier: 1.1,
          priceTrend: "increasing",
          riskLevel: "low",
          yieldPerAcre: 8000,
          priceHistory: [10, 11, 12, 13, 12, 14],
          demandHistory: [70, 75, 80, 85, 90, 95],
          supplyHistory: [75, 80, 85, 90, 95, 100]
        }
      };

      // Chart instances
      let priceChart = null;
      let demandSupplyChart = null;
      let cropComparisonChart = null;

      // Initialize Demand Forecasting functionality
      function initDemandForecasting() {
        console.log('Initializing Demand Forecasting...');
        const forecastForm = document.getElementById('forecastForm');
        const exportBtn = document.getElementById('exportReport');
        
        console.log('Found elements:', { forecastForm: !!forecastForm, exportBtn: !!exportBtn });
        
        if (forecastForm) {
          forecastForm.addEventListener('submit', handleForecastSubmit);
          console.log('Added form submit listener');
        } else {
          console.error('Forecast form not found!');
        }
        
        if (exportBtn) {
          exportBtn.addEventListener('click', handleExportReport);
          console.log('Added export button listener');
        } else {
          console.error('Export button not found!');
        }
        
        // Initialize pie chart on page load
        setTimeout(function() {
          console.log('Initializing pie chart...');
          updateCropComparisonChart();
        }, 1000);
      }

      // Handle form submission
      function handleForecastSubmit(e) {
        e.preventDefault();
        console.log('Forecast form submitted');
        
        const crop = document.getElementById('cropSelect').value;
        const location = document.getElementById('locationSelect').value;
        const area = parseFloat(document.getElementById('cultivationArea').value);
        const season = document.getElementById('seasonSelect').value;
        
        console.log('Form data:', { crop, location, area, season });
        
        if (!crop || !location || !area || !season) {
          alert('Please fill in all fields');
          return;
        }
        
        if (cropData[crop]) {
          console.log('Generating forecast for crop:', crop);
          generateForecast(crop, location, area, season);
        } else {
          console.log('No data for crop:', crop);
          showNoDataMessage();
        }
      }

      // Generate forecast based on crop data
      function generateForecast(crop, location, area, season) {
        console.log('Generating forecast with data:', { crop, location, area, season });
        const data = cropData[crop];
        const seasonMultiplier = getSeasonMultiplier(season);
        const locationMultiplier = getLocationMultiplier(location);
        
        console.log('Multipliers:', { seasonMultiplier, locationMultiplier });
        
        // Calculate predictions
        const expectedDemand = Math.round(data.demandHistory[5] * seasonMultiplier * locationMultiplier);
        const priceTrend = data.priceTrend;
        const suggestedQuantity = Math.round(area * data.yieldPerAcre * 0.8); // 80% of potential yield
        const riskLevel = data.riskLevel;
        const expectedRevenue = Math.round(suggestedQuantity * data.basePrice * seasonMultiplier);
        
        console.log('Calculated predictions:', { expectedDemand, priceTrend, suggestedQuantity, riskLevel, expectedRevenue });
        
        // Show results section
        const resultsSection = document.getElementById('forecastResults');
        const noDataMessage = document.getElementById('noDataMessage');
        
        if (resultsSection) {
          resultsSection.classList.remove('hidden');
          console.log('Showing results section');
        }
        if (noDataMessage) {
          noDataMessage.classList.add('hidden');
        }
        
        // Make sure pie chart section is visible
        const pieChartSection = resultsSection.querySelector('.mt-8');
        if (pieChartSection) {
          pieChartSection.classList.remove('hidden');
          console.log('Pie chart section is visible');
        }
        
        // Update UI
        updateForecastDisplay(expectedDemand, priceTrend, suggestedQuantity, riskLevel, expectedRevenue, data);
        
        // Update charts
        updateCharts(data);
        
        // Show results
        document.getElementById('forecastResults').classList.remove('hidden');
        document.getElementById('noDataMessage').classList.add('hidden');
      }

      // Update forecast display
      function updateForecastDisplay(demand, priceTrend, quantity, risk, revenue, data) {
        console.log('Updating forecast display with:', { demand, priceTrend, quantity, risk, revenue });
        
        // Update main prediction cards
        const demandElement = document.getElementById('demandValue');
        const trendElement = document.getElementById('priceTrend');
        const quantityElement = document.getElementById('suggestedQuantity');
        
        if (demandElement) {
          demandElement.textContent = demand + ' tons';
          console.log('Updated demand value');
        }
        if (trendElement) {
          trendElement.textContent = priceTrend.charAt(0).toUpperCase() + priceTrend.slice(1);
          console.log('Updated price trend');
        }
        if (quantityElement) {
          quantityElement.textContent = quantity.toLocaleString() + ' kg';
          console.log('Updated suggested quantity');
        }
        
        const riskElement = document.getElementById('riskFactor');
        riskElement.textContent = risk.charAt(0).toUpperCase() + risk.slice(1);
        riskElement.className = `risk-${risk}`;
        
        // Update price trend visualization
        const priceChange = data.priceHistory[5] - data.priceHistory[0];
        const priceChangePercent = Math.round((priceChange / data.priceHistory[0]) * 100);
        document.getElementById('priceChange').textContent = priceChangePercent > 0 ? '+' + priceChangePercent + '%' : priceChangePercent + '%';
        document.getElementById('priceChangePercent').textContent = priceChangePercent > 0 ? '+' + priceChangePercent + '%' : priceChangePercent + '%';
        document.getElementById('currentPrice').textContent = '₹' + data.basePrice + '/kg';
        
        // Update demand vs supply visualization
        const demandValue = data.demandHistory[5];
        const supplyValue = data.supplyHistory[5];
        const demandSupplyDiff = demandValue - supplyValue;
        const demandSupplyPercent = Math.round((demandSupplyDiff / supplyValue) * 100);
        
        document.getElementById('demandSupplyStatus').textContent = demandSupplyDiff > 0 ? 'High Demand' : demandSupplyDiff < 0 ? 'High Supply' : 'Balanced';
        document.getElementById('demandSupplyPercent').textContent = demandSupplyPercent > 0 ? '+' + demandSupplyPercent + '%' : demandSupplyPercent + '%';
        
        // Update bar chart heights
        const demandBar = document.getElementById('demandBar');
        const supplyBar = document.getElementById('supplyBar');
        const demandHeight = Math.min(100, Math.max(20, demandValue));
        const supplyHeight = Math.min(100, Math.max(20, supplyValue));
        
        demandBar.style.height = demandHeight + '%';
        supplyBar.style.height = supplyHeight + '%';
      }

      // Update charts
      function updateCharts(data) {
        // Destroy existing charts
        if (priceChart) priceChart.destroy();
        if (demandSupplyChart) demandSupplyChart.destroy();
        
        // Price trend chart
        const priceCtx = document.getElementById('priceChart').getContext('2d');
        priceChart = new Chart(priceCtx, {
          type: 'line',
          data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
              label: 'Price (₹/kg)',
              data: data.priceHistory,
              borderColor: '#38e07b',
              backgroundColor: 'rgba(56, 224, 123, 0.1)',
              tension: 0.4,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                labels: {
                  color: '#9eb7a8'
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  color: '#9eb7a8'
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)'
                }
              },
              x: {
                ticks: {
                  color: '#9eb7a8'
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)'
                }
              }
            }
          }
        });
        
        // Demand vs Supply chart
        const demandSupplyCtx = document.getElementById('demandSupplyChart').getContext('2d');
        demandSupplyChart = new Chart(demandSupplyCtx, {
          type: 'doughnut',
          data: {
            labels: ['Demand', 'Supply'],
            datasets: [{
              data: [data.demandHistory[5], data.supplyHistory[5]],
              backgroundColor: ['#38e07b', '#f59e0b'],
              borderWidth: 0
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  color: '#9eb7a8',
                  padding: 20
                }
              }
            }
          }
        });
        
        // Update crop comparison pie chart
        updateCropComparisonChart();
      }

      // Update crop comparison pie chart
      function updateCropComparisonChart() {
        console.log('Updating crop comparison pie chart...');
        
        // Destroy existing chart
        if (cropComparisonChart) {
          cropComparisonChart.destroy();
          cropComparisonChart = null;
        }
        
        // Check if canvas element exists
        const canvas = document.getElementById('cropComparisonChart');
        const fallback = document.getElementById('pieChartFallback');
        
        if (!canvas) {
          console.error('Crop comparison chart canvas not found!');
          return;
        }
        
        console.log('Canvas found:', canvas);
        
        // Hide fallback, show canvas
        if (fallback) fallback.classList.add('hidden');
        canvas.classList.remove('hidden');
        
        // Calculate 4-month projected values for all crops
        const cropValues = [];
        const cropLabels = [];
        const cropColors = [];
        let highestValue = 0;
        let highestValueCrop = '';
        
        // Color palette for different crops
        const colorPalette = [
          '#38e07b', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4',
          '#10b981', '#f97316', '#ec4899', '#84cc16', '#6366f1',
          '#14b8a6', '#f43f5e', '#a855f7', '#0ea5e9', '#22c55e'
        ];
        
        Object.keys(cropData).forEach((cropKey, index) => {
          const crop = cropData[cropKey];
          // Calculate 4-month projected value
          const projectedValue = crop.basePrice * crop.demandHistory[5] * 1.1; // 4-month projection
          cropValues.push(projectedValue);
          cropLabels.push(crop.name);
          cropColors.push(colorPalette[index % colorPalette.length]);
          
          // Track highest value
          if (projectedValue > highestValue) {
            highestValue = projectedValue;
            highestValueCrop = crop.name;
          }
        });
        
        console.log('Crop data calculated:', { cropValues, cropLabels, highestValueCrop });
        
        // Update highest value display
        const highestValueElement = document.getElementById('highestValueCrop');
        if (highestValueElement) {
          highestValueElement.textContent = highestValueCrop;
          console.log('Updated highest value display:', highestValueCrop);
        }
        
        // Create pie chart
        try {
          const cropComparisonCtx = canvas.getContext('2d');
          console.log('Canvas context:', cropComparisonCtx);
          
          cropComparisonChart = new Chart(cropComparisonCtx, {
          type: 'pie',
          data: {
            labels: cropLabels,
            datasets: [{
              data: cropValues,
              backgroundColor: cropColors,
              borderWidth: 2,
              borderColor: '#1a241f'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right',
                labels: {
                  color: '#9eb7a8',
                  padding: 15,
                  usePointStyle: true,
                  pointStyle: 'circle',
                  font: {
                    size: 12
                  }
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.parsed;
                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                    const percentage = ((value / total) * 100).toFixed(1);
                    return `${label}: ₹${value.toLocaleString()} (${percentage}%)`;
                  }
                },
                backgroundColor: 'rgba(26, 36, 31, 0.9)',
                titleColor: '#ffffff',
                bodyColor: '#9eb7a8',
                borderColor: '#38e07b',
                borderWidth: 1
              }
            },
            animation: {
              animateRotate: true,
              duration: 2000
            }
          }
        });
        
        console.log('Pie chart created successfully:', cropComparisonChart);
        } catch (error) {
          console.error('Error creating pie chart:', error);
          // Show fallback if chart creation fails
          if (fallback) {
            fallback.classList.remove('hidden');
            fallback.innerHTML = `
              <div class="text-6xl mb-4">📊</div>
              <p class="text-white/60 mb-4">Chart loading failed. Showing crop data:</p>
              <div class="text-left space-y-2 max-h-48 overflow-y-auto">
                ${cropLabels.map((label, index) => `
                  <div class="flex justify-between items-center p-2 bg-[#1a241f] rounded">
                    <span class="text-white">${label}</span>
                    <span class="text-[var(--primary-500)] font-bold">₹${cropValues[index].toLocaleString()}</span>
                  </div>
                `).join('')}
              </div>
            `;
          }
          canvas.classList.add('hidden');
        }
      }

      // Get season multiplier
      function getSeasonMultiplier(season) {
        const multipliers = {
          'kharif': 1.1,
          'rabi': 1.0,
          'zaid': 0.9
        };
        return multipliers[season] || 1.0;
      }

      // Get location multiplier
      function getLocationMultiplier(location) {
        const multipliers = {
          'thiruvananthapuram': 1.2,
          'kollam': 1.1,
          'pathanamthitta': 1.0,
          'alappuzha': 1.1,
          'kottayam': 1.0,
          'idukki': 0.9,
          'ernakulam': 1.2,
          'thrissur': 1.1,
          'palakkad': 1.0,
          'malappuram': 1.1,
          'kozhikode': 1.0,
          'wayanad': 0.9,
          'kannur': 1.0,
          'kasaragod': 0.9
        };
        return multipliers[location] || 1.0;
      }

      // Show no data message
      function showNoDataMessage() {
        document.getElementById('forecastResults').classList.add('hidden');
        document.getElementById('noDataMessage').classList.remove('hidden');
        
        // Destroy crop comparison chart
        if (cropComparisonChart) {
          cropComparisonChart.destroy();
          cropComparisonChart = null;
        }
      }

      // Handle export report
      function handleExportReport() {
        const crop = document.getElementById('cropSelect').value;
        const location = document.getElementById('locationSelect').value;
        const area = document.getElementById('cultivationArea').value;
        const season = document.getElementById('seasonSelect').value;
        
        if (!crop || !location || !area || !season) {
          alert('Please generate a forecast first');
          return;
        }
        
        const data = cropData[crop];
        const highestValueCrop = document.getElementById('highestValueCrop').textContent;
        const reportData = {
          crop: data.name,
          location: location,
          area: area,
          season: season,
          demand: document.getElementById('demandValue').textContent,
          priceTrend: document.getElementById('priceTrend').textContent,
          suggestedQuantity: document.getElementById('suggestedQuantity').textContent,
          riskFactor: document.getElementById('riskFactor').textContent,
          expectedRevenue: document.getElementById('expectedRevenue').textContent,
          highestValueCrop: highestValueCrop,
          timestamp: new Date().toLocaleString()
        };
        
        // Create CSV content
        const csvContent = `Crop,Location,Area (Acres),Season,Expected Demand,Price Trend,Suggested Quantity,Risk Factor,Expected Revenue,Highest Value Crop,Generated On
${reportData.crop},${reportData.location},${reportData.area},${reportData.season},${reportData.demand},${reportData.priceTrend},${reportData.suggestedQuantity},${reportData.riskFactor},${reportData.expectedRevenue},${reportData.highestValueCrop},${reportData.timestamp}`;
        
        // Download CSV
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `demand_forecast_${crop}_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        alert('Report downloaded successfully!');
      }

      // Initialize when DOM is loaded
      // initDemandForecasting will be called from main DOMContentLoaded
    </script>

    <script>
      (function(){
        try {
          document.addEventListener('DOMContentLoaded', function(){
            var pastTrackNodes = Array.prototype.slice.call(document.querySelectorAll('.profile-menu-text'));
            // Wire up Crop Management open/close
            var cmTrigger = document.getElementById('openCropManagement');
            if (cmTrigger) {
              cmTrigger.addEventListener('click', function(){
                var p = document.getElementById('cropManagementPage');
                if (p) { p.classList.remove('hidden'); p.classList.add('active'); }
              });
            }
            
            // Wire up Farm Details to Cultivation Guidance
            var farmDetailsNodes = Array.prototype.slice.call(document.querySelectorAll('.profile-menu-text'));
            farmDetailsNodes.forEach(function(node){
              if ((node.textContent || '').trim().toLowerCase() === 'farm details') {
                var parent = node.closest('.profile-menu-item') || node.parentElement;
                if (parent) {
                  parent.style.cursor = 'pointer';
                  parent.addEventListener('click', function(){
                    var cg = document.getElementById('cultivationGuidancePage');
                    if (cg) { cg.classList.remove('hidden'); cg.classList.add('active'); }
                  });
                } else {
                  node.style.cursor = 'pointer';
                  node.addEventListener('click', function(){
                    var cg = document.getElementById('cultivationGuidancePage');
                    if (cg) { cg.classList.remove('hidden'); cg.classList.add('active'); }
                  });
                }
              }
            });

            // Wire up Help & Support to Expert Contacts
            var helpNodes = Array.prototype.slice.call(document.querySelectorAll('.profile-menu-text'));
            helpNodes.forEach(function(node){
              if ((node.textContent || '').trim().toLowerCase() === 'help & support') {
                var parent = node.closest('.profile-menu-item') || node.parentElement;
                if (parent) {
                  parent.style.cursor = 'pointer';
                  parent.addEventListener('click', function(){
                    var ec = document.getElementById('expertContactsPage');
                    if (ec) { ec.classList.remove('hidden'); ec.classList.add('active'); }
                  });
                } else {
                  node.style.cursor = 'pointer';
                  node.addEventListener('click', function(){
                    var ec = document.getElementById('expertContactsPage');
                    if (ec) { ec.classList.remove('hidden'); ec.classList.add('active'); }
                  });
                }
              }
            });

            // Wire up Demand Forecasting button in settings
            var openDemandForecasting = document.getElementById('openDemandForecasting');
            if (openDemandForecasting) {
              openDemandForecasting.style.cursor = 'pointer';
              openDemandForecasting.addEventListener('click', function(e){
                e.preventDefault();
                e.stopPropagation();
                console.log('Demand Forecasting button clicked');
                
                // Hide settings page and show demand forecasting page
                var settingsPage = document.getElementById('settingsPage');
                var demandForecastingPage = document.getElementById('demandForecastingPage');
                if (settingsPage) settingsPage.classList.add('hidden');
                if (demandForecastingPage) {
                  demandForecastingPage.classList.remove('hidden');
                  demandForecastingPage.classList.add('active');
                }
              });
            }

            // Wire up List Your Service button in settings
            var openListService = document.getElementById('openListService');
            if (openListService) {
              openListService.style.cursor = 'pointer';
              openListService.addEventListener('click', function(e){
                e.preventDefault();
                e.stopPropagation();
                console.log('List Your Service button clicked');
                
                // Hide settings page and show list service page
                var settingsPage = document.getElementById('settingsPage');
                var listServicePage = document.getElementById('listServicePage');
                if (settingsPage) settingsPage.classList.add('hidden');
                if (listServicePage) {
                  listServicePage.classList.remove('hidden');
                  listServicePage.classList.add('active');
                }
              });
            }

            // Wire up Edit Profile button in settings
            var openProfileFromSettings = document.getElementById('openProfileFromSettings');
            if (openProfileFromSettings) {
              openProfileFromSettings.style.cursor = 'pointer';
              openProfileFromSettings.addEventListener('click', function(e){
                e.preventDefault();
                e.stopPropagation();
                console.log('Edit Profile button clicked');
                
                // Load existing data into edit form
                try {
                  var farmerData = JSON.parse(localStorage.getItem('farmerInfo') || '{}');
                  var userEmail = localStorage.getItem('userEmail') || '';
                  var userPhone = localStorage.getItem('userPhone') || '';
                  
                  document.getElementById('ep_name').value = farmerData.name || '';
                  document.getElementById('ep_email').value = userEmail || '';
                  document.getElementById('ep_phone').value = userPhone || farmerData.contact || '';
                  document.getElementById('ep_address').value = farmerData.address || '';
                  document.getElementById('ep_age').value = farmerData.age || '';
                  document.getElementById('ep_gender').value = farmerData.gender || '';
                  document.getElementById('ep_land_size').value = farmerData.land_size || '';
                  document.getElementById('ep_land_type').value = farmerData.land_type || '';
                  document.getElementById('ep_soil_type').value = farmerData.soil_type || '';
                  document.getElementById('ep_water_source').value = farmerData.water_source || '';
                } catch(e) {
                  console.log('Error loading profile data:', e);
                }
                
                var editProfile = document.getElementById('editProfilePage');
                if (editProfile) { 
                  editProfile.classList.remove('hidden'); 
                  editProfile.classList.add('active'); 
                  console.log('Edit profile page opened');
                }
              });
            }

            // Wire up User Address button
            var openUserAddress = document.getElementById('openUserAddress');
            if (openUserAddress) {
              openUserAddress.style.cursor = 'pointer';
              openUserAddress.addEventListener('click', function(e){
                e.preventDefault();
                e.stopPropagation();
                console.log('Address button clicked');
                // Load address data from farmer info
                try {
                  var farmerData = JSON.parse(localStorage.getItem('farmerInfo') || '{}');
                  var userEmail = localStorage.getItem('userEmail') || '';
                  var userPhone = localStorage.getItem('userPhone') || '';
                  
                  var addressDisplay = document.getElementById('userAddressDisplay');
                  var contactDisplay = document.getElementById('userContactDisplay');
                  var farmLocationDisplay = document.getElementById('farmLocationDisplay');
                  
                  if (addressDisplay) {
                    addressDisplay.textContent = farmerData.address || 'No address information available. Please update your profile.';
                  }
                  if (contactDisplay) {
                    var contactInfo = [];
                    if (userEmail) contactInfo.push('Email: ' + userEmail);
                    if (userPhone) contactInfo.push('Phone: ' + userPhone);
                    if (farmerData.contact) contactInfo.push('Farm Contact: ' + farmerData.contact);
                    contactDisplay.textContent = contactInfo.length > 0 ? contactInfo.join('\n') : 'No contact information available.';
                  }
                  if (farmLocationDisplay) {
                    var farmInfo = [];
                    if (farmerData.land_size) farmInfo.push('Land Size: ' + farmerData.land_size);
                    if (farmerData.land_type) farmInfo.push('Land Type: ' + farmerData.land_type);
                    if (farmerData.soil_type) farmInfo.push('Soil Type: ' + farmerData.soil_type);
                    farmLocationDisplay.textContent = farmInfo.length > 0 ? farmInfo.join('\n') : 'No farm location information available.';
                  }
                } catch(e) {
                  console.log('Error loading address data:', e);
                }
                
                var ua = document.getElementById('userAddressPage');
                if (ua) { 
                  ua.classList.remove('hidden'); 
                  ua.classList.add('active'); 
                  console.log('User address page opened');
                }
              });
            }
            
            // Ensure Cultivation Guidance back button works
            var cgBackBtn = document.getElementById('backFromCultivationGuidance');
            if (cgBackBtn) {
              cgBackBtn.addEventListener('click', function(){
                var cg = document.getElementById('cultivationGuidancePage');
                if (cg) { 
                  cg.classList.remove('active'); 
                  setTimeout(function(){ 
                    cg.classList.add('hidden'); 
                    cg.style.transform=''; 
                  }, 250); 
                }
                var profile = document.getElementById('profile');
                if (profile) profile.classList.remove('hidden');
              });
            }

            // Open Post-Disaster Help
            var pdOpen = document.getElementById('openPostDisaster');
            if (pdOpen) {
              pdOpen.addEventListener('click', function(){
                var pd = document.getElementById('postDisasterPage');
                if (pd) { pd.classList.remove('hidden'); pd.classList.add('active'); }
              });
            }
            function formatCurrency(n){
              var num = Number(n||0);
              try { return num.toLocaleString(undefined,{ style:'currency', currency:'INR', maximumFractionDigits:0 }); } catch(e){ return '₹' + num; }
            }
            function formatMonthYear(d){
              try { var dt = new Date(d); return dt.toLocaleString(undefined,{ month:'short', year:'numeric' }); } catch(e){ return ''; }
            }
            function monthDiff(a,b){
              try {
                var d1 = new Date(a), d2 = new Date(b);
                return Math.max(0, (d2.getFullYear()-d1.getFullYear())*12 + (d2.getMonth()-d1.getMonth()));
              } catch(e){ return 0; }
            }

            function showPastTrackPage(){
              // Hide profile page, show past track page
              var profile = document.getElementById('profilePage');
              var page = document.getElementById('pastTrackPage');
              if (profile) profile.classList.add('hidden');
              if (page) {
                page.classList.remove('hidden');
                setPastTrackSlideDirection();
                // trigger slide-in
                requestAnimationFrame(function(){ page.classList.add('active'); });
              }

              // Populate data from localStorage
              // Force previous crop to onion as requested
              try { localStorage.setItem('previousCropName', 'onion'); } catch(e) {}
              var crop = 'onion';
              var cost = localStorage.getItem('previousCropTotalCost');
              var revenue = localStorage.getItem('previousCropTotalRevenue');
              var start = localStorage.getItem('previousCropStart');
              var end = localStorage.getItem('previousCropEnd');
              var summary = localStorage.getItem('previousCropSummary');
              var adv = localStorage.getItem('previousCropAdvice');

              // Fill missing fields with Onion defaults (non-destructive per field)
              try {
                var now = new Date();
                var defaultStart = new Date(now.getFullYear()-1, 10, 1); // Nov last year
                var defaultEnd = new Date(now.getFullYear(), 2, 31);     // Mar this year
                var defaults = {
                  crop: 'onion',
                  cost: '42000',
                  revenue: '68000',
                  start: defaultStart.toISOString(),
                  end: defaultEnd.toISOString(),
                  summary: 'Onion crop grew well with timely irrigation and two weeding rounds. Yield met targets; minor thrips pressure handled early.',
                  adv: 'Use mulch to retain moisture. Monitor thrips during bulb formation. Apply potash at bulb initiation. Cure bulbs properly before storage.'
                };
                // crop already forced to onion above
                if (!cost) { cost = defaults.cost; localStorage.setItem('previousCropTotalCost', cost); }
                if (!revenue) { revenue = defaults.revenue; localStorage.setItem('previousCropTotalRevenue', revenue); }
                if (!start) { start = defaults.start; localStorage.setItem('previousCropStart', start); }
                if (!end) { end = defaults.end; localStorage.setItem('previousCropEnd', end); }
                if (!summary) { summary = defaults.summary; localStorage.setItem('previousCropSummary', summary); }
                if (!adv) { adv = defaults.adv; localStorage.setItem('previousCropAdvice', adv); }
              } catch(e) { /* ignore */ }

              var durationMonths = (start && end) ? monthDiff(start,end) : 0;
              var profit = (Number(revenue||0) - Number(cost||0)) || 0;

              var setText = function(id, val){ var el = document.getElementById(id); if (el) el.textContent = val; };
              setText('ptCrop', crop || '—');
              setText('ptCost', cost ? formatCurrency(cost) : '—');
              setText('ptRevenue', revenue ? formatCurrency(revenue) : '—');
              setText('ptProfit', (cost||revenue) ? formatCurrency(profit) : '—');
              setText('ptDuration', (start && end) ? (durationMonths + ' months') : '—');
              setText('ptRange', (start && end) ? (formatMonthYear(start) + ' → ' + formatMonthYear(end)) : '—');
              setText('ptSummary', summary || '—');

              var adviceList = document.getElementById('ptAdvice');
              if (adviceList) {
                adviceList.innerHTML = '';
                var adviceItems = (adv||'').split(/\n|\.|;/).map(function(s){ return s.trim(); }).filter(Boolean);
                adviceItems.forEach(function(item){
                  var li = document.createElement('li');
                  li.textContent = item;
                  adviceList.appendChild(li);
                });
              }

              // Back button
              var backBtn = document.getElementById('backFromPastTrack');
              if (backBtn) {
                backBtn.onclick = function(){
                  if (page) {
                    page.classList.remove('active');
                    // after transition, hide
                    setTimeout(function(){ page.classList.add('hidden'); page.style.transform=''; }, 250);
                  }
                  if (profile) profile.classList.remove('hidden');
                };
                // Also add event listener as backup
                backBtn.addEventListener('click', function(){
                  if (page) {
                    page.classList.remove('active');
                    // after transition, hide
                    setTimeout(function(){ page.classList.add('hidden'); page.style.transform=''; }, 250);
                  }
                  if (profile) profile.classList.remove('hidden');
                });
              }

              // Back from Crop Management
              var backFromCM = document.getElementById('backFromCropManagement');
              if (backFromCM) {
                backFromCM.onclick = function(){
                  var cm = document.getElementById('cropManagementPage');
                  if (cm) { cm.classList.remove('active'); setTimeout(function(){ cm.classList.add('hidden'); cm.style.transform=''; }, 250); }
                  if (profile) profile.classList.remove('hidden');
                };
                // Also add event listener as backup
                backFromCM.addEventListener('click', function(){
                  var cm = document.getElementById('cropManagementPage');
                  if (cm) { cm.classList.remove('active'); setTimeout(function(){ cm.classList.add('hidden'); cm.style.transform=''; }, 250); }
                  if (profile) profile.classList.remove('hidden');
                });
              }
              
              // Back from Cultivation Guidance
              var backFromCG = document.getElementById('backFromCultivationGuidance');
              if (backFromCG) {
                backFromCG.onclick = function(){
                  var cg = document.getElementById('cultivationGuidancePage');
                  if (cg) { cg.classList.remove('active'); setTimeout(function(){ cg.classList.add('hidden'); cg.style.transform=''; }, 250); }
                  if (profile) profile.classList.remove('hidden');
                };
                // Also add event listener as backup
                backFromCG.addEventListener('click', function(){
                  var cg = document.getElementById('cultivationGuidancePage');
                  if (cg) { cg.classList.remove('active'); setTimeout(function(){ cg.classList.add('hidden'); cg.style.transform=''; }, 250); }
                  if (profile) profile.classList.remove('hidden');
                });
              }

              // Back from Expert Contacts
              var backFromEC = document.getElementById('backFromExpertContacts');
              if (backFromEC) {
                var closeEC = function(e){
                  if (e && e.preventDefault) e.preventDefault();
                  if (e && e.stopPropagation) e.stopPropagation();
                  var ec = document.getElementById('expertContactsPage');
                  if (ec) { ec.classList.remove('active'); setTimeout(function(){ ec.classList.add('hidden'); ec.style.transform=''; }, 250); }
                  // ensure other overlays are hidden
                  var wp = document.getElementById('weatherPrecautionPage');
                  if (wp) { wp.classList.remove('active'); wp.classList.add('hidden'); wp.style.transform=''; }
                  var profilePage = document.getElementById('profilePage');
                  if (profilePage) profilePage.classList.remove('hidden');
                };
                backFromEC.onclick = closeEC;
                backFromEC.addEventListener('click', closeEC, true);
                // Add multiple event listeners for reliability
                backFromEC.addEventListener('touchstart', closeEC);
                backFromEC.addEventListener('mousedown', closeEC);
              }

              // Back from Post-Disaster
              var backFromPD = document.getElementById('backFromPostDisaster');
              if (backFromPD) {
                var closePD = function(e){
                  if (e && e.preventDefault) e.preventDefault();
                  if (e && e.stopPropagation) e.stopPropagation();
                  var pd = document.getElementById('postDisasterPage');
                  if (pd) { pd.classList.remove('active'); setTimeout(function(){ pd.classList.add('hidden'); pd.style.transform=''; }, 250); }
                  // ensure other overlays are hidden
                  var wp = document.getElementById('weatherPrecautionPage');
                  if (wp) { wp.classList.remove('active'); wp.classList.add('hidden'); wp.style.transform=''; }
                  var ec = document.getElementById('expertContactsPage');
                  if (ec) { ec.classList.remove('active'); ec.classList.add('hidden'); ec.style.transform=''; }
                  var profilePage = document.getElementById('profilePage');
                  if (profilePage) profilePage.classList.remove('hidden');
                };
                backFromPD.onclick = closePD;
                backFromPD.addEventListener('click', closePD, true);
              }

              // Back from User Address
              var backFromUA = document.getElementById('backFromUserAddress');
              if (backFromUA) {
                var closeUA = function(e){
                  if (e && e.preventDefault) e.preventDefault();
                  if (e && e.stopPropagation) e.stopPropagation();
                  var ua = document.getElementById('userAddressPage');
                  if (ua) { ua.classList.remove('active'); setTimeout(function(){ ua.classList.add('hidden'); ua.style.transform=''; }, 250); }
                  // ensure other overlays are hidden
                  var wp = document.getElementById('weatherPrecautionPage');
                  if (wp) { wp.classList.remove('active'); wp.classList.add('hidden'); wp.style.transform=''; }
                  var ec = document.getElementById('expertContactsPage');
                  if (ec) { ec.classList.remove('active'); ec.classList.add('hidden'); ec.style.transform=''; }
                  var pd = document.getElementById('postDisasterPage');
                  if (pd) { pd.classList.remove('active'); pd.classList.add('hidden'); pd.style.transform=''; }
                  var ep = document.getElementById('editProfilePage');
                  if (ep) { ep.classList.remove('active'); ep.classList.add('hidden'); ep.style.transform=''; }
                  var profilePage = document.getElementById('profilePage');
                  if (profilePage) profilePage.classList.remove('hidden');
                };
                backFromUA.onclick = closeUA;
                backFromUA.addEventListener('click', closeUA, true);
                // Add multiple event listeners for reliability
                backFromUA.addEventListener('touchstart', closeUA);
                backFromUA.addEventListener('mousedown', closeUA);
              }

              // Back from Edit Profile
              var backFromEP = document.getElementById('backFromEditProfile');
              if (backFromEP) {
                backFromEP.onclick = function(e) {
                  e.preventDefault();
                  e.stopPropagation();
                  console.log('Edit profile back button clicked');
                  var ep = document.getElementById('editProfilePage');
                  if (ep) { 
                    ep.classList.remove('active'); 
                    setTimeout(function(){ 
                      ep.classList.add('hidden'); 
                      ep.style.transform=''; 
                    }, 150); 
                  }
                  var profilePage = document.getElementById('profilePage');
                  if (profilePage) profilePage.classList.remove('hidden');
                  return false;
                };
              }

              // Back from Demand Forecasting
              var backFromDF = document.getElementById('backFromDemandForecasting');
              if (backFromDF) {
                backFromDF.addEventListener('click', function(e){
                  e.preventDefault();
                  e.stopPropagation();
                  console.log('Demand Forecasting back button clicked');
                  var df = document.getElementById('demandForecastingPage');
                  if (df) { 
                    df.classList.remove('active'); 
                    setTimeout(function(){ 
                      df.classList.add('hidden'); 
                      df.style.transform=''; 
                    }, 150); 
                  }
                  var settingsPage = document.getElementById('settingsPage');
                  if (settingsPage) settingsPage.classList.remove('hidden');
                });
              }

              // Back from List Your Service
              var backFromLS = document.getElementById('backFromListService');
              if (backFromLS) {
                backFromLS.addEventListener('click', function(e){
                  e.preventDefault();
                  e.stopPropagation();
                  console.log('List Your Service back button clicked');
                  var ls = document.getElementById('listServicePage');
                  if (ls) { 
                    ls.classList.remove('active'); 
                    setTimeout(function(){ 
                      ls.classList.add('hidden'); 
                      ls.style.transform=''; 
                    }, 150); 
                  }
                  var settingsPage = document.getElementById('settingsPage');
                  if (settingsPage) settingsPage.classList.remove('hidden');
                });
              }

              // Save Profile functionality
              var saveProfileBtn = document.getElementById('saveProfileBtn');
              if (saveProfileBtn) {
                saveProfileBtn.addEventListener('click', function(){
                  try {
                    var profileData = {
                      name: document.getElementById('ep_name').value || '',
                      email: document.getElementById('ep_email').value || '',
                      phone: document.getElementById('ep_phone').value || '',
                      address: document.getElementById('ep_address').value || '',
                      age: document.getElementById('ep_age').value || '',
                      gender: document.getElementById('ep_gender').value || '',
                      land_size: document.getElementById('ep_land_size').value || '',
                      land_type: document.getElementById('ep_land_type').value || '',
                      soil_type: document.getElementById('ep_soil_type').value || '',
                      water_source: document.getElementById('ep_water_source').value || ''
                    };
                    
                    // Save to localStorage
                    localStorage.setItem('farmerInfo', JSON.stringify(profileData));
                    localStorage.setItem('userEmail', profileData.email);
                    localStorage.setItem('userPhone', profileData.phone);
                    
                    // Update profile display
                    var profileName = document.querySelector('.profile-name');
                    var profileEmail = document.querySelector('.profile-email');
                    if (profileName && profileData.name) {
                      profileName.textContent = profileData.name;
                    }
                    if (profileEmail && profileData.email) {
                      profileEmail.textContent = profileData.email;
                    }
                    
                    // Close edit profile page
                    var ep = document.getElementById('editProfilePage');
                    if (ep) { ep.classList.remove('active'); ep.classList.add('hidden'); }
                    var profilePage = document.getElementById('profilePage');
                    if (profilePage) profilePage.classList.remove('hidden');
                    
                    alert('Profile updated successfully!');
                  } catch(e) {
                    console.log('Error saving profile:', e);
                    alert('Error saving profile. Please try again.');
                  }
                });
              }
            }

            pastTrackNodes.forEach(function(node){
              if ((node.textContent || '').trim().toLowerCase() === 'past track') {
                var parent = node.closest('.profile-menu-item') || node.parentElement;
                if (parent) {
                  parent.style.cursor = 'pointer';
                  parent.addEventListener('click', function(){
                    showPastTrackPage();
                  });
                } else {
                  node.style.cursor = 'pointer';
                  node.addEventListener('click', function(){
                    showPastTrackPage();
                  });
                }
              }
            });

            // Persist previous crop selection if present on this page
            var previousCropSelect = document.getElementById('previousCrop');
            if (previousCropSelect) {
              // Load saved value
              var savedPrev = localStorage.getItem('previousCropName');
              if (savedPrev) {
                var opt = Array.prototype.find.call(previousCropSelect.options, function(o){
                  return (o.value || '').toLowerCase() === savedPrev.toLowerCase();
                });
                if (opt) previousCropSelect.value = opt.value;
              }
              previousCropSelect.addEventListener('change', function(){
                var val = previousCropSelect.value || '';
                if (val && val !== 'none') {
                  localStorage.setItem('previousCropName', val);
                  // If there are auxiliary fields for cost/dates, try to read them here later
                } else {
                  localStorage.removeItem('previousCropName');
                }
              });
            }

            // Load existing past track details into form if available
            // Removed Past Track extra form inputs and save handler per request
            
            // Initialize Demand Forecasting
            initDemandForecasting();

            // Initialize List Your Service form
            var listServiceForm = document.getElementById('listServiceForm');
            if (listServiceForm) {
              listServiceForm.addEventListener('submit', function(e) {
                e.preventDefault();
                console.log('List Your Service form submitted');
                
                // Get form data
                var formData = {
                  serviceType: document.getElementById('service-type').value,
                  description: document.getElementById('service-description').value,
                  contactPerson: document.getElementById('contact-person').value,
                  contactNumber: document.getElementById('contact-number').value,
                  email: document.getElementById('email').value,
                  location: document.getElementById('service-location').value,
                  date: listServiceForm.querySelector('input[type="date"]').value,
                  time: listServiceForm.querySelector('input[type="time"]').value,
                  pricingModel: listServiceForm.querySelector('select').value,
                  price: listServiceForm.querySelector('input[type="number"]').value
                };
                
                console.log('Form data:', formData);
                
                // Show success message
                alert('Service listing submitted successfully! We will review and publish it soon.');
                
                // Reset form
                listServiceForm.reset();
              });
            }
            
            // COMPREHENSIVE BACK BUTTON FIX - Add event listeners for ALL back buttons
            console.log('Setting up comprehensive back button handlers...');
            
            // 1. Expert Contacts Back Button
            var backFromEC = document.getElementById('backFromExpertContacts');
            if (backFromEC) {
              backFromEC.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Expert Contacts back clicked');
                var ec = document.getElementById('expertContactsPage');
                if (ec) {
                  ec.classList.remove('active');
                  setTimeout(function(){ ec.classList.add('hidden'); ec.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              };
              backFromEC.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Expert Contacts back clicked (addEventListener)');
                var ec = document.getElementById('expertContactsPage');
                if (ec) {
                  ec.classList.remove('active');
                  setTimeout(function(){ ec.classList.add('hidden'); ec.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              });
            }
            
            // 2. User Address Back Button
            var backFromUA = document.getElementById('backFromUserAddress');
            if (backFromUA) {
              backFromUA.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('User Address back clicked');
                var ua = document.getElementById('userAddressPage');
                if (ua) {
                  ua.classList.remove('active');
                  setTimeout(function(){ ua.classList.add('hidden'); ua.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              };
              backFromUA.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('User Address back clicked (addEventListener)');
                var ua = document.getElementById('userAddressPage');
                if (ua) {
                  ua.classList.remove('active');
                  setTimeout(function(){ ua.classList.add('hidden'); ua.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              });
            }
            
            // 3. Edit Profile Back Button
            var backFromEP = document.getElementById('backFromEditProfile');
            if (backFromEP) {
              backFromEP.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Edit Profile back clicked');
                var ep = document.getElementById('editProfilePage');
                if (ep) {
                  ep.classList.remove('active');
                  setTimeout(function(){ ep.classList.add('hidden'); ep.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              };
              backFromEP.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Edit Profile back clicked (addEventListener)');
                var ep = document.getElementById('editProfilePage');
                if (ep) {
                  ep.classList.remove('active');
                  setTimeout(function(){ ep.classList.add('hidden'); ep.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              });
            }
            
            // 4. Post Disaster Back Button
            var backFromPD = document.getElementById('backFromPostDisaster');
            if (backFromPD) {
              backFromPD.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Post Disaster back clicked');
                var pd = document.getElementById('postDisasterPage');
                if (pd) {
                  pd.classList.remove('active');
                  setTimeout(function(){ pd.classList.add('hidden'); pd.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              };
              backFromPD.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Post Disaster back clicked (addEventListener)');
                var pd = document.getElementById('postDisasterPage');
                if (pd) {
                  pd.classList.remove('active');
                  setTimeout(function(){ pd.classList.add('hidden'); pd.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              });
            }
            
            // 5. Farmer Info Back Button
            var backFromFI = document.getElementById('backFromFarmerInfo');
            if (backFromFI) {
              backFromFI.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Farmer Info back clicked');
                var fi = document.getElementById('farmerInfoPage');
                if (fi) {
                  fi.classList.remove('active');
                  setTimeout(function(){ fi.classList.add('hidden'); fi.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              };
              backFromFI.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Farmer Info back clicked (addEventListener)');
                var fi = document.getElementById('farmerInfoPage');
                if (fi) {
                  fi.classList.remove('active');
                  setTimeout(function(){ fi.classList.add('hidden'); fi.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              });
            }
            
            // 6. Privacy Back Button
            var backFromPrivacy = document.getElementById('backFromPrivacy');
            if (backFromPrivacy) {
              backFromPrivacy.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Privacy back clicked');
                var privacy = document.getElementById('privacyPage');
                if (privacy) {
                  privacy.classList.remove('active');
                  setTimeout(function(){ privacy.classList.add('hidden'); privacy.style.transform=''; }, 150);
                }
                var settings = document.getElementById('settingsPage');
                if (settings) settings.classList.remove('hidden');
              };
              backFromPrivacy.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Privacy back clicked (addEventListener)');
                var privacy = document.getElementById('privacyPage');
                if (privacy) {
                  privacy.classList.remove('active');
                  setTimeout(function(){ privacy.classList.add('hidden'); privacy.style.transform=''; }, 150);
                }
                var settings = document.getElementById('settingsPage');
                if (settings) settings.classList.remove('hidden');
              });
            }
            
            // 7. Terms Back Button
            var backFromTerms = document.getElementById('backFromTerms');
            if (backFromTerms) {
              backFromTerms.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Terms back clicked');
                var terms = document.getElementById('termsPage');
                if (terms) {
                  terms.classList.remove('active');
                  setTimeout(function(){ terms.classList.add('hidden'); terms.style.transform=''; }, 150);
                }
                var settings = document.getElementById('settingsPage');
                if (settings) settings.classList.remove('hidden');
              };
              backFromTerms.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Terms back clicked (addEventListener)');
                var terms = document.getElementById('termsPage');
                if (terms) {
                  terms.classList.remove('active');
                  setTimeout(function(){ terms.classList.add('hidden'); terms.style.transform=''; }, 150);
                }
                var settings = document.getElementById('settingsPage');
                if (settings) settings.classList.remove('hidden');
              });
            }
            
            // 8. Farm Details Back Button
            var backFromFD = document.getElementById('backFromFarmDetails');
            if (backFromFD) {
              backFromFD.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Farm Details back clicked');
                var fd = document.getElementById('farmDetailsPage');
                if (fd) {
                  fd.classList.remove('active');
                  setTimeout(function(){ fd.classList.add('hidden'); fd.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              };
              backFromFD.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Farm Details back clicked (addEventListener)');
                var fd = document.getElementById('farmDetailsPage');
                if (fd) {
                  fd.classList.remove('active');
                  setTimeout(function(){ fd.classList.add('hidden'); fd.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              });
            }
            
            // 9. Weather Precaution Back Button
            var backFromWP = document.getElementById('backFromPrecaution');
            if (backFromWP) {
              backFromWP.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Weather Precaution back clicked');
                var wp = document.getElementById('weatherPrecautionPage');
                if (wp) {
                  wp.classList.remove('active');
                  setTimeout(function(){ wp.classList.add('hidden'); wp.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              };
              backFromWP.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Weather Precaution back clicked (addEventListener)');
                var wp = document.getElementById('weatherPrecautionPage');
                if (wp) {
                  wp.classList.remove('active');
                  setTimeout(function(){ wp.classList.add('hidden'); wp.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              });
            }
            
            // 10. Info Back Button
            var backFromInfo = document.getElementById('backFromInfo');
            if (backFromInfo) {
              backFromInfo.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Info back clicked');
                var info = document.getElementById('infoPage');
                if (info) {
                  info.classList.remove('active');
                  setTimeout(function(){ info.classList.add('hidden'); info.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              };
              backFromInfo.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Info back clicked (addEventListener)');
                var info = document.getElementById('infoPage');
                if (info) {
                  info.classList.remove('active');
                  setTimeout(function(){ info.classList.add('hidden'); info.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              });
            }
            
            // 11. Past Track Back Button
            var backFromPT = document.getElementById('backFromPastTrack');
            if (backFromPT) {
              backFromPT.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Past Track back clicked');
                var pt = document.getElementById('pastTrackPage');
                if (pt) {
                  pt.classList.remove('active');
                  setTimeout(function(){ pt.classList.add('hidden'); pt.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              };
              backFromPT.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Past Track back clicked (addEventListener)');
                var pt = document.getElementById('pastTrackPage');
                if (pt) {
                  pt.classList.remove('active');
                  setTimeout(function(){ pt.classList.add('hidden'); pt.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              });
            }
            
            // 12. Crop Management Back Button
            var backFromCM = document.getElementById('backFromCropManagement');
            if (backFromCM) {
              backFromCM.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Crop Management back clicked');
                var cm = document.getElementById('cropManagementPage');
                if (cm) {
                  cm.classList.remove('active');
                  setTimeout(function(){ cm.classList.add('hidden'); cm.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              };
              backFromCM.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Crop Management back clicked (addEventListener)');
                var cm = document.getElementById('cropManagementPage');
                if (cm) {
                  cm.classList.remove('active');
                  setTimeout(function(){ cm.classList.add('hidden'); cm.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              });
            }
            
            // 13. Cultivation Guidance Back Button
            var backFromCG = document.getElementById('backFromCultivationGuidance');
            if (backFromCG) {
              backFromCG.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Cultivation Guidance back clicked');
                var cg = document.getElementById('cultivationGuidancePage');
                if (cg) {
                  cg.classList.remove('active');
                  setTimeout(function(){ cg.classList.add('hidden'); cg.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              };
              backFromCG.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Cultivation Guidance back clicked (addEventListener)');
                var cg = document.getElementById('cultivationGuidancePage');
                if (cg) {
                  cg.classList.remove('active');
                  setTimeout(function(){ cg.classList.add('hidden'); cg.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              });
            }
            
            // 14. Weekly Plan Back Button
            var backFromWP2 = document.getElementById('backFromWeeklyPlan');
            if (backFromWP2) {
              backFromWP2.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Weekly Plan back clicked');
                var wp2 = document.getElementById('weeklyPlanPage');
                if (wp2) {
                  wp2.classList.remove('active');
                  setTimeout(function(){ wp2.classList.add('hidden'); wp2.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              };
              backFromWP2.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Weekly Plan back clicked (addEventListener)');
                var wp2 = document.getElementById('weeklyPlanPage');
                if (wp2) {
                  wp2.classList.remove('active');
                  setTimeout(function(){ wp2.classList.add('hidden'); wp2.style.transform=''; }, 150);
                }
                var profile = document.getElementById('profilePage');
                if (profile) profile.classList.remove('hidden');
              });
            }
            
            // 15. Demand Forecasting Back Button
            var backFromDF = document.getElementById('backFromDemandForecasting');
            if (backFromDF) {
              backFromDF.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Demand Forecasting back clicked');
                var df = document.getElementById('demandForecastingPage');
                if (df) {
                  df.classList.remove('active');
                  setTimeout(function(){ df.classList.add('hidden'); df.style.transform=''; }, 150);
                }
                var settings = document.getElementById('settingsPage');
                if (settings) settings.classList.remove('hidden');
              };
              backFromDF.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Demand Forecasting back clicked (addEventListener)');
                var df = document.getElementById('demandForecastingPage');
                if (df) {
                  df.classList.remove('active');
                  setTimeout(function(){ df.classList.add('hidden'); df.style.transform=''; }, 150);
                }
                var settings = document.getElementById('settingsPage');
                if (settings) settings.classList.remove('hidden');
              });
            }

            // 16. List Your Service Back Button
            var backFromLS = document.getElementById('backFromListService');
            if (backFromLS) {
              backFromLS.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('List Your Service back clicked');
                var ls = document.getElementById('listServicePage');
                if (ls) {
                  ls.classList.remove('active');
                  setTimeout(function(){ ls.classList.add('hidden'); ls.style.transform=''; }, 150);
                }
                var settingsPage = document.getElementById('settingsPage');
                if (settingsPage) settingsPage.classList.remove('hidden');
              };
              backFromLS.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('List Your Service back clicked (addEventListener)');
                var ls = document.getElementById('listServicePage');
                if (ls) {
                  ls.classList.remove('active');
                  setTimeout(function(){ ls.classList.add('hidden'); ls.style.transform=''; }, 150);
                }
                var settingsPage = document.getElementById('settingsPage');
                if (settingsPage) settingsPage.classList.remove('hidden');
              });
            }
            
            console.log('All back button handlers set up successfully!');
            
            // ADDITIONAL TOUCH EVENT HANDLERS FOR MOBILE
            console.log('Setting up touch event handlers for mobile...');
            
            // Add touch event handlers for all back buttons
            var allBackButtons = [
              'backFromExpertContacts', 'backFromUserAddress', 'backFromEditProfile', 
              'backFromPostDisaster', 'backFromFarmerInfo', 'backFromPrivacy', 
              'backFromTerms', 'backFromFarmDetails', 'backFromPrecaution', 
              'backFromInfo', 'backFromPastTrack', 'backFromCropManagement', 
              'backFromCultivationGuidance', 'backFromWeeklyPlan', 'backFromDemandForecasting',
              'backFromListService'
            ];
            
            allBackButtons.forEach(function(buttonId) {
              var button = document.getElementById(buttonId);
              if (button) {
                // Add touchstart event for immediate response
                button.addEventListener('touchstart', function(e) {
                  e.preventDefault();
                  e.stopPropagation();
                  console.log('Touch start on back button:', buttonId);
                  
                  // Trigger the click event
                  button.click();
                }, { passive: false });
                
                // Add touchend event as backup
                button.addEventListener('touchend', function(e) {
                  e.preventDefault();
                  e.stopPropagation();
                  console.log('Touch end on back button:', buttonId);
                }, { passive: false });
              }
            });
            
            console.log('Touch event handlers set up successfully!');
          });
        } catch (e) {
          console && console.error && console.error('Past Track init error', e);
        }
      })();
        function toggleProcessDetails(process) {
          var detailsElement = document.getElementById(process + '-details');
          var arrowElement = document.getElementById(process + '-arrow');
          
          if (detailsElement && arrowElement) {
            if (detailsElement.classList.contains('hidden')) {
              // Show details
              detailsElement.classList.remove('hidden');
              arrowElement.textContent = 'expand_less';
            } else {
              // Hide details
              detailsElement.classList.add('hidden');
              arrowElement.textContent = 'expand_more';
            }
          }

      // ENHANCED global back-button delegation for overlays
      (function(){
        try {
          document.addEventListener('click', function(ev){
            var t = ev.target;
            if (!t || !t.closest) return;
            
            // Check if clicked element is a back button
            var backButton = t.closest('.back-button');
            if (backButton) {
              console.log('Global back button clicked:', backButton.id);
              ev.preventDefault(); 
              ev.stopPropagation();
              
              // Find the parent overlay page
              var overlay = backButton.closest('#expertContactsPage, #postDisasterPage, #cultivationGuidancePage, #weatherPrecautionPage, #infoPage, #weeklyPlanPage, #pastTrackPage, #cropManagementPage, #userAddressPage, #editProfilePage, #demandForecastingPage, #listServicePage, #farmerInfoPage, #farmDetailsPage, #privacyPage, #termsPage');
              
              if (overlay) {
                console.log('Closing overlay:', overlay.id);
                overlay.classList.remove('active');
                setTimeout(function(){ 
                  overlay.classList.add('hidden'); 
                  overlay.style.transform=''; 
                }, 150);
                
                // Show appropriate parent page
                if (overlay.id === 'expertContactsPage' || overlay.id === 'postDisasterPage' || overlay.id === 'userAddressPage' || overlay.id === 'editProfilePage' || overlay.id === 'farmerInfoPage' || overlay.id === 'farmDetailsPage' || overlay.id === 'weatherPrecautionPage' || overlay.id === 'infoPage' || overlay.id === 'pastTrackPage' || overlay.id === 'cropManagementPage' || overlay.id === 'cultivationGuidancePage' || overlay.id === 'weeklyPlanPage') {
                  var profilePg = document.getElementById('profilePage');
                  if (profilePg) {
                    profilePg.classList.remove('hidden');
                    console.log('Showing profile page');
                  }
                }
                if (overlay.id === 'demandForecastingPage' || overlay.id === 'listServicePage' || overlay.id === 'privacyPage' || overlay.id === 'termsPage') {
                  var settingsPg = document.getElementById('settingsPage');
                  if (settingsPg) {
                    settingsPg.classList.remove('hidden');
                    console.log('Showing settings page');
                  }
                }
                return false;
              }
            }
            var ecBack = t.closest('#backFromExpertContacts');
            if (ecBack) {
              ev.preventDefault(); ev.stopPropagation();
              var ec = document.getElementById('expertContactsPage');
              if (ec) { ec.classList.remove('active'); setTimeout(function(){ ec.classList.add('hidden'); ec.style.transform=''; }, 150); }
              var profilePage = document.getElementById('profilePage');
              if (profilePage) profilePage.classList.remove('hidden');
              return false;
            }
            var pdBack = t.closest('#backFromPostDisaster');
            if (pdBack) {
              ev.preventDefault(); ev.stopPropagation();
              var pd = document.getElementById('postDisasterPage');
              if (pd) { pd.classList.remove('active'); setTimeout(function(){ pd.classList.add('hidden'); pd.style.transform=''; }, 150); }
              var profilePage2 = document.getElementById('profilePage');
              if (profilePage2) profilePage2.classList.remove('hidden');
              return false;
            }
            var uaBack = t.closest('#backFromUserAddress');
            if (uaBack) {
              ev.preventDefault(); ev.stopPropagation();
              var ua = document.getElementById('userAddressPage');
              if (ua) { ua.classList.remove('active'); setTimeout(function(){ ua.classList.add('hidden'); ua.style.transform=''; }, 150); }
              var profilePage3 = document.getElementById('profilePage');
              if (profilePage3) profilePage3.classList.remove('hidden');
              return false;
            }
            var epBack = t.closest('#backFromEditProfile');
            if (epBack) {
              ev.preventDefault(); ev.stopPropagation();
              var ep = document.getElementById('editProfilePage');
              if (ep) { ep.classList.remove('active'); setTimeout(function(){ ep.classList.add('hidden'); ep.style.transform=''; }, 150); }
              var profilePage4 = document.getElementById('profilePage');
              if (profilePage4) profilePage4.classList.remove('hidden');
              return false;
            }
            var dfBack = t.closest('#backFromDemandForecasting');
            if (dfBack) {
              ev.preventDefault(); ev.stopPropagation();
              var df = document.getElementById('demandForecastingPage');
              if (df) { df.classList.remove('active'); setTimeout(function(){ df.classList.add('hidden'); df.style.transform=''; }, 150); }
              var settingsPage = document.getElementById('settingsPage');
              if (settingsPage) settingsPage.classList.remove('hidden');
              return false;
            }
            var lsBack = t.closest('#backFromListService');
            if (lsBack) {
              ev.preventDefault(); ev.stopPropagation();
              var ls = document.getElementById('listServicePage');
              if (ls) { ls.classList.remove('active'); setTimeout(function(){ ls.classList.add('hidden'); ls.style.transform=''; }, 150); }
              var settingsPage = document.getElementById('settingsPage');
              if (settingsPage) settingsPage.classList.remove('hidden');
              return false;
            }
          }, true);
        } catch(e) {}
      })();
        }
    </script>
  </body>
</html>











